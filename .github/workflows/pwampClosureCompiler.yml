name: PWAMP Closure Compiler
on: 
  push:
    paths:
      - '**/pwamp.js'
      - '.github/workflows/pwampClosureCompiler.yml'
      - '.github/actions/closure-compiler/*'

jobs:
  pwamp_closure_compiler:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 16
          cache: 'npm'
          cache-dependency-path: .github/actions/closure-compiler/package-lock.json
      # - id: files
      #   uses: jitterbit/get-changed-files@v1
      #   with:
      #     # Format of the steps output context.
      #     # Can be 'space-delimited', 'csv', or 'json'.
      #     # 
      #     # Default: 'space-delimited'
      #     format: 'json'
      - name: Install dependencies
        run: cd .github/actions/closure-compiler && npm ci && cd ../../..
      - name: Run closure compiler
        uses: ./.github/actions/closure-compiler/
        with: 
          github: "${{toJSON(github)}}"
          steps: "${{toJSON(steps)}}"
          gchat_webhook: "${{secrets.gchat_webhook}}"
        id: pwamp-closure-compiler
      # - name: Send Google Chat Notification
      #   run: |
      #     curl --location --request POST '${{ secrets.gchat_webhook }}' \
      #     --header 'Content-Type: application/json' \
      #     -d ${{steps.pwamp-closure-compiler.outputs.chat-msg}}
      # - name: Install Google Chat dependencies
      #   run: cd .github/actions/google-chat-notification-on-push && npm ci && cd ../../..
      # - name: Format Msg
      #   uses: ./.github/actions/google-chat-notification-on-push/
      #   with: 
      #     event: "${{toJSON(github.event)}}"
      #     steps: "${{toJSON(steps)}}"
      #   id: modded
      - name: Dev Output
        run: |
          echo "${{toJSON(github)}}"
          echo "${{toJSON(steps)}}"
