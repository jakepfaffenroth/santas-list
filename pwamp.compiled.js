/*
 Copyright 2020 WompMobile, Inc.
 This file contains works from many authors under various licenses.
 Please visit http://www.wompmobile.com/license for more information.
*/
class AmpCore{constructor(a){this.pwa=a}ampAttachDoc(a,b,c){a.shadowDoc=window.AMP.attachShadowDoc(a.hostElem,b,c);a.shadowBody=a.shadowDoc.ampdoc.getBody();a.shadowBody.setAttribute("data-docnum",a.docnum);a.href=c}async ampClearDoc(a){const b=/^(id|class|data)/i;try{await (a.shadowDoc?a.shadowDoc.close():Promise.resolve())}catch(g){console.log(g)}const c=a.hostElem,d=document.createElement("div");for(let g=0;g<c.attributes.length;g++){var f=c.attributes[g];b.test(f.name)&&d.setAttribute(f.name,
f.value)}c.parentNode.replaceChild(d,c);Object.assign(a,{hostElem:d,href:null,shadowBody:null,shadowDoc:null});d.parentElement.scroll(0,0)}ampEventsNewDomEmitterRegistration(a){const b=this,c=function(g){var h=!1;let k=null;for(const l of g){const m=l.addedNodes[0];if(m){h=!0;k=m.parentElement.closest("amp-list");break}}if(h){h=parseInt(k.getAttribute("data-updates")||0);if(2<h)return console.log(`#${k.id}: amp-list modified more than 2 times. not emitting new DOM event.`);k.setAttribute("data-updates",
h+1);b.ampEventsNewDomEmitterRegistration(k);g=new CustomEvent("pwaDomAdded",{detail:{ampList:k,target:g}});document.dispatchEvent(g);setTimeout(function(l){l.removeAttribute("data-updates")}.bind(null,k),100)}};var d=function(g){if(g=Array.from(g).filter(h=>{h=h.addedNodes[0];let k=!0;if(!h)return!1;h.matches(".i-amphtml-loading-container")||"DIV"!==h.tagName||h.hasAttribute("placeholder")||h.hasAttribute("fallback")||h.hasAttribute("overflow")?k=!1:h.matches(".i-amphtml-replaced-")&&(k=!0);return k})[0])g=
g.addedNodes[0],(new MutationObserver(c)).observe(g,{childList:!0}),this.disconnect()};const f=Array.from(a.querySelectorAll("amp-list"));for(const g of f)(new MutationObserver(d)).observe(g,{childList:!0});d=[];for(const g of a.children)d=d.concat(Array.from(g.querySelectorAll("amp-list>div:not([placeholder]):not([fallback]):not([overflow])")));for(const g of d)(new MutationObserver(c)).observe(g,{childList:!0})}async ampGetState(a,b=1E4){return new Promise(async(c,d)=>{let f,g;try{f=await this.pwa.util.waitForProp("docObjActive",
this.pwa.session),g=await this.pwa.util.waitForProp("shadowDoc",f)}catch(h){debugger}g||d("active doc not found");if(d=await g.getState(a))c(d);else{const h=setTimeout(()=>{clearInterval(k);c({errMsg:`Unable to get data for AMP.${a}`})},b),k=setInterval(async()=>{let l=await g.getState(a);l&&(clearInterval(k),clearTimeout(h),c(l))},200)}})}ampGetStateBeforeRender(a,b){a=a.find(`#${b}`).find("script");if(a.length)try{return JSON.parse(a.text())}catch(c){this.pwa.errorCustom(c)}return{}}ampSetStateBeforeRender(a,
b,c){const d=a.find(`#${b}`).find("script");if(d.length)try{let f=JSON.parse(d.text());f=f?this.pwa.util.mergeRecursive(f,c):c;d.text(JSON.stringify(f));return f}catch(f){return this.pwa.errorCustom(f)}else a.find("body")[0].insertAdjacentHTML("beforeend",`
        <amp-state id="${b}">
          <script type="application/json">
            ${JSON.stringify(c)}
          </script>
        </amp-state>
        `)}async ampsSetState(a,b){b=b||{activeDoc:this.pwa.session.docObjActive};console.log("setting state",a,b);console.log(a);if(this.pwa.session.ampStateUnstable){const d=function(f,g){document.removeEventListener("ampStateIsStable",d);this.ampsSetState(f,g)}.bind(this,a,b);document.addEventListener("ampStateIsStable",d)}else{var c=[];for(const d of Object.values(b))d&&d.shadowDoc&&c.push(d.shadowDoc.setState(a));return Promise.all(c).catch(d=>console.log(d))}}async ampsAmpStateIsStableEvt(){if(this.pwa.session.ampStateUnstable){this.pwa.session.ampStateUnstable=
!1;var a=new CustomEvent("ampStateIsStable");document.dispatchEvent(a)}}async ampValidateResponse(a,b){if(!/text\/html/i.test(a.headers.get("content-type")))throw this.pwa.errorCustom("response is not html",a);if(200==a.status)return await a.text();if(202==a.status)throw this.pwa.errorCustom("ampPageNotBuilt",{res:a,urlObj:b});throw this.pwa.errorCustom("fetchError",a);}ampValidateResponseDoc(a,b){if(this.pwa.session.isBABY){var c=!/(bbbabyapp|buybuybaby)\.com/i.test(location.hostname);a=a.replace(c?
/(dev01|et01|em02|et02|e-www3preview)-www.bbbabyapp.com|www.buybuybaby.com/gi:/(dev01|et01|em02|et02|e-www3preview)baby-www.bbbyapp.com|buybuybaby.bedbathandbeyond.com/gi,location.hostname)}this.pwa.session.isHARMON&&(c=!/(harmonfacevalues)\.com/i.test(location.hostname),a=a.replace(c?/(dev01|et01|em02harmon|et02|e-www3preview)-www.bbbyapp.com|www.harmonfacevalues.com/gi:/(dev01|et01|em02harmon|et02|e-www3preview)-www.bbbyapp.com|harmonfacevalues.bedbathandbeyond.com/gi,location.hostname));c=this.pwa.util.parseDoc(a);
var d=c.querySelector('meta[http-equiv="Refresh"]');if(d){const {isCLPReg:f,isPLPReg:g}=this.pwa.session.docTests;a=b?/\/category\/[a-z]+\/[0-9]+$/i.test(b.pathname):!1;c=b?g.test(b.pathname)&&!f.test(b.pathname):!1;d=d.getAttribute("content");d=d.replace(/.*url=/,"");let h=new URL(d,location.origin);if(a&&/not-found/i.test(h.pathname)&&"/store/category/kitchen/20002"!==b.pathname){b=b.pathname.match(/\/([a-z]+)\/[0-9]+$/i);if(1<b.length)throw h.pathname=b[1],a?d=location.origin+"/store/s/"+encodeURI(b[1]):
c&&(d=location.origin+"/store/s/"+encodeURI(b[1])),this.pwa.session.redirectInProgress=!0,this.pwa.errorCustom("wompRedirect",d);throw this.pwa.errorCustom("not found redirect");}if(/not-found/i.test(h.pathname))throw this.pwa.errorCustom("not found redirect");h.pathname=h.pathname.replace(/^\/amp/,"");d=h.href;this.pwa.session.redirectInProgress=!0;throw this.pwa.errorCustom("wompRedirect",d);}b=c.getElementsByTagName("HTML")[0];if(!b.hasAttribute("amp")&&!b.hasAttribute("\u26a1"))throw this.pwa.errorCustom("ampPageNotValid",
a);return c}}
class Amp extends AmpCore{constructor(a){super(a);this.pwa=a;document.addEventListener("pwaDomAdded",b=>{this.ampListPostRender(b.detail.ampList)})}async ampBeforeRender(a,b,c,d){const f=$(a),g=f.find("body");let h=parseInt(g.attr("data-version")||0);isNaN(h)&&(h=0);console.log(`AMP Doc Version: ${h}`);await this.ampBeforeRenderReplaceSearchTerm(f,c);this.pwa.appshell.addHeaderTagsToAppshell(g);this.pwa.user.ampBeforeRenderUser(f);this.pwa.amp.ampSetStateBeforeRender(f,"features",this.pwa.session.features||{});
for(const [p,n]of Object.entries(this.pwa.session.features||{})){var k=$(this.pwa.$$$(f[0],`[data-feature="${p}"]`)),l=$(this.pwa.$$$(f[0],`[data-feature-hide="${p}"]`));n?(k.removeClass("wHide"),l.addClass("wHide")):(k.addClass("wHide"),l.removeClass("wHide"))}this.pwa.session.features.registryEnable&&this.pwa.registry.ampBeforeRender(f,b,g);this.ampBeforeRenderStorageSync(f);this.ampBeforeRenderBindingSync(g);k=this.pwa.session.amp_sessionStorage.changeStore;l=f.find("#updateStoreApi").attr("expression");
k&&l&&(k.sddActive=!1,this.ampSetStateBeforeRender(f,"changeStore",k),this.ampBeforeRenderBindEval(f,"#storeInfo,\n        #csBannerList,\n        .csBanner amp-list,\n        [data-store-info],\n        #plpControlBopis,\n        #plpBopusList\n        ","src",{changeStore:k},l));/type=oosAmpForm/.test(location.href)&&this.pwa.site.pdpOosModalHandler(f);!this.pwa.session.docTests.isPDPReg.test(b.pathname)||this.pwa.session.features.enableMarketplace||this.pwa.session.features.enableMarketplace||
(this.pwa.util.replaceStringInTemplate(g,/\{\{(#|\^|\/)MARKETPLACE_ITEM_FLAG\}\}/gi," ","prodOfferTemplate"),this.pwa.util.replaceStringInTemplate(g,/\{\{(#|\^|\/)MARKETPLACE_ITEM_FLAG\}\}/gi," ","prodFulfillTemplate"),this.pwa.util.replaceStringInTemplate(g,/\{\{(#|\^|\/)MARKETPLACE_ITEM_FLAG\}\}/gi," ","prodFulfillTemplate2"));this.pwa.session.docTests.isPDPReg.test(b.pathname)&&(l=g.find("#storeSkuSearch"))&&/search\/sku\?directCall/i.test(l.attr("expression"))&&(l.attr("expression",l.attr("expression").replace("directCall=true&",
"")),console.log("Removed directCall=true param from search/sku API call"));this.pwa.session.paymentInit&&this.pwa.session.docTests.isPDPReg.test(b.pathname)&&delete this.pwa.session.paymentInit;this.ampBeforeRender_iosInlineSvg(a.body);f.find('\n        #clear.cbh,\n        #swiframe,\n        amp-install-serviceworker,\n        script[custom-element="amp-install-serviceworker"],\n        .componentWrapper-GoogleDFP+.componentWrapper-GoogleDFP,\n        #groupByAMPAnalytics,\n        link[rel="preload"][as="script"]\n        ').remove();
this.pwa.session.isFast&&(f.find('\n          script[custom-element="amp-install-serviceworker"],\n          amp-install-serviceworker,\n          script[custom-element="amp-ad"]\n          ').remove(),this.pwa.util.querySelectorAllDomAndTemplate(g[0],"amp-ad").forEach(p=>p.remove()));this.pwa.session.isPdpV2=g.hasClass("pdpV2")||g.hasClass("pdpV21");this.pwa.session.isPdpV21=g.hasClass("pdpV21");this.pwa.session.isPdpV21&&1024<window.outerWidth&&g.find("#second").prepend('<amp-position-observer\n          on="enter:hideHead.start; exit:showHead.start; scroll:hideHead.start"\n          media="(min-width: 1024px)"\n          layout="nodisplay"\n          viewport-margins="0 90vh"\n          intersection-ratios="0">\n      </amp-position-observer>');
this.pwa.session.features.pdpCollectionsV2&&1024<window.outerWidth&&g.find("#mobileStickyObserver").remove();this.pwa.pdpDataAbstraction=this.pwa.session.isPdpV2?new PdpDataAbstractionV2(this.pwa):new PdpDataAbstractionV1(this.pwa);this.ampBeforeRenderCss(f,g,h);f.find('link[rel="alternate"]').each((p,n)=>{p=$(n);p.attr("href",p.attr("href").replace("/amp",""))});d&&[{selector:'meta[property="og\\:url"]',property:"content"}].forEach(p=>{f.find(p.selector).attr(p.property,location.href)});a=f.find(`
        head title,
        meta:not([name="amp-script-src"]),
        ${this.pwa.session.features.bodyStructuredData?"":'script[type="application/ld+json"],'}
        link[rel="preload"][as="fetch"],
        link[rel="preload"][as="image"],
        link[rel="canonical"],
        link[rel="alternate"],
        link[rel="amphtml"]
      `).remove();this.pwa.appshell.elems.head.find('title, link[rel="canonical"],link[rel="alternate"], meta[name=description]').remove();this.pwa.appshell.elems.head[0].insertAdjacentHTML("beforeend",a.outerHTML());this.ampBeforeRenderSeo(f);try{var m=this.pwa.session.ctaParams;for(a=0;a<m.length;a+=1){let p=m[a];if((new RegExp(p,"gi")).test(b.search)){this.pwa.site.scrapeProdData(f,b,p);break}}}catch(p){console.warn(`Unable to get CTA parameters from pwa session or error matching parameters to url. Error ${p}`)}await this.pwa.desktop.ampBeforeRenderAll(f);
this.pwa.site.formPwaHandlerOnly(f);f.find('amp-analytics[type="mpulse"]').remove();if(m=f[0].querySelector("#adobeAnalyticsConfig"))try{const p=m&&m.querySelector("script");let n=JSON.parse(p.textContent),q=new URL(n.requests.iframeMessage);this.pwa.session.docTests.isPDPReg.test(b.pathname)?this.pwa.session.docs.pdp.ampPathSearch=q.hash.replace("#",""):this.pwa.session.docs.primary.ampPathSearch=q.hash.replace("#","");m.parentNode.removeChild(m)}catch(p){console.error("Unable to parse adobe analytics script\n",
p)}this.pwa.session.runSiteSpect&&!this.pwa.quickView.quickViewLoaded?this.pwa.session.siteSpectScripts=f.find("[data-sitespect]"):f.find("[data-sitespect]").remove();if(this.pwa.session.docTests.isSearchReg.test(b.pathname))try{let p=/\/store\/s\/([^\/]+)/i.exec(b.pathname),n=1<p.length?decodeURIComponent(p[1].replace(/-/gi," ").replace(/_/gi,'"')):this.pwa.session.lastSearchTerm;""!==n&&(this.pwa.amp.ampSetStateBeforeRender(f,"searchTerm",n),f.find("#searchlabel").addClass("active").find("div").eq(1).text(n),
f.find("input.searchInput").val(n))}catch(p){console.log(`Unable to update recent search term. Error: ${p}`)}else this.pwa.site.recentSearchDataUpdate(f);$(this.pwa.util.querySelectorAllDomAndTemplate(g[0],'[data-test^="shopStoreBtn"]')).attr("href","/store/pickup/store-{{storeId}}");this.pwa.pencilBanner.ampBeforeRender(g,b);this.pwa.findMyCollege.ampBeforeRender(g,b);this.ampBeforeRenderPlp(f,g,b,k,c);await this.pwa.pdp.ampBeforeRenderPdp(f,b,k,d);await this.pwa.college.ampBeforeRenderCollege(f,
b);this.pwa.session.features.sdd||f.find("#storeInfo").remove()}ampBeforeRender_iosInlineSvg(a){/ipod|iphone|ipad/i.test(navigator.userAgent)&&this.pwa.util.querySelectorAllDomAndTemplate(a,"svg>use").forEach(b=>{try{var c=b.parentNode,d=b.getAttribute("xlink:href");if(d){try{var f=a.querySelector(d);if(!f){console.log("SVG: missing xlink:href definition: "+d);return}}catch(k){return}var g=f.cloneNode(!0);if(!c.getAttribute("viewBox")){var h=f.getAttribute("viewBox");h&&c.setAttribute("viewBox",h)}for(;c.firstChild;)c.removeChild(c.firstChild);
for(;g.firstChild;)c.appendChild(g.firstChild)}else console.log("SVG: <use> is missing xlink:href:\n",c)}catch(k){console.error("Unable to inline SVG",k)}})}async ampBeforeRenderBindEval(a,b,c,d,f){a.find(b).each((g,h)=>{g=$(h);if(h=f||g.attr(`[${c}]`)){for(var k of Object.keys(d))h=h.replace(new RegExp(`(${k})`,"gi"),"this.$1");k={keys:"Object",values:"Object"};for(const [l,m]of Object.entries(k))h=h.replace(new RegExp(`(${l})(?!\.com)`,"gi"),`${m}.$1`);k=(new Function("",`{
          try {
            // console.log((${h}).replace(/this./gi, ''));
            return (${h}).replace(/this./gi, '');
          } catch (ex) {
            // debugger;
            console.log('failed to bind attribute:', ex);
          }
        }`)).bind(d);g.attr(c,k(d))}})}ampBeforeRenderCss(a,b,c){b.addClass("PWAMP");a.find("style[amp-custom]").each((d,f)=>{f.innerHTML='\n      .PWAMP .pwaOnly.pwaOnly {\n          display: revert;\n      }\n      .PWAMP .pwaOnly.flex {\n          display: flex;\n      }\n      .PWAMP .pwaOnly.pwaOnly.plpPill, .PWAMP .pwaOnly.pwaOnly.localModalToggle {\n        display: flex;\n      }\n      body {\n        min-height: 100vh;\n      }\n      .variableAmpList {\n        height: auto!important;\n      }\n      .variableAmpList > div:not([placeholder]):not([fallback]):not([overflow]) {\n        position: static;\n        height: auto!important;\n        min-height: fit-content!important;\n      }\n      /* Preload an amp-list to show at desktop resolutions - ex: desktop user acct menu */\n      @media (max-width: 79.99rem) {\n        .dwPreload.dwPreload {\n          display: block !important;\n          height: 1px !important;\n          opacity: 0;\n          overflow: hidden !important;\n          position: fixed;\n          top: 0;\n          width: 100vw !important;\n        }\n      }\n\n      /* Safari iOS carousel transform was clipping tooltip z-index\n      fix for https://bedbathandbeyond.atlassian.net/browse/PREP-9587 */\n      .sliderWrap .amp-sacrifice {\n        transform: none!important;\n      }\n\n      .overflow.overflow,\n      .overflow .i-amphtml-carousel-scroll {\n        overflow: visible!important;\n      }\n\n      #scrollToTopButton {\n        transition: opacity 0.4s;\n        visibility: hidden;\n      }\n      #scrollToTopButton.active {\n        opacity: 1;\n        transition: opacity 0.4s;\n        visibility: visible;\n      }\n      .header .navSelected {\n        text-decoration: underline;\n        color: var(--priClr);\n      }\n      /* JW - All temp 10.23.20 */\n      #searchcontainer#searchcontainer {\n        left: -200vw;\n      }\n      #searchcontainer#searchcontainer.active {\n        left: 0;\n      }\n\n      #searchcontainer .recentSearches{\n        visibility: hidden;\n      }\n      #searchcontainer.active .recentSearches{\n        visibility: visible;\n      }\n\n      #searchcontainer .quickLinks{\n        visibility: hidden;\n      }\n      #searchcontainer.active .quickLinks{\n        visibility: visible;\n      }\n\n      .linkClearRecent {\n        font-size: var(--txtP);\n        font-weight: 300;\n        letter-spacing: 1px;\n      }\n\n      /* JW - PDP temp 10.23.20 */\n      .PWAMP .modalImg.active {\n        top: 0;\n        height: 100vh;\n      }\n\n      /* JW - PLP temp 10.23.20  */\n      .linkMid {\n        color: inherit;\n        display: inline-flex;\n        align-items: center;\n      }\n      .absolute.absolute {\n        position: absolute;\n      }\n\n      /* Helpful form button styling for Q&A and Reviews */\n      .reviewsCont {\n          border: 2px solid #d6d6d6;\n          border-radius: 4px;\n          margin: 1rem 0;\n          padding: 1rem;\n      }\n      .helpfulCont {\n          display: block;\n          max-width: 100%;\n          position: relative;\n          overflow: hidden;\n      }\n      .helpfulItems {\n          display: flex;\n          list-style-type: none;\n          margin: 0;\n          padding: 0;\n      }\n      .helpfulIcon {\n          height: 16px;\n          width: 16px;\n      }\n      .helpfulLink {\n          display: inline-block;\n          border: 2px solid #d6d6d6;\n          border-radius: var(--btnBorderRad);\n          font-size: var(--btnLinkSize);\n          font-family: var(--fontMain);\n          padding: .3rem .5rem;\n          text-decoration: none;\n          color: #000;\n          font-weight: 300;\n          transition: all .5s ease-in;\n          background: transparent;\n          background-color: #fff;\n          cursor: pointer;\n      }\n      .helpfulLink:active {\n          animation: onPressed .25s ease 1;\n      }\n      .helpfulLink[data-vote="negative"] {\n          background-color: var(--btnBg);\n          border-color: var(--btnBg);\n          color: #fff;\n      }\n      .helpfulLink[data-vote="negative"] .helpfulIconCont svg {\n          fill: #fff;\n      }\n      .helpfulItems li {\n          margin-right: 2px;\n      }\n      .helpfulCnt {\n          font-weight: 600;\n      }\n      .clGps {\n        display: block!important;\n      }\n      amp-carousel .sliderBadge {\n        display:none;\n      }\n      .collectionsSlider amp-carousel .sliderBadge {\n        display: initial;\n      }\n\n      /* 11.23 temp */\n      .siteRecentList.siteRecentList {\n        z-index: 10;\n      }\n\n      /* 11.25 temp */\n      .holidayMessaging {\n        color: #088000;\n      }\n      #scrollToTopButton#scrollToTopButton {\n        bottom: 100px;\n      }\n      /* payment options 2 */\n      .payOption2 {\n        margin: 12px 0;\n        overflow: hidden;\n      }\n      .payOption {\n        border-bottom: 1px solid #d6d6d6;\n        border-top: 1px solid #d6d6d6;\n        margin: 12px 0;\n        height: 76px;\n        overflow: hidden;\n      }\n      /* Payment options */\n      .PWAMP .payOption:not(.hide) {\n        display: block;\n      }\n      #payOptionHeader {\n        margin: 10px 0;\n      }\n      .moreOptions {\n        font-weight: bold;\n        color: var(--btnLinkColor);\n      }\n      div#payOption div {\n        height: 24px;\n        margin: 8px 0;\n      }\n      .moreOptions .wi.wi-down-arrow {\n        vertical-align: middle;\n        margin-left: 5px;\n      }\n      /* Remove this after 5.11.22 release */\n      amp-img.klarnaLogo {\n        display: inline-block;\n        width: 58px;\n        height: 37px;\n        vertical-align: middle;\n        margin: -3px 0 0 -3px;\n      }\n      /* End remove */\n      .paymentOption.paypal,\n      .paymentOption.klarna {\n        display: none;\n      }\n      .payOption2 .paymentOption.klarna {\n        display: block;\n      }\n\n      .klarnaModalWrapper div.modalContent {\n        height: unset;\n        width: unset;\n        padding: 4% 2%;\n      }\n      .klarnaModalWrapper iframe {\n        max-width: 100%;\n        max-height: 100%;\n      }\n      .paymentAmount {\n        display: inline-block;\n        min-width: 47px;\n        text-align: right;\n      }\n\n      /* 560px breakpoint comes from klarna */\n      @media screen and (min-width: 560px) {\n        .klarnaModalWrapper div.modalContent {\n          height: 535px;\n          width: 559px; /* Force klarna to not use background img */\n          min-height: 555px;\n          padding: 40px 20px 20px 20px;\n          margin: 120px auto 0;\n        }\n      }\n      #wm_contentQv {\n        padding: 3rem 1rem;\n      }\n      .saParent {\n        opacity: 0;\n        transition: opacity 600ms ease-in-out;\n      }\n      .onePix.onePix {\n        max-height: 1px;\n        overflow: hidden;\n        margin: 0;\n      }\n      .tabbedSections,\n      #socialAnnexTab {\n        min-height: 200px;\n      }\n      .loading {\n        padding: 2rem 1rem;\n      }\n      .loading span {\n        width: 5px;\n        height: 5px;\n        background: var(--cartCountBg);\n        display: inline-block;\n        margin-left: 0.3rem;\n        border-radius: 50%;\n        animation-name: loadingDots;\n        animation-duration: 1800ms;\n        animation-iteration-count: infinite;\n      }\n      .loading .dot2 {\n        animation-delay: 600ms;\n      }\n      .loading .dot3 {\n        animation-delay: 1200ms;\n      }\n      @keyframes loadingDots {\n        0% {\n          transform: scale(1);\n        }\n        50% {\n          transform: scale(1.4);\n        }\n        100% {\n          transform: scale(1);\n        }\n      }\n      /* Used for drag-to-scroll cat nav bar */\n      .grab {\n        cursor: grab;\n      }\n      .grab .catBarWrap {\n        padding-right: 2rem;\n      }\n      .navPillsBar.grabbing,\n      .navPillsBar.grabbing * {\n        cursor: grabbing\n      }\n      .registryCtaCont {\n        display: none;\n      }\n      /* this needs to ignore expert picks registrycta */\n      .activeRegistryCta .registryCtaCont:not(.MSWP) {\n        display: block;\n        flex-basis: 100%;\n      }\n      .activeRegistryCta .registryCtaCont.personalize {\n        display: none;\n      }\n      .activeRegistryCta.personalized .registryCtaCont.personalize {\n        display: block;\n        flex-basis: 100%;\n      }\n      .activeRegistryCta .registryRow {\n        display: none;\n      }\n      .activeRegistryCta .pdpQtyInputCont:not(.personalize),\n      .activeRegistryCta.personalized .pdpQtyInputCont.personalize,\n      .activeRegistryCta .fulfillCtaCont:not(.personalize),\n      .activeRegistryCta.personalized .fulfillCtaCont.personalize {\n        flex-basis: 100%;\n      }\n      .activeRegistryCta .fulfillCtaCont:not(.personalize),\n      .activeRegistryCta.personalized .fulfillCtaCont.personalize {\n        padding-left: 0;\n        margin-top: 1rem;\n      }\n      .activeRegistryCta .fulfillCtaCont:not(.personalize) .btnPrimary,\n      .activeRegistryCta.personalized .fulfillCtaCont.personalize .btnPrimary {\n        border: 2px solid var(--btnPri);\n        background-color: #fff;\n        color: var(--btnPri);\n      }\n      .personalized .notPersonalizedMsg, .personalized .notPersonalizedCta {\n        display: none;\n      }\n      .personalized .personalizedCta {\n        display: initial;\n      }\n      .customPreviewCont {\n        border: 2px solid #f2f2f2;\n      }\n      .customPreviewCont b{\n          font-weight: 400;\n      }\n      .customPreview {\n          max-width: 70px;\n      }\n      .activeRegistryCta .fulfillCtaCont .btnPrimary.btnOutOfStock {\n        border: 2px solid #e2e2e2;\n        color: #888;\n        display: unset;\n      }\n      .activeRegistryCta .fulfillCtaCont .btnPrimary:hover,\n      .activeRegistryCta .fulfillCtaCont .btnPrimary:active,\n      .activeRegistryCta.personalized .fulfillCtaCont.personalize .btnPrimary:hover {\n        background-color: var(--hBackSec);\n        border-color: var(--hBackSec);\n        color: #fff;\n      }\n      .activeRegistryCta .registryCtaCont+.btnOutlinePrimary {\n        min-height: 50px;\n        margin-top: .5rem;\n      }\n      .registrySelect .registryCtaCont .wiCaret {\n        display: inline-block;\n      }\n      .activeRegistryCta .prodCard .registryCtaCont.shipItOOS.bopisOOS,\n      .registryCtaCont .wiCaret,\n      .activeRegistryCta.expertPicksCard .epCellCtaLink,\n      .activeRegistryCta.expertPicksCard .epCellCtaLink,\n      .activeRegistryCta.expertPicksCard .sswpMSWP.registryCtaCont  {\n        display: none;\n      }\n      .activeRegistryCta .prodCardR .registryCtaCont {\n        display: flex;\n        justify-content: unset;\n        align-items: end;\n        max-height: 51px;\n      }\n      .activeRegistryCta .registryCtaCont.SSWP {\n        display: flex;\n      }\n      .regOpt:hover {\n        background: #d6d6d6;\n        text-decoration: none;\n      }\n      .regOpt.regDisabled {\n        background: #e2e2e2;\n        color: #595959;\n        pointer-events: none;\n      }\n      .regFriendLink {\n        line-height: 35px;\n      }\n      .regTitle {\n        font-size: 14px;\n      }\n      /* temporary for the switch to hide personalized products can be removed after 2/16 */\n      /\n      *@media (min-width: 64rem) {\n        .activeRegistryCta .pdpQtyInputCont:not(.personalize),\n        .activeRegistryCta.personalized .pdpQtyInputCont.personalize {\n          flex-basis: 20%;\n        }\n        .customPreviewCont button:hover {\n          text-decoration: underline;\n        }\n        .customPreview {\n          max-height: 120px;\n          max-width: 120px;\n        }\n        .dGr2 {\n          margin-right: 2rem;\n        }\n      }\n      */\n      .registryList {\n        border: solid 2px #d6d6d6;\n        border-radius: 4px;\n        box-shadow: 10px 13px 22px 0 rgba(0, 0, 0, 0.2);\n        left: 50%;\n        max-height: 35vh;\n        overflow-y: auto;\n        overflow-x: hidden;\n        top: 100%;\n        transform: translateX(-50%);\n        width: 300px;\n        z-index: 3;\n      }\n      .plpV2 .registryList {\n        left: unset;\n        right: 0;\n        transform: none;\n      }\n      .above {\n        top: initial;\n        bottom: 110%;\n      }\n      /* Beyond+ changes for PLP */\n      .beyondMember .plpBeyondPlus .regPrice {\n        display: none;\n      }\n      /*\n        utility class for hiding things but keeping their layout\n        used for subscription.\n      */\n      .visHidden {\n        visibility: hidden;\n      }\n      /* PLP No Results - CLP and Brand */\n      .noResults #plpNoResultsTitle,\n      .noResults .nrContainer {\n        display: block !important;\n      }\n      '+
f.innerHTML;/ca|baby/i.test(location.hostname)&&(f.innerHTML+="\n        .beyondPlusWrap.beyondPlusWrap,\n        .bPlusWrap.bPlusWrap,\n        .priceTitle {\n            display: none;\n        }");/ca/i.test(location.hostname)&&(f.innerHTML+="\n        .noSddMsg,\n        .PWAMP .helpfulCont.pwaOnly {\n          display: none;\n        }\n        .PWAMP .helpfulCont.bedbathbeyondca.pwaOnly {\n          display: inherit;\n        }\n        ",106>c&&(f.innerHTML+="\n          #prodDeliverIt .cartLink {\n            display: none;\n          }\n        "));
/baby/i.test(location.hostname)&&(f.innerHTML+="\n              .PWAMP .helpfulCont.pwaOnly {\n                  display: none;\n              }\n              .holidayMessaging {\n                color: #b85b0a;\n              }\n              #scrollToTopButton#scrollToTopButton {\n                bottom: calc(4rem + 64px);\n              }\n              ");/ca|baby/i.test(location.hostname)||(f.innerHTML+="\n              .PWAMP .helpfulCont.pwaOnly {\n                  display: none;\n              }\n              .PWAMP .helpfulCont.bedbathbeyond.pwaOnly {\n                display: inherit;\n              }");
/harmon/i.test(location.hostname)||(f.innerHTML+='\n        #wm_footer > div[id^="bx-campaign"] {\n             display: none !important;\n          }')});b.find(".radItm").addClass("s12 whiteBg txtBlk txtLeft borderNone radItm")}ampBeforeRenderPlp(a,b,c,d,f){function g(m){let p;m.forEach(n=>{const [q,t]=n.match(/[0-9]+/g);p={min:q,max:t}});return p}var h=this.pwa.session.docTests.isBrandReg,k=this.pwa.session.docTests.isCLPReg;const l=`${c.pathname}${c.search}`;if((this.pwa.session.docTests.isPLPReg.test(l)||
h.test(l))&&(!k.test(l)||/category\/clearance/i.test(l))){this.pwa.session.ampStateUnstable=!0;this.pwa.session.features.enableMarketplace||(this.pwa.util.replaceStringInTemplate(b,/\{\{#MARKETPLACE_ITEM_FLAG\}\}.+?(?=\{\{\/MARKETPLACE_ITEM_FLAG)\{\{\/MARKETPLACE_ITEM_FLAG\}\}/gi," ","plpTemplate"),this.pwa.util.replaceStringInTemplate(b,/\{\{(#|\^|\/)MARKETPLACE_ITEM_FLAG\}\}/gi," ","plpTemplate"));b=JSON.parse(a.find("#apiUrl").text());d=d||{storeId:null};h=this.pwa.session.parsedURL||{};h.searchTerms&&
(b.searchTerms=h.searchTerms,b.searchParam=`&sws=${encodeURIComponent(h.searchTerms)}`);h.page&&(b.page=h.page,b.perPage=h.perPage,b.pageParam=`&start=${h.page*h.perPage}&perPage=${b.perPage}`);h.storeId&&(Object.assign(b,{sddZipParam:"",storeOnlyParam:`&storeOnlyProducts=true&storeId=${h.storeId}`}),Object.assign(d,{sddActive:!1,sddActiveSearch:!1,storeId:h.storeId,storeOnly:!0}));this.pwa.college.isCollege&&c.searchParams.get("fromCollege")&&(k=d.storeId?d.storeId:this.pwa.college.favoriteStore?
this.pwa.college.favoriteStore.storeId:"")&&(Object.assign(b,{sddZipParam:"",storeOnlyParam:`&storeOnlyProducts=true&storeId=${k}`}),Object.assign(d,{sddActive:!1,sddActiveSearch:!1,storeId:k,storeOnly:!0}));h.sddZipcode&&(Object.assign(b,{sddZipParam:`&isSDDChecked=true&sddAttr=13_1&sddAttribute=13_1&sddZip=${h.sddZipcode}`,storeOnlyParam:`&storeOnlyProducts=false&storeId=${d.storeId}`}),Object.assign(d,{sddActive:!0,sddActiveSearch:!0,sddZipcode:h.sddZipcode,nearestStores:null,storeOnly:!1}));h.facets&&
(b.facets=this.pwa.site.getAppliedFacetsFromBase64(h.facets),$('head link[rel="canonical"], head link[rel="alternate"]').each((m,p)=>{m=new URL(p.href);p.href=m.origin+this.pwa.session.parsedURL.fullPath}),$('head link[rel="amphtml"]').attr("href",location.origin+"/amp"+this.pwa.session.parsedURL.fullPath),$('head meta[property="og:url"], head meta[name="twitter:url"]').attr("content",location.origin+this.pwa.session.parsedURL.fullPath),this.pwa.session.parsedURL.friendlyFacets&&(h=this.pwa.session.parsedURL.friendlyFacets.replaceAll(/-|_/g,
" ").replace("  "," ").trim().split(" ").map(m=>m[0].toUpperCase()+m.substr(1)).join(" "),k=this.pwa.session.isBABY?"Buy Buy Baby":this.pwa.session.isHARMON?"Harmon Face Values":"Bed Bath & Beyond",$("head title").text(`${h} | ${k}`),$('head meta[property="og:title"], head meta[name="twitter:title"]').attr("content",`${h} | ${k}`),$('head meta[name="description"], head meta[property="og:description"], head meta[name="twitter:description"]').attr("content",`Shopping for ${h}? Explore ${k}'s wide selection and take advantage of incredible savings. Free shipping available.`),
$("head meta[name*=keyword]").attr("content",h)));h={"LOW_PRICE%20asc":"Price - Low to High","LOW_PRICE%20desc":"Price - High to Low","RATINGS%20desc%2CREVIEWS%20desc":"Top Rated","BRAND%20asc":"Brand","ENABLE_DATE%20desc":"Newest Arrivals","MOST_POPULAR%20desc":"Most Popular","DISCOUNT_d%20asc":"Discount - Low to High","DISCOUNT_d%20desc":"Discount - High to Low"};(k=c.searchParams.get("sort"))&&"BEST_MATCH"!=k&&(b.sort=`&sort=${k}`,b.sortName=h[k]);if(h=c.searchParams.get("inStockOnline"))b.inStockOnline=
`&inStockOnline=${h}`;if(h=c.searchParams.get("removeInStock"))b.removeInStock=`&removeInStock=${h}`;if(h=c.searchParams.get("nearestStores"))d.nearestStores=h.split(",");d.storeOnly&&Object.assign(b,{removeInStock:"&removeInStock=true",storeOnlyParam:`&storeOnlyProducts=true&storeId=${d.storeId}`,sddZipParam:""});"true"==c.searchParams.get("customPriceRange")&&(b.rangedFacets.LOW_PRICE=g(b.facets.LOW_PRICE),b.customPriceRange=!0);f&&d&&d.sddActiveSearch&&d.sddZipcode&&(c=this.pwa.session.isCANADA?
d.sddZipcode.slice(0,3):d.sddZipcode,Object.assign(b,{removeInStock:"&removeInStock=true",sddZipParam:`&isSDDChecked=true&sddAttr=13_1&sddAttribute=13_1&sddZip=${c}`,storeOnlyParam:`&storeOnlyProducts=false&storeId=${d.storeId}`}));d&&d.storeId&&(d.storeOnly?Object.assign(b,{removeInStock:"&removeInStock=true",storeOnlyParam:`&storeOnlyProducts=true&storeId=${d.storeId}`}):Object.assign(b,{storeOnlyParam:`&storeOnlyProducts=false&storeId=${d.storeId}`}));/removeInStock=true/.test(location.search)&&
Object.assign(b,{removeInStock:"&removeInStock=true"});this.ampSetStateBeforeRender(a,"apiUrl",b);this.ampSetStateBeforeRender(a,"changeStore",d);c=a.find("#prodListSrc").attr("expression");this.ampBeforeRenderBindEval(a,"[data-prod-list-src]","src",{apiUrl:b,storeId:d.storeId,changeStore:d},c);this.pwa.desktop.ampBeforeRenderPlp(a);this.pwa.desktop.isDesktop&&a.find("#plpListInner")[0].removeAttribute("[hidden]")}}ampBeforeRenderBindingSync(a){if(this.pwa.session.boundAttrsAll&&this.pwa.session.boundAttrsAll.length||
this.pwa.session.boundAttrsDiv){var b=this.pwa.session.docObjActive;if(this.pwa.session.boundAttrsDiv)var c=$(this.pwa.session.boundAttrsDiv);else c=$(`<div id="peerAmpDocBindings" data-doc-num="${b.docnum}" class="hide"><div>`),this.pwa.session.boundAttrsAll.forEach(d=>{try{let f=d.id;f&&a.find(`#${f}`).length||c.append(d)}catch(f){}});a[0].insertAdjacentHTML("beforeend",c.outerHTML());this.pwa.session.boundAttrsAll=[];this.pwa.session.boundAttrsDiv=null}}async ampBeforeRenderReplaceSearchTerm(a,
b){if(a&&b){var c=this.pwa.session.searchTemplateTerm,d=a.find("body");d.length||(d=a.closest("body"));d.hasClass("store_s_comforter")&&(c=this.pwa.session.searchTemplateTerm="comforter");if(d.hasClass(`store_s_${c}`)){var f=new RegExp(c,"gi"),g=(n,q,t)=>{try{n[q]=n[q].replace(f,t)}catch(v){if(11==n.parentNode.nodeType){const z=document.createElement("span");n.parentNode.insertBefore(z,n);z.appendChild(n);n[q]=n[q].replace(f,t)}}};if(b=/^\/store\/s\/([^\/]+)/i.exec(decodeURIComponent(b).replace(/"|'/gi,
"-").replace(/_/gi,'"'))){var h=b[1];$(this.pwa.$$$(a[0],'[data-search-replace="href"]')).each((n,q)=>g(q,"outerHTML",h.replace(/"/gi,"_")));var k=h.replace(/-/gi," ");$(this.pwa.$$$(a[0],'[data-search-replace="text"]')).each((n,q)=>g(q,"outerHTML",k));var l=encodeURIComponent(k);$(this.pwa.$$$(a[0],'[data-search-replace="src"]')).each((n,q)=>g(q,"outerHTML",l));var m=new RegExp(`\\?keyword=${c}`,"gi");a.find("#plpTemplate").each((n,q)=>{q.innerHTML=q.innerHTML.replace(m,`?keyword=${l}`)});var p=
this.pwa.util.attrEncode(h);$(this.pwa.$$$(a[0],'[data-search-replace="attr"]')).each((n,q)=>g(q,"outerHTML",p));a.find("head").find('meta[name="description"], meta[property="og:description"]').attr("content",`Shop for ${p} at Bed Bath &amp; Beyond. Shop online or in-store at Bed Bath & Beyond for the best ${p} products! Plus, create a wish list with a wedding or gift registry. Shop now!`)}}}}ampBeforeRenderSeo(a){this.pwa.session.features.bodyStructuredData&&($("body").find("#schemaGraph").remove(),
$("body").append(a.find("#schemaGraph").remove()))}ampBeforeRenderStorageSync(a){["sessionStorage","localStorage"].map(async b=>{let c=`amp_${b}`,d=this.pwa.session[c];if(0==Object.keys(d).length){try{d=JSON.parse(window[b].getItem(c))}catch(f){}d&&(this.pwa.session[c]=d)}if(d)for(const [f,g]of Object.entries(d))this.ampSetStateBeforeRender(a,f,g)})}async ampBeforeUnload(a){const b=this.pwa.session.docObjActive;if(b){var c=b.shadowBody;if(c){var d=b.docnum,f=c.querySelector("#peerAmpDocBindings");
f&&f.getAttribute("data-doc-num")==a.docnum&&!this.pwa.session.popStateInProgress&&(f.remove(),f=null);d!==a.docnum?(a="class controls disabled hidden is-layout-container max min height href selected slide src text type value width".split(" ").map(g=>`[\\[${g}\\]]`).join(",")+", amp-bind-macro, [data-amp-bind-checked], #reviewFilters",a=[$('<template id="emptyTemplate" type="amp-mustache"></template>')[0]].concat(Array.from(c.querySelectorAll(a))),a=a.filter(g=>!g.closest("#peerAmpDocBindings")&&
!g.closest("#headerWrap")&&!g.closest(".offersWrap")&&!g.closest("#wm_footer")),a=a.map(g=>{g=g.cloneNode("false");g.setAttribute("hidden",!0);"AMP-LIST"==g.tagName&&(g.removeAttribute("is-layout-container"),g.removeAttribute("i-amphtml-layout"),g.removeAttribute("class"),g.setAttribute("template","emptyTemplate"),g.setAttribute("layout","fixed-height"),g.setAttribute("height","1px"));g.innerHTML="";return g}),this.pwa.session.boundAttrsAll=a):d==a.docnum&&f&&(this.pwa.session.boundAttrsDiv=f);this.pwa.session.pdpBreadcrumb&&
(this.pwa.session.pdpBreadcrumb=[]);try{if(this.pwa.session.docTests.isPLPReg.test(b.href)||this.pwa.session.docTests.isSearchReg.test(b.href))this.pwa.session.pdpBreadcrumb=this.pwa.plp.getPlpBreadcrumbs(c)}catch(g){console.warn("Unable to parse breadcrumbs. Default to PDP breadcrumbs")}await this.ampStoreAmpStates();await this.pwa.user.ampBeforeUnload()}}}ampElementLayoutNudge(a){if(a&&!a.hasAttribute("data-no-nudge")&&a.__AMP__RESOURCE&&a.__AMP__RESOURCE.isLayoutPending&&a.__AMP__RESOURCE.isLayoutPending()&&
a.__AMP__RESOURCE.startLayout)try{a.__AMP__RESOURCE.layoutScheduled(Date.now),a.__AMP__RESOURCE.startLayout(Date.now).catch()}catch(b){console.error("Unable to start layout on AMP element\n",a,b)}}async ampListLayoutNudge(a,b){if(0<b.intersectionRatio){function d(f,g){return function(){$(f).hasClass("i-amphtml-layout")||g.amp.ampElementLayoutNudge(f[0])}}var c=$(b.target);if(!c.hasClass("i-amphtml-layout"))return c=d(c,a),setTimeout(c,700),a.intersectHandlerUnregister("listNudge",b.target)}}ampImgLoadCheck(a,
b){const c=b.target;if(c.classList.contains("i-amphtml-layout"))return a.intersectHandlerUnregister("wmNudge",c);0!=b.intersectionRatio&&(a.intersectHandlerUnregister("wmNudge",c),a.amp.ampElementLayoutNudge(c))}async ampListPostRender(a){function b(l){const {googRetailSearchAttributionToken:m}=window.sessionStorage;try{let p=c.closest("body");const n=JSON.parse(p.find(l).text());m?(n.extraUrlParams.searchAttributionToken=m,n.extraUrlParams.experiments[0].experimentVariant="google"):(delete n.extraUrlParams.searchAttributionToken,
n.extraUrlParams.experiments[0].experimentVariant="groupby");p.find(l).text(JSON.stringify(n))}catch(p){console.error(p)}}const c=$(a);this.pwa.site.formPwaHandlerOnly(c);this.ampScrollToHandlersRegister(a);this.pwa.intersectHandlersRegister("wmPrefetch",a,"a[data-prefetch]",this.pwa.prefetch.prefetchHandlerDelay);this.pwa.dataEventHandlerRegister(c);(c.is(".pencilBannerAL")||c.is("#pencilBannerAL"))&&c.find("#pencilBannerWrap > :first-child").append('<button\n          class="pwaOnly vp05 gp05 absolute flex midCtr borderNone btn pencilBannerClose modalCloseJs"\n          aria-label="Close Marketing Banner"\n        >\n          <svg class="wi wiClose noTap">\n            <use xlink:href="#wiClose"></use>\n          </svg>\n        </button>');
c.is("#navCategoriesBar")&&(this.pwa.navPanel.navDskCategoryDragScrollRegister(c),/googlebot/i.test(navigator.userAgent)&&this.pwa.navPanel.botNavRender(c));if(c.is(".navLayer2List.catNav")&&c.closest("body").hasClass("navV4")&&!this.pwa.desktop.isDesktop){const l=c.find(".nav2Col");l.find(".nav2Col a").each((m,p)=>{/shop all/i.test(p.innerText)&&(p.querySelector("svg")||$(p).append('<svg class="gl1 wi wiArrow noTap dskWHide">\n                <use xlink:href="#arrow"></use>\n              </svg>'),
l.find(".navBack").before(p))})}c.is("#alStoreStockResults")&&4>c.find(".ssItm").length&&c.find(".showAllCont").remove();if(this.pwa.session.features.registryEnable&&c.is("#navLayer2List")&&this.pwa.user.hasRegistry)try{c.find("#registryNav").html(this.pwa.registry.registryNav.innerHtml)}catch(l){console.warn(`Error adding registry nav. Error: ${l}`)}c.is("#topProdList")&&c.find(".topProdHead").each((l,m)=>{l=$(m);m=l.text();const p=m.match(/>\s([a-z0-9\s]*)"$/i);p&&l.text(m.replace(/".*"/,`"${p[1]}"`))});
c.is(".sizesList")&&c.find(".sizeLabel").each((l,m)=>{l=$(m);l.html(l.text().replace(/&amp;/gi,"&"))});if(c.is("#reviewsFull")&&!a.io)a.io=new IntersectionObserver(l=>{for(let m of l)1==m.intersectionRatio&&$(m.target).trigger("click")},{root:$("#reviewsSection")[0],rootMargin:"0px 0px 100% 0px",threshold:1}),c.find("#reviewsLoadMore").each((l,m)=>{a.io.observe(m)});else{c.is("#childProdsList")&&(this.pwa.session.lastChildId=c.find(".cProdCardList").last().attr("id"),this.pwa.session.isPdpV21&&c.find("#cProdShowMore").addClass("t4 d3"));
this.pwa.session.isPdpV21&&c.is(".cProdCardList")&&c.closest("#childProdsList").find(".cProdCardList").eq(0).find(".cProdCard").removeClass("dskBorderTop");if(this.pwa.session.lastChildId&&c.is(`#${this.pwa.session.lastChildId}`)){delete this.pwa.session.lastChildId;this.pwa.pdp.collectionAmpToPwa(c);var d=c.closest(".cProdsWrap");let l=d.height();try{let m=parseInt((d.css("maxHeight")||"").replace("px",""));m&&l<m&&c.closest("#childProdsList").find("#cProdShowMore").attr("hidden","true");this.pwa.session.ampStateUnstable=
!1}catch(m){console.warn(`Unable to parse list height. Error: ${m}`)}}if(c.is("#qnaModalListMain")&&!a.io)a.io=new IntersectionObserver(l=>{for(let m of l)1==m.intersectionRatio&&$(m.target).trigger("click")},{root:$("#qaMain")[0],rootMargin:"0px 0px 100% 0px",threshold:1}),c.find("#qaLoadMore").each((l,m)=>{a.io.observe(m)});else if(c.is("#csModalList")){if(this.pwa.util.isDesktop()){var f=c.find("[data-interact]");const l=this.pwa.site.handleAmpAction.bind(this.pwa,1024);f.each(function(){let m=
$(this).attr("data-interact");m&&this.addEventListener(m,l)})}this.pwa.college.ampListPostRenderCollege(c)}else if(c.is("#plpBopisSddList"))c.closest("body").is(".plp")&&c.find(".pickUpDisabled").length&&c.addClass("plpBopisSddListExt"),c.find(".pickUpDisabled").length?c.closest("body").find(".storeFilter").addClass("storeFilterExt"):c.closest("body").find(".storeFilter").removeClass("storeFilterExt"),this.pwa.college.ampListPostRenderCollege(c);else if(c.is("#plpPills"))this.pwa.site.socialAnnexPosition(),
f=await this.pwa.amp.ampGetState("changeStore"),f.storeOnly&&c.find(".plpBopisPill").removeClass("hide"),f.sddActive&&c.find(".plpSddPill").removeClass("hide");else if(c.is("#prodPhotoSkuSelUpdate")&&!c.closest("body").hasClass("quickView"))this.pwa.desktop.addProdSlideNumb(c,5);else{if(c.is("#searchSuggestions"))return this.pwa.sayt.topProductsRender(c);if(c.is(".prodFulfillmentList, .prodFulfillmentList2")){d=c.closest("body");this.pwa.site.showHideKlarna(d);d=!!$("body #modalCartWrap").length;
this.pwa.site.toggleBeaconDisabledFlag("#groupByViewProduct script",d?"disable":"enable");this.pwa.session.isHARMON&&(d=c.find(".shopListBtn").parent(),this.pwa.session.features.pdpShoppingList||this.pwa.session.features.siteRegistry||(c.height(c.height()-d.height()),d.addClass("wHide")));b("#groupByViewProduct script");try{this.pwa.pdp.updateStructuredData()}catch(l){console.log(l)}}if(c.is("#csBannerList")){if(!this.pwa.session.ampStateUnstable){var [g,h]=await Promise.all([this.ampGetState("changeStore"),
this.ampGetState("storeInfo")]);if(h&&(window.wmLocationSync&&window.wmLocationSync(!1,h),g)){try{f=h.data.store.storeId,g.storeId!==f&&this.ampsSetState({changeStore:{storeId:f}})}catch(l){}try{var k=h.data.sddData.storeIds[0];g.sddStoreId!==k&&this.ampsSetState({changeStore:{sddStoreId:k}})}catch(l){}await this.ampStoreAmpStates()}}}else if(f=this.pwa.session,c.is("#resultsCountList"))1==f.pendingProdListHistoryUpdate&&(k=await this.pwa.site.getFacetURL(),history.pushState("",document.title,k),
this.pwa.site.redirectUrlSet(),delete f.pendingProdListHistoryUpdate),f=await this.pwa.amp.ampGetState("prodList"),this.pwa.session.docTests.isSearchReg.test(location.pathname)&&this.pwa.modifyCbccSearch(c,f),f&&f.fusion&&f.fusion.redirect&&this.pwa.load(f.fusion.redirect[0]),f&&f.response&&0==f.response.numFound&&c.closest("#wm_content").addClass("noResults"),k=await this.ampGetState("apiUrl"),24<k.perPage&&c.find(".resultCount").text(` Showing ${f.response.start||1} - ${(f.response.start/k.perPage+
1)*k.perPage<f.response.numFound?(f.response.start/k.perPage+1)*k.perPage:f.response.numFound.toLocaleString()} of ${f.response.numFound.toLocaleString()} products`);else if(c.is("#plpListInner")){f=c.find(".prodImg amp-img:not(.altImg)");const l=c.find(".prodImg .altImg");this.pwa.desktop.isDesktop&&f.each((m,p)=>{m=$(p);let n=m.closest(".prodCardL");const q=m.attr("data-prod-id");Array.from(l).filter(t=>t.getAttribute("data-prod-id")==q)[0]?(n[0].addEventListener("mouseenter",function(t,v){t.classList.add("hide")}.bind(this,
p)),n[0].addEventListener("mouseleave",t=>{p.classList.remove("hide")})):(n[0].addEventListener("mouseenter",function(t){t=$(t.currentTarget).find(".prodCardImg, amp-img").eq(0);let v=t.attr("data-alt-img-src-id");v&&t.find("img").attr("srcset",`
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=177&hei=177 177w,
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=236&hei=236 236w,
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=363&hei=363 363w
                    `)}.bind(this)),n[0].addEventListener("mouseleave",t=>{t=$(t.currentTarget).find(".prodCardImg, amp-img").eq(0);let v=t.attr("data-img-src-id");v&&t.find("img").attr("srcset",`
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=177&hei=177 177w,
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=236&hei=236 236w,
                    https://b3h2.scene7.com/is/image/BedBathandBeyond/${v}?$imagePLP$&wid=363&hei=363 363w
                    `)}))});b("#groupByAMPAnalytics script");this.pwa.site.tealiumPlpCardEvents(c);this.plpSameDayDeliveryListUpdate(c);this.pwa.site.socialAnnexPosition();c.find("amp-ad").each((m,p)=>{this.pwa.util.elemAttrEvent(p,"style",this.pwa.site.socialAnnexPosition.bind(this))});k=await this.pwa.amp.ampGetState("apiUrl");f=await this.pwa.amp.ampGetState("prodList");/googlebot/i.test(navigator.userAgent)&&(results.numFound<k.perPage&&c.closest("#wm_content").find("#nextPage, #prevPage").remove(),
(k.page+1)*k.perPage>results.numFound&&c.closest("#wm_content").find("#nextPage").remove(),0==k.page&&c.closest("#wm_content").find("#prevPage").remove());k=new URL(location.href);d=/prodCard([0-9]+)/;-1<k.hash.search(d)&&(k=d.exec(k.hash))&&1<k.length&&this.pwa.util.plpScrollByProdId(k[1],this.pwa.session.docs.primary.shadowDoc.ampdoc);this.pwa.plp.facetedPlpSeo();f.relatedSearches&&f.relatedSearches.canonicalUrl&&$('head link[rel="canonical"]').attr("href",location.origin+f.relatedSearches.canonicalUrl);
(f=f.response.searchAttributionToken)?(window.sessionStorage.setItem("googRetailexperimentId","s4r_bbby_abtest"),window.sessionStorage.setItem("googRetailSearchAttributionToken",f)):(window.sessionStorage.removeItem("googRetailexperimentId"),window.sessionStorage.removeItem("googRetailSearchAttributionToken"));b("#groupByAMPAnalytics script");setTimeout(this.pwa.amp.ampsAmpStateIsStableEvt.bind(this),500);/type=pickItModal/.test(document.location.search)&&this.pwa.pickItModal.scrollPlp(c);if(this.pwa.session.features.registryEnable&&
this.pwa.user.hasRegistry&&this.pwa.registry.renderCtaMenuFlag&&this.pwa.registry.registryCta.data.data){delete this.pwa.registry.renderCtaMenuFlag;f=(new URL(location.href)).searchParams;let m=f.get("prodId")||"",p=f.get("skuId")||"";/\?/.test(p)&&(p=p.replace(/\?.*/,""));f=c.find("[data-prod-reg]").filter((n,q)=>{n=JSON.parse($(q).attr("data-prod-reg"));return n.prodId==m&&n.skuId==p});this.pwa.registry.registryCta.data.data.registryList&&1<this.pwa.registry.registryCta.data.data.registryList.length?
this.pwa.registry.registryCtaMenuRender(f,!0):this.pwa.registry.registryCta.data.data.activeRegistry&&this.pwa.registry.registryItemAddedModalRender(this.pwa.registry.registryCta.data.data.activeRegistry.registryId,f)}this.pwa.college.ampListPostRenderCollege(c)}else if(c.is("#relatedSearchesVisualFacetsList")&&c.find(".rsLinks").each((l,m)=>{l=$(m);void 0==l.attr("href")&&(m=l.attr("data-text"),m||(m=l.text()||"",m=m.trim(),m=m.slice(0,m.lastIndexOf(","))),m||l.addClass("hide"),l.attr("href",`${location.origin}/store/s/${encodeURI(m.split(" ").join("-"))}?relatedsearch=true`))}),
c.is("#prodPhotoUpdate"))0==c.find(".prodSlide").length&&"wmHostPdp"==wmPwa.session.docObjActive.hostElem.id&&this.ampsSetState({random:Math.random()});else if(c.is("#searchTitleList")){const [l,m]=await Promise.all([this.ampGetState("apiUrl"),this.ampGetState("prodList")]);f=m.response.numFound;0==f?c.closest("#wm_content").addClass("noResults"):0<f&&c.closest("#wm_content").removeClass("noResults");/"|'/gi.test(decodeURIComponent(location.pathname))&&m.fusion.q==m.fusion.org_q&&(k=/\/store\/s\/([^\/]+)/i.exec(location.pathname),
1<k.length&&c.find(".catTitle").html(`&ldquo;${decodeURIComponent(k[1].replace(/-/gi," "))}&rdquo;`));24<l.perPage&&c.find(".sCatCt").text("0"===f?"NO RESULTS FOR":`${f.toLocaleString()} SEARCH RESULT${1<f?"S":""} FOR`);this.pwa.session.docTests.isSearchReg.test(location.pathname)&&(this.pwa.site.recentSearchDataUpdate(),this.pwa.modifyCbccSearch(c,m))}else{if(c.is("#prodDeliverZipList"))return this.pdpSameDayDeliveryListUpdate(c);if(c.is("[id^='recommendationsList']")){c.attr("id");f=$(c).find("[data-prodId][data-Rank]");
if(0<f.length){let l=new IntersectionObserver(function(m,p){m.forEach(n=>{n.isIntersecting&&!n.target.hasAttribute("data-tealiumFired")&&(wmPwa.pwa.session.recomended||(wmPwa.pwa.session.recomended={},wmPwa.pwa.session.recomended.type=n.target.closest("[id^='recommendationsList']").id,wmPwa.pwa.session.recomended.product_displayed="",wmPwa.pwa.session.recomended.epic_rank=""),n.target.setAttribute("data-tealiumFired","true"),wmPwa.pwa.session.recomended.product_displayed+=n.target.getAttribute("data-prodId")+
",",wmPwa.pwa.session.recomended.epic_rank+=n.target.getAttribute("data-rank")+",")});wmPwa.pwa.session.recomended&&wmPwa.util.debounce(function(){if(wmPwa.pwa.session.recomended)if(wmPwa.pwa.session.recomended.product_displayed=wmPwa.pwa.session.recomended.product_displayed.replace(/,\s*$/,""),wmPwa.pwa.session.recomended.epic_rank=wmPwa.pwa.session.recomended.epic_rank.replace(/,\s*$/,""),/LoveThese/.test(wmPwa.pwa.session.recomended.type)){delete wmPwa.pwa.session.recomended.type;try{pdpCertlikeThisLoveThis(wmPwa.pwa.session.recomended)}catch(n){}}else{delete wmPwa.pwa.session.recomended.type;
try{pdpCertYouMayAlsoLike(wmPwa.pwa.session.recomended)}catch(n){}}delete wmPwa.pwa.session.recomended},750)()},{root:null,threshold:0});f.each(function(m,p){l.observe(p)})}f=c.find(".x-amp-sacrifice").length?"x-amp-sacrifice":"amp-sacrifice";this.pwa.paginatedSlider.init(c,{cardClass:f})}else{if(c.is("#justForYouList, #prodYouMightLikeList, #recentlyViewedList, #trendingProductsList, #relatedCatsList, .recommendationsList"))return f=c.find(".x-amp-sacrifice").length?"x-amp-sacrifice":"amp-sacrifice",
this.pwa.paginatedSlider.init(c,{cardClass:f});if(c.is("#reviewOverviewPhotos, #reviewOverviewThumbs"))return f=c.find(".x-amp-sacrifice").length?"x-amp-sacrifice":"amp-sacrifice",this.pwa.paginatedSlider.init(c,{cardClass:f,cardsVisible:6});if(c.is(".modProdCarousel"))return c.find(".x-amp-sacrifice"),f=c.closest(".modProductCarousel").hasClass("viewV5"),this.pwa.paginatedSlider.init(c,{cardClass:"amp-sacrifice",cardsVisible:f?4:6});this.pwa.college.ampListPostRenderCollege(c);await this.pwa.personalize.ampListPostRenderPersonalize(c);
(f=await this.pwa.user.ampListPostRenderUser(c))||(f=await this.pwa.pdp.ampListPostRenderPdp(c))}}}}}async ampLoad(a,b){var c=this.pwa.session,d=null;const f=b.searchParams.get("wmPwa");b.searchParams.delete("wmPwa");b.searchParams.delete("web3feo");b.searchParams.delete("AppShellId");b.searchParams.delete("wmDebug");var g=c.docTests.isPLPReg&&c.docTests.isPLPReg.test(b.pathname),h=c.docTests.isBrandReg&&c.docTests.isBrandReg.test(b.pathname);!g&&!h||this.pwa.session.docTests.isCLPReg.test(b.pathname)?
c.docTests.isPDPReg&&c.docTests.isPDPReg.test(b.pathname)&&(b.pathname.endsWith("/")&&(b.pathname=b.pathname.replace(/\/$/,"")),b.searchParams.has("skuId")&&(d=b.searchParams.get("skuId"),b.searchParams.delete("skuId"))):(c.parsedURL=this.pwa.site.parseURL(b),c.parsedURL.basePath!=c.parsedURL.fullUrl&&(b.pathname=c.parsedURL.basePath));try{var k=localStorage.getItem("recentlyViewed")}catch(n){}k&&this.pwa.util.cookieSet("recentlyViewed",encodeURIComponent(k),null,"/",location.hostname.replace(/^.*?\./,
"."));let l;h=c.docTests.isSearchReg;g=new Promise((n,q)=>n());h&&h.test(b.pathname)&&(l=b.pathname,b.searchParams.set("wmDoNotQueue",1),g=fetch(`${b.origin}${b.pathname}?wmSkipPwa`,{method:"HEAD"}));h=setTimeout(()=>{this.pwa.loadErrorHandler(b.href,"AMP URL did not fetch in time",!0)},this.pwa.session.isPreprod||this.pwa.session.isDebug?9E4:8E3);k=this.pwa.session.docPrefetch||fetch(this.ampUrl(b),{method:"GET",credentials:"include",mode:"no-cors"});const [m,p]=await Promise.all([g,k]);clearTimeout(h);
if(m&&m.redirected)throw this.pwa.errorCustom("wompRedirect",m.url.replace(/wmSkipPwa/gi,""));b.searchParams.delete("wmDoNotQueue");null!==f&&(b.searchParams.set("wmPwa",f),b.searchParams.set("wmDebug",f));c.docTests.isPLPReg&&c.docTests.isPLPReg.test(b.pathname)&&!c.docTests.isCLPReg.test(b.pathname)&&c.parsedURL?b.pathname=c.parsedURL.fullPath:c.docTests.isPDPReg.test(b.pathname)&&d&&b.searchParams.set("skuId",d);c=await this.ampValidateResponse(p,b);this.pwa.session.docPrefetch=null;c=this.ampValidateResponseDoc(c,
b);await this.ampBeforeRender(c,b,l,d);this.pwa.session.sessionConfirmationPrefetch&&(d=await this.pwa.session.sessionConfirmationPrefetch,d.err||this.pwa.user.sessionConfirmationHeadersGetOrSet(d),delete this.pwa.session.sessionConfirmationPrefetch);await this.ampClearDoc(a);this.ampAttachDoc(a,c,b.href);return a}async ampPostRender(a,b){const c=a.shadowBody,d=$(c);c.addEventListener("click",this.pwa.clickBodyHandler.bind(this.pwa,a));a.shadowBody.addEventListener("blur",this.pwa.blurBodyHandler.bind(this.pwa,
a),!0);this.pwa.dataEventHandlerRegister(d);this.ampEventsNewDomEmitterRegistration(c);d.find("form").each(this.pwa.formSubmitHandlerRegistration.bind(this.pwa));this.ampScrollToHandlersRegister(c);this.pwa.intersectHandlersRegister("wmPrefetch",c,"a[data-prefetch]",this.pwa.prefetch.prefetchHandlerDelay);this.pwa.intersectHandlersRegister("wmNudge",c,"amp-img:not(.i-amphtml-layout), amp-youtube:not(.i-amphtml-layout)",this.ampImgLoadCheck);this.pwa.util.inputsMustMatch(c,"change");a=this.pwa.session.docTests;
let f=`${b.pathname}${b.search}`;d.find("amp-state#navV2Data, amp-state#navV1Data").each((k,l)=>{k=$(l).attr("src");$(l).attr("src",k.replace("baby.bbbyapp",".bbbabyapp"))});this.pwa.paginatedSlider.init(d,{containerClass:"certonaSliderWrap",cardClass:"tealium-product-tile",carouselSelector:".sliderContainer",cardsVisible:5});if(1280<=window.innerWidth){var g=d.find("[data-interact]");const k=this.pwa.site.handleAmpAction.bind(this.pwa,1280);d.outerWidth();g.each(function(){let l=$(this).attr("data-interact");
l&&this.addEventListener(l,k)})}this.pwa.desktop.ampPostRenderAll(d);this.pwa.session.runSiteSpect&&this.pwa.session.siteSpectScripts&&(this.pwa.session.siteSpectScripts.each(k=>{try{if("SCRIPT"==this.pwa.session.siteSpectScripts[k].tagName){if(this.pwa.session.siteSpectScripts[k].hasAttribute("src")){var l=document.createElement("script");l.setAttribute("src",this.pwa.session.siteSpectScripts[k].src);l.setAttribute("data-sitespect","true");l.onload=function(){setTimeout(__preview_history.load,2E3)}}else{l=
document.createElement("script");l.setAttribute("type","text/javascript");l.setAttribute("data-sitespect","true");var m=this.pwa.session.siteSpectScripts[k].innerText;try{l.appendChild(document.createTextNode(m))}catch(p){l.text=m}}c.appendChild(l)}else"LINK"==this.pwa.session.siteSpectScripts[k].tagName&&(l=document.createElement("link"),l.setAttribute("href",this.pwa.session.siteSpectScripts[k].href),l.setAttribute("type","text/css"),l.setAttribute("data-sitespect","true"),l.setAttribute("rel",
"stylesheet"),c.appendChild(l))}catch(p){console.error("Error appending SiteSpect elements. ",p)}}),this.pwa.session.siteSpectScripts=null);b.searchParams.has("quickView")||this.pwa.pencilBanner.ampPostRender(d);if(a.isPLPReg.test(f)){if(/googlebot/i.test(navigator.userAgent)){var h=await this.ampGetState("apiUrl",500);g=0===h.page?null:$(`<a id="prevPage" rel="prev" aria-label="Previous page" class="g1" href="${b.origin+b.pathname.replace(/\/([0-9]+)\-[0-9]+$/,"")}/${h.page}-${h.perPage}/">Prev</a>`);
h=$(`<a id="nextPage" rel="next" aria-label="Next page" class="g1" href="${b.origin+b.pathname.replace(/\/([0-9]+)\-[0-9]+$/,"")}/${h.page+2}-${h.perPage}/">Next</a>`);const k=d.find(".plpPagination");k.find("#plpPagination, #paginationTemplate").remove();k.append(g,h)}d.find(".plpPills, .plpOpts, #facetUpdateList, #dskFacetUpdateList, .plpPagination").on("click",this.pwa.site.tealiumPlpStateManager.bind(this.pwa.site))}d.find("input.searchInput").on("focus",k=>{setTimeout(function(){this.selectionStart=
this.selectionEnd=1E3}.bind(k.target),0)});this.pwa.plp.ampPostRender(d);this.pwa.college.ampPostRenderCollege(d,b);if(768<=window.innerWidth){g=c.querySelectorAll("#cartlink");let k=this.pwa.appshell.loadCartHover.bind(this);g.forEach(l=>{l.addEventListener("mouseenter",k)})}!this.pwa.session.isFast&&(a.isCLPReg.test(f)||a.isPLPReg.test(f)||a.isHomeReg.test(f)||a.isPDPReg.test(f))&&(g="#socialannex",h="0px 0px 10px 0px",a.isPDPReg.test(f)&&(g="#prodDesc",h="0px 0px 0px 0px"),this.pwa.util.runFunctionOnIntersect(d.find(g),
h,this.pwa.site.renderSocialAnnex.bind(this.pwa)));a.isCLPReg.test(f)&&this.pwa.site.checkSeoHeight(d);this.pwa.pdp.ampPostRenderPdp(d,b,f);if(1280<=window.innerWidth&&!d.hasClass("user"))d.find("#header").one("mouseenter",this.pwa.desktop.initAcctState.bind(this));if(wmPwa.session.isCANADA)d.find("#zipInput").on("propertychange input",this.pwa.util.fixCaZipcode);else d.find("#zipInput").on("propertychange input",this.pwa.util.forceNumeric);this.pwa.isFast||this.pwa.util.runFunctionOnIntersect(d.find("#wm_footer"),
"1000px 0px 0px 0px",function(){d.find("#wm_footer > div[id^='bx-campaign']").remove()});this.pwa.session.features.registryEnable&&this.pwa.registry.registryAllRender(d,b)}ampScrollToHandlersRegister(a){$(a.querySelectorAll('[on*="scrollTo"]')).each((b,c)=>{b=$(c);c=b.attr("on");if(c=this.pwa.regExp.scrollTo.exec(c))c=`#${c[1]}`,b.on("click",this.pwa.scrollToHandler.bind(this.pwa,a.closest("body"),c))})}async ampStoreAmpStates(){this.pwa.session.docObjActive.shadowDoc&&await Promise.all(["sessionStorage",
"localStorage"].map(async a=>{let b=`amp_${a}`,c=this.pwa.session[`${b}Ids`];if(c.length){await Promise.all(c.map(async d=>{let f=await this.ampGetState(d,100);void 0!=f&&(this.pwa.session[b]=this.pwa.session[b]||{},this.pwa.session[b][d]=f)}));try{window[a].setItem(b,JSON.stringify(this.pwa.session[b]))}catch(d){}}}))}ampUrl(a){return`${this.pwa.session.ampHost}${a.pathname.replace(this.pwa.regExp.tmAndReg,"-")}${a.search}${a.hash}`}async plpSameDayDeliveryListUpdate(a){try{const b=await this.ampGetState("storeInfo"),
c=new Date;let d=b.data.sddData.displayCutOffTime,f=/am|12pm/i.test(d)?0:12;d=parseInt(d.replace(/\D/gi,""));a.removeClass("beforeCutOff afterCutOff").addClass(c.getHours()<f+d?"beforeCutOff":"afterCutOff");const g=b.data.sddData.sddAfterCutOffTimeMsg,h=b.data.sddData.sddBeforeCutOffTimeMsg;g&&h&&(a.find(".afterCutOff").html(g),a.find(".beforeCutOff").html(h))}catch(b){}}async pdpSameDayDeliveryListUpdate(a){try{const c=await this.ampGetState("storeInfo");if(!c.errMsg){var b=13>(new Date).getHours()?
c.data.sddData.sddBeforeCutOffTimeMsg:c.data.sddData.sddAfterCutOffTimeMsg;a.find('[data-amp-bind-hidden="storeInfo.data.sddData.sddMsgAmp"]').html(b)}}catch(c){console.warn(`Error updating SDD delivery message. Error: ${c}`)}}}
class Analytics{constructor(a){this.pwa=a}async getLtlData({prodId:a,skuId:b}){try{await this.pwa.util.waitForProp("pdpDataAbstraction",this.pwa);const c=this.pwa.session.docTests.isPDPReg.test(location.pathname),d=c?await this.pwa.pdpDataAbstraction.getSkuDetails():await this.pwa.plp.getPlpItemData(a);if(d&&(d.LTL_FLAG_boolean||d.LTL_FLAG)){const f=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/cart/shipping/ltl-options?skuId=${c?b:d.SKU_ID[0]}&locale=en`,{credentials:"include",
method:"GET",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});return{ltlShipMethod:f.data.atgResponse[0].shipMethodId,level_of_service:f.data.atgResponse[0].shipMethodDescription}}}catch(c){console.log(`analytics.getLtlData error getting the LTL Boolean Flag. Error: ${c}`)}return{}}}
class Appshell{constructor(a){this.elems={html:$("html"),body:$("body"),head:$("head"),loadingOverlay:$("#wmLoading"),modalCartTemplate:$("#modalCartTemplate"),modalHeadsUpTemplate:$("#modalHeadsUpTemplate")};this.writeReviewHtml=null;for(const [b,c]of Object.entries(this.elems))c.length||console.warn(`Required appshell element ${b} not found.`);this.pwa=a;this.pencilHeight=null;this.ampHeaderId="headerWrap";this.pencilObserverId="pencilObserver";this.pencilBannerId="pencilBanner";this.cartModalTmp=
this.pencilMarkup=null}async appshellBeforeRender(a){this.elems.loadingOverlay.addClass(`${a.waitingForPageBuild?"waiting loading":"loading"}`);this.pwa.pencilBanner.appshellBeforeRender();this.elems.head.find('*:not([data-wm="appshell"]):not([custom-element]):not([custom-template]):not([href*="socialannex"])').remove();await this.closeModalsOnNavigation(this.elems.body);this.elems.body.find(".womp-remove").remove();this.pwa.session.currentPrice=0}async appshellEventHandlersRegister(){document.addEventListener("keydown",
b=>{"Escape"==b.key&&(b=$(this.pwa.session.docObjActive.shadowBody).find(".dskNavItem1.active,.navPill.active"),0<b.length&&(b[0].click(),b[0].focus()))});document.addEventListener("blur",b=>{const c=b.target,d=this.pwa.util.formValidateInput(c.validity);c.setAttribute("validity",d);$(b.target.form).addClass("formDirty")},!0);document.addEventListener("submit",async b=>{let c=$(b.target),d=c.attr("data-submit-handler");d&&(this.pwa.dataEventHandlerParseAndCall(d,c,b),b.preventDefault())},!0);window.addEventListener("beforeunload",
b=>{if(/cdn\.ampproject\.org/gi.test(document.referrer)){const c=/cdn\.ampproject\.org\/[v|c]\/s\/(.+)/;try{const d=c.exec(document.referrer);if(1<d.length){let f=new URL(`https://${d[1]}`);f.pathname=f.pathname.replace("/amp","");if(this.pwa.session.docTests.isPLPReg.test(f.pathname)){let g=this.pwa.site.prodIdGet(new URL(location.href));f.hash=`prodCard${g}`;let h=f.searchParams.get("plpPage");window.addEventListener("beforeunload",l=>{if(/cdn\.ampproject\.org/gi.test(document.referrer)){const m=
/cdn\.ampproject\.org\/[v|c]\/s\/(.+)/;try{const p=m.exec(document.referrer);if(1<p.length){let n=new URL(`https://${p[1]}`);n.pathname=n.pathname.replace("/amp","");if(this.pwa.session.docTests.isPLPReg.test(n.pathname)){let q=this.pwa.site.prodIdGet(new URL(location.href));n.hash=`prodCard${q}`;let t=n.searchParams.get("plpPage"),v=n.searchParams.get("plpPerPage");t&&v&&(n.pathname+=`/${t}-${[v]}`)}this.pwa.load(n.toString());l.preventDefault();return l.returnValue="Are you sure you want to return to Google"}}catch(p){console.log(`Unable to parse google amp cache url. Error: ${p}`)}}});
let k=f.searchParams.get("plpPerPage");h&&k&&(f.pathname+=`/${h}-${[k]}`)}this.pwa.load(f.toString());b.preventDefault();return b.returnValue="Are you sure you want to return to Google"}}catch(d){console.log(`Unable to parse google amp cache url. Error: ${d}`)}}});const a=this.pwa.clickBodyHandler.bind(this.pwa);document.addEventListener("click",b=>{let c=$(b.target);a(this.pwa.session.docObjActive,b);if(c.is(".modalCloseJs")){c.hasClass(".modal")?c.remove():c.closest(".modal").remove();try{var d=
this.pwa.session.docObjActive.shadowBody,f=c.attr("data-origin");if(f){let g=$(d).find(`[data-origin="${f}"]`);0<g.length&&g[0].focus()}else if(d&&d.parentNode){let g=d.parentNode.activeElement;g&&g.focus()}}catch(g){console.warn(`AppshellEventsHandlerRegister click event. Unable to return focus to amp Doc. Error: ${g}`)}}0<c.closest("#cartSliderWrap").length&&setTimeout(function(g){g.remove()}.bind(null,$("#modalCartWrap")),300);c.is(".sliderControl")&&this.pwa.paginatedSlider.sliderClick(b);if(/type=addIdeaBoard/gi.test(b.target.href)){b.preventDefault();
d={};f=new URL(b.target.href);for(let [g,h]of f.searchParams.entries())d[g]=h;this.pwa.ideaboard.ideaModalListBoards(d,"addToIdeaBoard",f)}$(b.target).is("#closeCartStickyBtn")&&this.pwa.appshell.closeCartSticky();this.pwa.util.scrollToggle(this.pwa.session.docObjActive,c)})}async appshellPostRender(a,b){1==a.pageLoad&&$("#wmSplash").remove();const c=`${a.waitingForPageBuild?"waiting loading":"loading"}`;a.waitingForPageBuild=!1;this.elems.loadingOverlay.removeClass(c);a=$("body");"wmHostPdp"==b.hostElem.id?
a.addClass("pdpActive"):a.removeClass("pdpActive")}async modalCartRender(a,b){try{$("#modalHeadsUpWrap").remove(),$("#modalCartWrap .modalContent")[0].focus()}catch(d){}if(a.errorMessages&&0<a.errorMessages.length&&/ECB03182|ECB03532|ECB03215|ECB01423|ECB00404/.test(a.errorMessages[0].code)&&!a.isMultiSku&&this.pwa.session.features.cartRecommendationModal&&!this.pwa.session.isHARMON&&(a.cartError=!0,await this.pwa.pickItModal.render(!0,a,b)))return;(async d=>{await this.pwa.util.waitForProp("Mustache");
d.itemQuantity&&(d.qtySelector=this.pwa.cart.createQtyObj(d.itemQuantity),d.qtyOverTen=10<=d.itemQuantity);let f="";Array.from(this.elems.modalCartTemplate[0].content.children).forEach(h=>f+=h.outerHTML);let g=Mustache.render(f,d);this.pwa.appshell.elems.loadingOverlay.removeClass("loading");$("#modalCartWrap").remove();this.elems.body[0].insertAdjacentHTML("beforeend",g);try{d.errorMessages&&d.errorMessages[0]&&d.errorMessages[0].code||d.isMultiSku||!b||this.loadCartModalSlider(b,$("#modalCartWrap .modalCart")),
$("#modalCartWrap .modalCloseJs")[0].focus()}catch(h){console.warn(`Error getting product Id. Error: ${h}`)}})(a);let c=this.pwa.session.docTests.isPLPReg.test(location.pathname)?"plp":"pdp";this.pwa.site.tealiumClickEventEmitter($(`<div data-cta='${c}CartAddModal' data-attribute='${({customerArea:"~~groupByCustomerArea~~",product:{productId:"~~groupBySiteId~~{{PRODUCT_ID}}",title:"{{{DISPLAY_NAME}}}",collection:"~~groupByCollection~~"},experiments:[{experimentId:"s4r_bbby_abtest",experimentVariant:"groupby"}]})}'></div>`)[0],
a);this.sendCartLoadEvent(a)}async cartErrorModal(a,b){if(0==$(this.pwa.session.docObjActive.shadowBody).find(".cartErrorModal").length)return!1;var c="your selected store ";try{c=(await this.pwa.amp.ampGetState("storeInfo")).data.store.commonName}catch(d){}try{let d=a.isPickIt?`pickup at ${c}`:a.isDeliverIt?"same day delivery":"standard shipping";c={u:{storePickupModal:"active",fulfillment:d,changeStoreLocToggle:!0,storePickupModalTitle:`It looks like this item is no longer available for ${d}, but you can still pick it up in store!`,
cartError:!0},changeStore:{onlyAvailableStores:!0,radius:50}};if(this.pwa.session.docTests.isPDPReg.test(location.pathname)){const f=await this.pwa.pdpDataAbstraction.getSkuDetails();delete f.data;c.u.storePickupModalSkuFacets=await this.pwa.amp.ampGetState(`skuFacets${a.prodId}`);c.u.storePickupModalSku=f}else if(this.pwa.session.docTests.isPLPReg.test(location.pathname)){const f=await this.pwa.plp.getPlpItemData(a.prodId);c.u.storePickupModalSkuFacets={qty:"1",skuId:a.cartFormSubmission.addItemResults[0].skuId,
id:a.prodId};f&&(c.u.storePickupModalSku={PRODUCT_IMG_ARRAY:[{imageId:f.scene7imageID,description:f.DISPLAY_NAME}],DISPLAY_NAME:f.DISPLAY_NAME})}this.pwa.appshell.elems.loadingOverlay.removeClass("loading");this.pwa.amp.ampsSetState(c);this.loadCartModalSlider(b,$(window.wmPwa.session.docObjActive.shadowBody).find(".pickItModal .modalContentInner"),{ctaType:d,pagination:!1,removeFirst:!0,cta:!1});return!0}catch(d){console.warn(`Error getting cart error recommendataion data. Error: ${d}`),this.pwa.amp.ampsSetState({u:{storePickupModal:null,
fulfillment:null,storePickupModalSku:null,changeStoreLocToggle:!1,storePickupModalSkuFacets:null,storePickupModalTitle:null,cartError:!1},changeStore:{radius:25}})}return!1}async modalHURender(a,b){try{await this.pwa.util.waitForProp("Mustache");let c="";Array.from(this.elems.modalHeadsUpTemplate[0].content.children).forEach(f=>c+=f.outerHTML);let d=Mustache.render(c,b);this.elems.body[0].insertAdjacentHTML("beforeend",d);$(".modalAddToCartJs").on("click",()=>{this.pwa.site.cartAdd(a,"pickItUp")});
$(".modalCloseJs").on("click",()=>{$("#modalHeadsUpWrap").remove();$(".wmLoading").removeClass("loading")})}catch(c){this.pwa.site.cartAdd(a,"pickItUp")}}async sendCartLoadEvent(a){try{let b=a.cartFormSubmission.addItemResults[0],c={call_to_actiontype:"add to cart modal",channel:"Modal",content_pagetype:"My Account",device_fingerprint:"",feo_site_indicator:"AMP Pages",incognito_mode_indicator:"",landingPageUrl:document.location.href,navigation_path:"My Account",page_function:"My Account",page_name:"add to cart modal",
page_type:"My Account",pagename_breadcrumb:"Add to Cart Flyout",product_id:[(b.prodId||"").toString()],product_pagetype:"",product_sku_id:[(b.skuId||"").toString()],search_engine_used:"Solr",search_keyword:"",search_within_search:"",search_words_applied:"",session_referrer:"",session_referrer_domain:"",sheer_id_indicator:"Not Verified",site_channel:"mobile",subnavigation_path:"My Account"};window.triggerLoadEvent&&window.triggerLoadEvent("dataLayer="+encodeURIComponent(JSON.stringify(c)));let d=new URL(location.href);
d.searchParams.delete("prodId");d.searchParams.delete("skuId");d.searchParams.delete("qty");d.searchParams.delete("type");history.pushState("",document.title,d.toString())}catch(b){console.warn(`Unable to send Cart Modal Load Event. Error: ${b}`)}}async loadCartModalSlider(a,b,c){c=Object.assign({ctaType:null,pagination:!0,removeFirst:!1,cta:!0},c?c:{});try{const [d,f]=await Promise.all(a);this.cartModalTmp=this.cartModalTmp||f||"";d.origin=location.origin;d.session=this.pwa.session;d.productImageUrl=
this.pwa.session.apiInfo.scene7RootUrl;d.encodeItem=function(){return encodeURIComponent(this)};d.products&&0!=d.products.length&&(c.ctaType&&(d.title=c.ctaType),c.removeFirst&&b.find("#cartSlider").remove(),b.append(Mustache.render(this.cartModalTmp,d)),c.cta&&b.find(".cartSliderBtn").each(function(){"Add to Cart"==this.innerText&&this.setAttribute("data-cta","addToCartFromATCModalSlider")}),c.pagination&&this.pwa.paginatedSlider.init(b.find("#cartSlider"),{containerClass:"sliderCont",cardClass:"sliderCard",
carouselSelector:".sliderWrap",scrollContClass:"sliderWrap",cardsVisible:4}),b.find("#cartSlider .cartSliderBtn").attr("data-cta","addToCartFromATCModalSlider"))}catch(d){console.warn(`Error rendering the cart slider markup. Error: ${d}`)}}async fetchAppshellTmp(a,b){let c=void 0;try{c=await (await fetch(`${location.origin}/amp/7865/${a}`)).text();let d=$(c);b&&(0<d.find(`#${b}`).length||d.attr("id")==b)&&(c=0<d.find(`#${b}`).length?d.find(`#${b}`).html():d[0].outerHTML)}catch(d){console.warn(`Issue fetching appshell template. Error: ${d}`)}return c}async fetchCartSliderData(a,
b){if(!a)return[];const c={scheme:"AddToCart_rr",currencyCode:"USD",country:"US",site:this.pwa.session.siteId,products:a,isBrowser:!0,storeId:0,number:12,web3feo:"abc",isGroupby:!0};var d=this.pwa.util.cookieGet("gbi_visitorId");d&&(c.visitorID=d);await this.pwa.util.waitForProp("docObjActive",this.pwa.session);let [f,g]=await Promise.all([this.pwa.amp.ampGetState(`pdpDet${a}`,200),this.pwa.amp.ampGetState("isAccessory",200)]);g=1==g;a=!1;if(!f.errMsg){d=f.data.PRODUCT_DETAILS;c.products=d.PRODUCT_ID;
try{c.parentProductId=d.PARENT_PROD_INFO&&d.PARENT_PROD_INFO[0]&&d.PARENT_PROD_INFO[0].PRODUCT_ID?d.PARENT_PROD_INFO[0].PRODUCT_ID:void 0}catch(l){console.log(`Could not get parentProductId. Error: ${l}`)}!g&&c.parentProductId&&(a=!0);c.parentProductId||(c.parentProductId=d.PRODUCT_ID);g||a||delete c.parentProductId}let h=!1;try{var k=await this.pwa.amp.ampGetState("changeStore");if(h=k.storeOnly||k.sddActive||"deliverIt"==b||"pickItUp"==b||/\/(sddZip-|store-)[0-9a-z]+/i.test(location.pathname))k.sddZipcode&&
(c.sddStore=k.sddStoreId||null,c.sddZipCode=k.sddZipcode),k.storeId&&(c.bopisStore=k.storeId||null,delete c.storeId)}catch(l){console.log(`Unable to set sdd store or bopis store. In slider get data. Error: ${l}`)}c.products=`${this.pwa.session.siteId}_${c.products}`;c.context=c.products;k=null;try{k=await (await fetch(`${this.pwa.session.apiInfo.cartSliderApi}?${this.pwa.site.objToQueryStr(c)}`)).json()}catch(l){console.warn(`Unable to fetch cart slider api data. Error: ${l}`)}try{k.title=g?"Accessorize Your Item":
a?"In This Collection":"You might need...",k.ctaType=b,!a&&!g||k.products||(k.products=k.records.map(l=>l.allMeta)),k.products.forEach(l=>{1==l.SKU_ID.length?h?(l.ctaText="pickItUp"==b?"Pick It Up":"Deliver It",l.ctaUrl=`/store${l.SEO_URL}?type=${b}&qty=1&skuId=${l.SKU_ID[0]}&prodId=${l.PRODUCT_ID}${c.bopisStore?`&storeId=${c.bopisStore}`:c.sddStore?`&sddZipCode=${c.sddZipCode}`:""}`):(l.ctaText="Add to Cart",l.ctaUrl=`/store${l.SEO_URL}?type=cart&qty=1&skuId=${l.SKU_ID[0]}&prodId=${l.PRODUCT_ID}`):
(l.ctaText="Choose Options",l.ctaUrl=`/store${l.SEO_URL}?strategy=${c.scheme}`)})}catch(l){console.warn(`Unable to create CTA buttons for cart slider. Error: ${l}`)}return k}async modalWriteReviewRender(a,b,c,d){let f,g;try{g=`${location.origin}/amp/7865/${this.pwa.session.apiInfo.writeReviewHtml}`}catch(k){console.warn(`Unable to get modal html url from session info. Error: ${k}`),g=`${location.origin}/amp/7865/writeReview-V6.html`}let h={prodImg:b?b:null,title:a?a:null,productId:c,modalId:`${d}Modal`,
formAction:null};try{h.userFirstName=this.pwa.user.ampUserInfo?this.pwa.user.ampUserInfo.data.userFirstName:null,h=Object.assign(h,this.pwa.session.apiInfo[d])}catch(k){console.warn(`Unable to get apiInfo from session. Error: ${k}`)}h[d]=!0;try{null==this.writeReviewHtml&&(this.writeReviewHtml=await (await fetch(g)).text())}catch(k){console.error(`Error fetching writereview modal content. Error: ${k}`);return}try{await this.pwa.util.waitForProp("Mustache"),f=Mustache.render(this.writeReviewHtml,h)}catch(k){console.warn(`Error loading Mustache. Error: ${k}`)}if(0==
$(`#${h.modalId}`).length&&f&&h.formAction){this.elems.body[0].insertAdjacentHTML("beforeend",f);const k=this.pwa.site.formSubmitRouter.bind(this.pwa.site),l=this.validateForm.bind(this);a=$(`#${h.modalId}Form`);this.updateCharacterCount(a[0].getElementsByClassName("formLimitTxt"));this.initFormValidation(a[0]);(b=document.getElementById("fileBtn"))&&b.addEventListener("change",this.pwa.site.handleReviewPhotos,!1);$("#reviewThumbContainer").on("click",this.removePhoto);a.on("submit",function(m){m.preventDefault();
let p=$(m.target);l(m.target)&&k(p)});$(".modalCloseJs").on("click",()=>$(`#${h.modalId}`).remove())}}validateForm(a){let b=!0;a=a.getElementsByClassName("validate");for(let c=0;c<a.length;c+=1){let d=this.validateInputs(a.item(c));b=d?b:d}return b}removePhoto(a){a=a.target;($(a).hasClass("removePhoto")||0<$(a).closest(".removePhoto").length)&&$(a).closest(".thumbContainer").remove()}clearFormValidity(a,b){["invalid",...b].forEach(c=>{a.classList.remove(c)})}addFormValidity(a,b){"valid"!==b&&a.classList.add("invalid");
a.classList.add(b)}updateCharacterCount(a,b){b=Object.assign({bindAttribute:"data-bind-cnt-to",event:"input"},b);for(let d=0;d<a.length;d+=1){let f=a.item(d);var c=f.getAttribute(b.bindAttribute);c=document.getElementById(c);try{let g=c.getAttribute("max-length");c.addEventListener(b.event,h=>{f.textContent=`${h.target.value.length} of ${g} characters`})}catch(g){console.warn(`Unable to set character count binding. Error: ${g}`)}}}validateInputs(a){let b=!0,c="radio"==a.type&&a.parentElement?a.parentElement:
a,d=[];for(let f in a.validity)d.push(f);this.clearFormValidity(c,d);d.forEach(f=>{1==a.validity[f]&&(this.addFormValidity(c,f),b="valid"!==f?!1:!0)});return b}initFormValidation(a,b){const c={text:{event:"focusout",handler:this.validateInputs.bind(this)},email:{event:"focusout",handler:this.validateInputs.bind(this)},checkbox:{event:"change",handler:this.validateInputs.bind(this)},radio:{event:"change",handler:this.validateInputs.bind(this)}},d=Object.assign(c,b);a=a.getElementsByClassName("validate");
for(b=0;b<a.length;b+=1){let f=a.item(b);d.hasOwnProperty(f.type)&&f.addEventListener(d[f.type].event,g=>{d[f.type].handler(g.target)})}}renderReviewFormResponse(a,b){const c=$("#reviewErrorContainer");a.HasErrors?(a.Errors.forEach(d=>{$(c).append(d)}),a.FormErrors.keys.forEach(d=>{}),0<a.Errors.length&&$(c).removeClass("hide")):($("#writeReviewSuccessModal").addClass("active"),b.closest(".writeReviewModal").hide())}async getAmpUserInfo(){try{var a=await this.pwa.amp.ampGetState("user",500);if(a&&
a.data)return a}catch(c){console.warn(`Unable to get ampUserInfo from amp state. Error: ${c}`)}a=`${location.origin}/apis/services/composite/v1.0/amp-user-info`;let b=/bbbyapp/gi.test(location.origin)?`web3feo&__amp_source_origin=${encodeURIComponent(location.origin)}`:`__amp_source_origin=${encodeURIComponent(location.origin)}`;try{return await (await fetch(`${a}?${b}`,{method:"GET",headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"},credentials:"include"})).json()}catch(c){console.warn(`Unable to get amp-user-info. Error: ${c}`)}}renderTemplate(a,
b){const c=document.querySelector(a),d=document.querySelector(b);c&&d||this.pwa.errorCustom(`${a} dom target or ${b} source template not found in appshell.`);c.innerHTML="";c.append(d.content.cloneNode(!0))}async closeModalsOnNavigation(a){a.find(".modal").remove();a.removeClass("modalOpen");this.pwa.session.docObjActive&&((await this.pwa.amp.ampGetState("u",0)).errMsg||this.pwa.amp.ampsSetState({u:null}));return!0}async loadDesktopTemplates(){let a="";if(!this.pwa.appshell.hasOwnProperty("desktopTemplates")||
""===this.pwa.appshell.desktopTemplates){try{a=this.pwa.session.apiInfo.desktopTemplates?`${location.origin}/amp/7865/${this.pwa.session.apiInfo.desktopTemplates}`:`${location.origin}/amp/7865/desktopTempV3.html`}catch(b){console.warn(`Unable to get desktop template url from session info. Error: ${b}`)}try{this.pwa.util.scriptAddMustache();let b=await fetch(a);200==b.status&&(this.pwa.appshell.desktopTemplates=await b.text());return!0}catch(b){return console.warn(`Unable to fetch desktop templates. Error: ${b}`),
!1}}}async loadCartHover(a){function b(){c('<div class="cartOverlay" id="dskCartHover">\n      <p class="cartError error txtCtr">There was an error loading cart items</p>\n    </div>')}function c(h){0<d.find("#dskCartHover").length?d.find("#dskCartHover").replaceWith(h):d.append(h)}if(!(1280>window.innerWidth)){var d=$(a.currentTarget).parent(),f=a="";try{this.pwa.appshell.desktopTemplates||await this.pwa.appshell.loadDesktopTemplates(),await this.pwa.util.waitForProp("Mustache")}catch(h){return console.warn("Unable to load Mustache"),
b(),!1}try{var g=$(this.pwa.appshell.desktopTemplates);a=g.find("#cartHoverTmp").html();f=Mustache.render(a,{});c(f);this.pwa.session.miniCartData||(this.pwa.session.miniCartData=await this.pwa.appshell.getCartData());this.pwa.session.miniCartData.data.hasOwnProperty("emptyMsg")||(this.pwa.session.miniCartData.data.emptyMsg=this.pwa.session.isBABY?"There are no items in the cart":"Your shopping cart is empty.");this.pwa.session.miniCartData.data.atgResponse.Cart.commerceItemVOList.forEach(h=>{/BuyBuyBaby/.test(h.siteIdentifier)?
h.siteIndicator="Baby":/BedBathUS/.test(h.siteIdentifier)?h.siteIndicator="BedBath":/HarmonUS/.test(h.siteIdentifier)&&(h.siteIndicator="Harmon")});f=Mustache.render(a,this.pwa.session.miniCartData);c(f)}catch(h){return console.warn(`Unable to get cart data. Error: ${h}`),b(),!1}}}closeCartHover(a){$(a.target).parent().find("#dskCartHover").remove();return!0}async getCartData(){try{let a=await this.pwa.user.sessionConfirmationHeadersGetOrSet(),b=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/cart/current-order-details?type=mini&arg1=true&web3feo`,
{credentials:"include",method:"GET",headers:Object.assign(a,{"atg-rest-depth":5,ispreview:!1,accept:"application/json, text/plain, */*"})});if(b.data)return b.origin=location.origin,0<b.data.atgResponse.Cart.commerceItemVOList.length&&(b.data.atgResponse.Cart.commerceItemVOList[0].justAdded=!0),b.scene7RootUrl=this.pwa.session.apiInfo.scene7RootUrl,b}catch(a){return console.warn(`Error getting cart data. Error: ${a}`),{}}}async updateCartData(){this.pwa.session.miniCartData=await this.pwa.appshell.getCartData();
return!0}async renderCartSticky(){function a(d){return 0<$("#cartCnt").length?($("#cartCnt").text(d),!0):!1}function b(d){let f=$("#cartSticky");0<f.length?f.replaceWith(d):$("body").append(d);return!0}try{var c=window.sessionStorage.CloseStickyCheckout}catch(d){}if(1024>window.innerWidth||c)return $("#cartSticky").addClass("wHide"),!1;$("#cartSticky").removeClass("wHide");c="";try{let d="0";if(this.pwa.session.miniCartData)d=this.pwa.session.miniCartData.data.atgResponse.Cart.cartItemCount;else{const g=
await this.getAmpUserInfo();g&&g.data.Cart&&(d=g.data.Cart.itemCount)}if("0"==d)return!1;if(0<$("#cartCnt").length)return a(d);c=(this.pwa.appshell.desktopTemplates?$(this.pwa.appshell.desktopTemplates):await this.pwa.appshell.loadDesktopTemplates()?$(this.pwa.appshell.desktopTemplates):null).find("#cartDrawerTmp").html();if(!c)throw"Error loading desktop templates";await this.pwa.util.waitForProp("Mustache");const f=Mustache.render(c,{state:"render sHide tHide",count:d});return b(f)}catch(d){console.warn(`Error loading rendering cart sticky. Error: ${d}`)}return!1}closeCartSticky(){$("#cartSticky").remove();
try{return window.sessionStorage.CloseStickyCheckout=!0,this.pwa.util.cookieSet("CloseStickyCheckout",!0),!0}catch(a){}}addHeaderTagsToAppshell(a){try{let b=a.find("h1,h2,h3").not("header h1,header h2,header h3,.noResultsTitle").clone();if(0<b.length){let c=$("body").find(".headerContainer");0<c.length?c.html(""):(c=$('<div class="headerContainer wHide"></div>'),$("body").append(c));c.append(b)}}catch(b){console.warn(`Unable to create SEO headers in appshell. Error: ${b}`)}}}
class Cart{constructor(a){this.pwa=a}async qtyClick(a,b){let c=b.closest(".qtySelectWrap");try{if(this.removeQtyAlert(b),"10+"==a){let d=c.find("#qtyInput");d.val(10);d.attr("data-blur")||(d.on("blur",f=>{this.tenPlus($(f.target))}),d.attr("data-blur",!0));c.find(".qtySelectBtn").addClass("wHide");c.find(".qtyLabel").removeClass("wHide");d.removeClass("wHide");d[0].focus()}else{if(!this.validateQty(a))throw Error("Invalid Quantity.");c.find("[data-qty-update]").each((f,g)=>{$(g).attr("value")?$(g).val(a):
$(g).text(a)});c.find(".active").removeClass("active");b.addClass("active");c.removeClass("active");const d=await this.submitQtyForm(b);if(d.errorMessages&&0<d.errorMessages.length)throw Error("Unable to update quantity");this.updateCartData(d,b)}}catch(d){this.qtyError(b,d.message)}c.removeClass("active");return!0}qtyToggle(a,b,c){c.preventDefault();this.initQtyClick(b);a=b.parent();a.hasClass("active")?a.removeClass("active"):a.addClass("active");return!0}initQtyClick(a){a=a.closest("#modalCartWrap");
a.attr("data-qtyClick")||(a.on("click",b=>{0==$(b.target).closest(".qtySelectWrap").length&&$(".qtySelectWrap").removeClass("active")}),a.attr("data-qtyClick",!0))}async tenPlus(a){let b=a.val();try{this.removeQtyAlert(a);if(!this.validateQty(b))throw Error("Invalid quantity");a.attr("readonly","readonly");const c=await this.submitQtyForm(a);if(10>b){let d=a.closest(".qtySelectWrap"),f=d.find(".qtySelectBtn");f.find(".cartQtyTxt").text(b);f.removeClass("wHide");d.find("#qtyInput").addClass("wHide");
d.find(".qtyOpt.active").removeClass("active");d.find(`[data-qty="${b}"]`).addClass("active");d.find(".qtyLabel").addClass("wHide")}this.updateCartData(c,a)}catch(c){this.qtyError(a,c.message)}a.removeAttr("readonly")}qtyError(a,b){a.closest(".modalContent").find("#quantityError").text(b).removeClass("wHide")}removeQtyAlert(a){a.closest(".qtyWrap").find(".qtyAlert").remove()}async submitQtyForm(a){let b={};a=a.closest("form");try{if(0==a.length)throw Error("Unable to get qty form");b=this.pwa.util.formToObject(a);
a="";b.commerceItemId&&b.qty&&(a=`updateCartInfoSemiColonSeparated=${encodeURIComponent(b.commerceItemId+"="+b.qty+";")}`);const c=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/cart/item`,{body:a,credentials:"include",method:"PUT",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});if(c.errorMessages&&0<c.errorMessages.length)throw Error(`Error updating quantity. Error: ${c.errorMessages[0].message}`);
this.pwa.session.miniCartData=await this.pwa.appshell.getCartData();b=Object.assign(b,this.pwa.session.miniCartData);try{this.pwa.amp.ampsSetState({user:{data:{Cart:{itemCount:this.pwa.session.miniCartData.data.atgResponse.Cart.cartItemCount}}}}),this.pwa.appshell.renderCartSticky()}catch(d){console.warn("unable to update cart count",d)}}catch(c){throw console.warn(`Cart update error: ${c.message}`),Error("There was a problem updating the item quantity");}return b}async updateCartData(a,b){let c=
b.closest(".modalContent").find("[data-cartDetails-temp]"),d=this.cartDetTemplate;this.removeQtyAlert(b);let f={freeShippingEligible:!1,shipThreshhold:39,shipDiff:0,freeShippingPromo:!1,isShipIt:!1,formatPrice:function(){return this.toFixed(2)},isMultiSku:!1,cartItemCount:1,editQty:!0,scene7Base:this.pwa.session.apiInfo.scene7RootUrl+"/",storeName:a.storeName||null,sddZip:a.sddZip||null};try{await this.pwa.util.waitForProp("Mustache");if(!d){d=$(this.pwa.$$$(this.pwa.appshell.elems.modalCartTemplate[0].content,
"#cartDetailsTemp"));if(!d||0==d.length)throw Error("Unable to find the shipping tempalte for updating cart subtotal");this.cartDetTemplate=d}f.orderPriceInfoDisplayVO={formattedOrderSubTotal:a.data.atgResponse.Cart.orderPriceInfoDisplayVO.formattedTotalAmount};f.cartItemCount=a.data.atgResponse.Cart.orderPriceInfoDisplayVO.itemCount;({skuId:f.skuId,prodId:f.prodId,qty:f.itemQuantity,commerceItemId:f.commerceItemId}=a);let g=parseInt(a.qty||1);f.qtyOver2=1<g;f.commerceItemVOList=a.data.atgResponse.Cart.commerceItemVOList.filter(k=>
k.skuId==a.skuId);f.commerceItemVOList[0].scene7URL=f.commerceItemVOList[0].skuSmallImage;f.qtySelector=this.pwa.cart.createQtyObj(a.itemQuantity);f.qtyOverTen=10<=g;f.isShipIt="cart"==a.type;f.isDeliverIt="deliverIt"==a.type;f.isPickIt="pickItUp"==a.type;"cart"==a.type&&(f.isShipIt=!0,f.shipDiff=a.data.atgResponse.ClosenessQualifier.freeShippingBanner.shippingDifference,f.freeShippingEligible=a.data.atgResponse.ClosenessQualifier.freeShippingBanner.showCongratsFreeShipMsg,f.freeShippingPromo=a.data.atgResponse.ClosenessQualifier.freeShippingBanner.freeShippingPromo);
let h=Mustache.render(d.eq(0).html(),f);c.eq(0).html(h);c.find("#qtyInput").on("blur",k=>{this.tenPlus($(k.target))})}catch(g){return console.warn("Unable to update subtotal"),this.qtyError(b,"Your quantity was updated but there was a problem updating this modal"),!1}return!0}validateQty(a){let b=!0;try{1>parseInt(a)&&(b=!1)}catch(c){b=!1}return b}createQtyObj(a){let b=[];try{let c=parseInt(a);for(a=0;10>a;a+=1){let d=a+1;b.push({qtyVal:`${d}`,selected:c==d})}b[b.length-1].qtyVal+="+"}catch(c){console.warn(`cart.createQtyObj, Error: ${c}`)}return b}}
class College{constructor(a){this.pwa=a;this.favoriteStore=(a=JSON.parse(localStorage.getItem("user")))?a.favoriteStore:"";this.isCollege=this.pwa.session.features.collegePackAndHold&&(a&&a.college?a.college.isCollege:!1);this.regularBopis=!0;this.pickupScheduleModal={};this.init()}async ampBeforeRenderCollege(a,b){if(this.isCollege&&this.pwa.session.collegeAssetsPrefetch){var c=this.pwa.session.docTests.isPDPReg.test(b.pathname);b=this.pwa.session.docTests.isPLPReg.test(b.pathname);if(c||b){var d=
document.createElement("script");d.setAttribute("src","https://cdn.ampproject.org/v0/amp-date-picker-0.1.js");d.setAttribute("async",!1);d.setAttribute("custom-element","amp-date-picker");a.find("head")[0].insertAdjacentHTML("beforeend",'<script async="false" custom-element="amp-date-picker" src="https://cdn.ampproject.org/v0/amp-date-picker-0.1.js">\x3c/script>');await this.pwa.util.waitForProp("template",this.pickupScheduleModal);if("not-found"==this.pickupScheduleModal.template)0==this.isCollege;
else{this.collegeInfoModalRender(a);if(b)try{this.bopisListRender(a)}catch(f){console.warn(`College.bopisListRender: couldn't render the college bopis assets. Error: ${f}`)}if(c)try{await this.fulfillmentMsgRender(a)}catch(f){console.warn(`College.fulfillmentMsgRender: couldn't render the college P&H fullfillment msg. Error: ${f}`)}}}}}ampPostRenderCollege(a,b){}ampDatePickerPostRender(a){a=$(a.target);if(a.is("#mob-date-picker.i-amphtml-built.i-amphtml-layout")){if(1<a.find(".DayPicker_weekHeader_ul").length)return;
let b=a.find(".DayPicker_weekHeader_ul").clone();b.children().each((c,d)=>{d.removeAttribute("style")});b.addClass("flex just vb05");a.find(".CalendarMonth_caption").each((c,d)=>{d.insertAdjacentHTML("afterend",b[0].outerHTML)})}a.is("#dsk-date-picker.i-amphtml-built.i-amphtml-layout")&&(a.find(".DayPickerNavigation_leftButton__horizontal").addClass("pSLeftButton wHide").on("click",this.pickupSchedulerNavButtonClick.bind(this)),a.find(".DayPickerNavigation_rightButton__horizontal").addClass("pSRightButton").on("click",
this.pickupSchedulerNavButtonClick.bind(this)),this.currentSlide=0)}async ampListPostRenderCollege(a){if(a.is("#csModalList")){var b=await this.pwa.amp.ampGetState("changeStore");this.favoriteStore&&this.favoriteStore.isClosest&&b.storeId===this.favoriteStore.storeId&&a.find("#csClosetToCampus").removeClass("hide").addClass("flex")}else if(this.isCollege)if(a.is("#plpBopisSddList")){if(b=a.find("#prodBopisCbPwa"),this.bopisListUpdate({target:b[0]}),b.on("change",this.bopisListUpdate),a.find("#prodSdd").on("change",
this.bopisListClose),(a=this.userCollegeDataGet())&&a.pickupDate){b=new Date(a.pickupDate);let c=/(.*)T/.exec((new Date).toISOString())[1];(new Date(c)).getTime()<=b.getTime()?(this.parseDate(a),await this.pwa.amp.ampsSetState({college:{pickUpMsg:`Pickup on ${a.parsedDate}`,selectedDate:b.toISOString()}})):(a=await this.pwa.amp.ampGetState("user"),a.data.favoriteStore||(b=JSON.parse(localStorage.getItem("user")),a.data.favoriteStore=b.favoriteStore,a.data.college=b.college),delete a.data.favoriteStore.pickupDate,
delete a.data.favoriteStore.email,this.userCollegeDataSet(a,!0))}}else a.is("#collegeBopisList")?(a=a.find("input"),$(a[0]).prop("checked")&&this.bopisListRadioChange({target:a[0]}),$(a[1]).prop("checked")&&this.bopisListRadioChange({target:a[1]}),a.on("change",this.bopisListRadioChange.bind(this))):a.is("#plpListInner")&&(a=a.closest("body").find("#collegeBopisPicker"),a.length&&a.prop("checked")&&this.bopisListRadioChange({target:a[0]}))}bopisListRadioChange(a){a=$(a.target);let b,c=a.closest("body");
if(a.is("#collegeBopis")){this.regularBopis=!0;try{b=`${a.next().children().text()}`}catch(d){b="Ready in 1 hour"}}if(a.is("#collegeBopisPicker"))if(this.regularBopis=!1,this.favoriteStore&&this.favoriteStore.pickupDate)try{b=`${a.next().find(".collegeBopisMsg").text().trim()}`}catch(d){b="Ready in 1 hour"}else b="Pack & Hold";b&&(c.find(".inlineflex .txtGreen").text(b+" at"),c.find("[data-cta='plpProductFindInStore'] .txtGreen").text(b))}bopisListRender(a){let b=a.find("body");b.addClass("college");
b[0].insertAdjacentHTML("beforeend",this.collegeBopisList.template[0].outerHTML);b.find("#plpBopisSddTemplate")[0].insertAdjacentHTML("beforebegin",'<style>\n        .collegeExp.plpBopisSddList {\n          min-height: 200px;\n        }\n        .collegeExp #collegeBopisList {\n          display: block;\n        }\n        .collegeBopisCont {\n          padding-left: 34px;\n        }\n        .collegeBopisLbl > * {\n          height: 24px;\n          vertical-align: middle;\n        }\n        .plpBopisSddList.i-amphtml-layout-size-defined,  #collegeBopisList.i-amphtml-layout-size-defined {\n          overflow: visible!important;\n        }\n        .prodBopis:not(.prodSDD) {\n          width: 92%;\n        }\n        .collegeTtMsg {\n          height: 48px;\n          left: -80px;\n          width: 200px;\n        }\n        \n        @media (min-width: 48rem) and (max-width: 64rem) {\n          .collegeExp.plpBopisSddList {\n            min-height: 144px;\n          }\n        }\n      </style>\n      <amp-state id="college">\n        <script type="application/json">    \n            {\n                "selectedDate": ""\n            }\n        \x3c/script>\n      </amp-state>');
this.pwa.$$$(a[0],".pickItBopus")[0].insertAdjacentHTML("beforeend",'<amp-list \n        binding="always"\n        class="vt05 wHide"\n        height="80px"\n        id="collegeBopisList" \n        items="."\n        layout="fixed-height" \n        single-item\n        src="amp-state:college"\n        [src]="college"\n        template="collegeBopisTemp"\n      >\n      </amp-list>');$(this.pwa.$$$(a[0],'.prodBopisLbl[for="prodBopisCbPwa"]')).find(".freePckup").replaceWith('<span class="green freePckup noTap">FREE Store Pickup</span>')}bopisListClose(a){a=
$(a.target);let b=a.closest("#plpBopisSddList");a.prop("checked")&&b.removeClass("collegeExp")}bopisListUpdate(a){a=$(a.target);let b=a.closest("#plpBopisSddList");a.prop("checked")?b.addClass("collegeExp"):b.removeClass("collegeExp")}collegeHeadModalRender(a){const b=Mustache.render(this.collegeHeadModal.template,{bopisChangeNormal:this.bopisChangeNormal,bopisChangePNH:this.bopisChangePNH||!0});a.find("body")[0].insertAdjacentHTML("beforeend",b)}collegeInfoModalRender(a){const b=Mustache.render(this.collegeInfoModal.template,
{siteId:this.pwa.session.siteId});a.find("body")[0].insertAdjacentHTML("beforeend",b)}closeModal(a,b){b.closest(".modal").removeClass("active")}async collegeListFetchCall(a,b){try{const c=await fetch(`https://api-bbby.bbbyproperties.com/api/cms/v3/content_types/college/entries?query={"college_state":"${a}"}&include_count=true&skip=${b}&limit=100&asc=school_name&locale=en-us`);if(200===c.status)return await c.json()}catch(c){console.warn(`College: collegeListFetchCall. Could not get the list of colleges from CONTENT STACK for state: ${a}. Error: ${c}`)}}async collegeListUpdate(a){var b=
await this.collegeListFetchCall(a,0);let c=b.entries;b=Math.floor(b.count/100);if(0<b)for(i=1;i<=b;i++){const d=await this.collegeListFetchCall(a,100*i);0<d.entries.length&&(c=c.concat(d.entries))}await this.pwa.amp.ampsSetState({schoolNames:c});return!0}createCollegeAnalyticsObj(a){let b;try{const c=JSON.parse(localStorage.getItem("user"))||{},d=c.college||{},f=c.favoriteStore||{};b={isCollege:d.isCollege||!1,email:d.email||"",pickupDate:a.addItemResults[0].reserveDate||f.pickupDate||"",storeId:f.storeId||
"",storeName:f.storeName||""}}catch(c){console.warn(`College.createCollegeAnalyticsObj: Error making analytics obj. Error: ${c}`)}return b}async fulfillmentMsgRender(a){var b=JSON.parse(localStorage.getItem("user"));b=b?b.favoriteStore:{pickupDate:""};this.regularBopis=!b.pickupDate;var c=a.find("body");c.addClass("college");c[0].insertAdjacentHTML("beforeend",this.collegeFulfillList.template[0].outerHTML);b.parsedDate=this.parseDate(b);this.pwa.$$$(a[0],"#first")[0].insertAdjacentHTML("beforeend",
`
      <style>
        #collegeFulfillList .pointer.pointer{
          cursor: pointer;
        }
        #collegeFulfillList .ttMsgWrap{
          bottom: 100%;
          right: 0;
        }
        [option=pickItUp] .skuRollup.bopisMsg {
          text-transform: lowercase;
        }
        [option=pickItUp] .skuRollup.bopisMsg:first-letter {
            text-transform: uppercase;
        }
        .bopisMsg > .switchToRegBopis > * {
          color: #000;
          text-decoration: underline;
          cursor: pointer;
        }
      </style>
      <amp-state id="college">
        <script type="application/json">    
            {
                "selectedDate": "${b.parsedDate||""}",
                "selectedPackHold": ${!this.regularBopis}
            }
        </script>
      </amp-state>
      `);b=$(`
      <amp-list 
        binding="always"
        height="1.2rem"
        class="overflow {{^bopisAvailable}} wHide{{/bopisAvailable}} collegeFulfillList1"
        id="collegeFulfillList" 
        items="."
        layout="fixed-height" 
        single-item
        src="amp-state:college"
        [src]="college"
        template="collegeFulfillTemp"
        [hidden]="!college.selectedPackHold"
        ${this.regularBopis?"hidden":""}
      >
      </amp-list>
    `);c=$(`
      <amp-list 
        binding="always"
        height="1.2rem"
        class="overflow {{^bopisAvailable}} wHide{{/bopisAvailable}}"
        id="collegeFulfillList" 
        items="."
        layout="fixed-height" 
        single-item
        src="amp-state:college"
        [src]="college"
        template="collegeFulfillTemp"
        [hidden]="college.selectedPackHold"
        ${this.regularBopis?"":"hidden"}
      >
      </amp-list>
    `);const d=$(a.find("#prodFulfillTemplate2")[0].content.querySelector("[option=pickItUp] .skuRollup.bopisMsg"));d.before(b);d.after(c);d.html(`
      <span
        class="{{^bopisAvailable}}wHide{{/bopisAvailable}} collegeBopisOr"
        [hidden]="!college.selectedPackHold"
        ${this.regularBopis?"hidden":""}
      >
        Or,
      </span>
      <span
        class="${this.regularBopis?"":"{{#bopisAvailable}}switchToRegBopis{{/bopisAvailable}}"} "
        [class]="college.selectedPackHold ? '{{#bopisAvailable}}switchToRegBopis{{/bopisAvailable}}' : ''"
        on="tap:AMP.setState({college: {selectedPackHold: false}})"
        data-click-handler="college.useRegularBopis(true)"
      >
        ${d.text()}
      </span>`);d.parent().addClass("grow1");this.pwa.$$$(a[0],"amp-list[template=prodFulfillTemplate2]")[0].classList.add("overflow")}async init(){if(this.isCollege&&this.pwa.session.collegeAssetsPrefetch){var a=await Promise.all(this.pwa.session.collegeAssetsPrefetch.concat([this.pwa.util.waitForProp("Mustache")]));[a]=await Promise.all(a.map(async function(b){if(b.type){if("json"==b.type)return await b.res.json();if("html"==b.type)return $(await b.res.text())}}.bind(this)));this.pickupScheduleModal=
{template:a.find("#pickupScheduleModal").html()||"not-found"};this.collegeInfoModal={template:a.find("#collegeInfoModal").html()||""};this.collegeBopisList={template:a.find("#collegeBopisTemp")||{}};this.collegeFulfillList={template:a.find("#collegeFulfillTemp")||{}};this.collegeHeadModal={template:a.find("#collegeHeadsUpModal").html()||""}}}modifyBopisMsg(a){a=a.parent().find(".skuRollup.bopisMsg");a.length&&(/pickup today/.test(a.text())?a.find(".collegeBopisOr").text("Or "):/hour/.test(a.text())?
a.find(".collegeBopisOr").text("Or pickup today, "):a.find(".collegeBopisOr").text("Or, "))}parseDate(a){try{const b=a.pickupDate;a.parsedDate=a.pickupDate&&(new Date(a.pickupDate)).toLocaleDateString("en",{month:"long",day:"numeric"});a.parsedDate&&9<a.parsedDate.length&&(a.parsedDate=(new Date(b)).toLocaleDateString("en",{month:"short",day:"numeric"}))}catch(b){console.log("Problem parsing PH pickup date",b)}return a.parsedDate}async pickupSchedulerCancel(a,b){a=await this.pwa.amp.ampGetState("user");
if(!a.data.favoriteStore){let c=JSON.parse(localStorage.getItem("user"));a.data.favoriteStore=c.favoriteStore;a.data.college=c.college}delete a.data.favoriteStore.pickupDate;delete a.data.favoriteStore.email;b=b.closest(".modal");b.find(".modalContent").removeClass("pSPreSelected");b.find(".pSEmailInput").removeClass("pSLblFocus").val("");this.userCollegeDataSet(a,!0);this.pwa.amp.ampsSetState({college:{pickupModal:!1,pickUpMsg:"Reserve pickup date",selectedDate:""}})}pickupSchedulerDateSelected(a){a=
$(a.target);var b=new Date(a.attr("date"));b=`${"Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ")[b.getDay()]}, ${"January February March April May June July August September October November December".split(" ")[b.getMonth()]} ${b.getUTCDate()}, ${b.getFullYear()}`;/undefined/.test(b)&&(b="Select a date");a.closest("form").find("[data-pickup-date]").text(b).removeClass("pSError")}pickupSchedulerEmailInput(a){a=$(a.target);0==a.val().length?a.removeClass("pSLblFocus"):a.addClass("pSLblFocus")}pickupSchedulerModalRender(a,
b){var c=new Date;let d=new Date;d.setDate(c.getDate()+90);var f=JSON.parse(localStorage.getItem("user"));f=(f=f?f.favoriteStore:"")?f.email:"";c={minDate:c.toISOString(),maxDate:d.toISOString(),siteId:this.pwa.session.siteId,userEmail:f};a=Mustache.render(a,c);b.find("body")[0].insertAdjacentHTML("beforeend",a)}pickupSchedulerModalUpdate(a,b){a.find(".modalContent").addClass("pSPreSelected");b&&a.find(".pSEmailInput").addClass("pSLblFocus").val(b)}pickupSchedulerNavButtonClick(a){a=$(a.target);a.is(".pSRightButton")&&
(this.currentSlide++,a.prev().removeClass("wHide"),2==this.currentSlide&&a.addClass("wHide"));a.is(".pSLeftButton")&&(this.currentSlide--,a.next().removeClass("wHide"),0==this.currentSlide&&a.addClass("wHide"))}async pickupSchedulerSubmit(a,b){var c=b.closest("form");a=this.pwa.util.formToObject(c);if(this.validateEmail(a.email))if(c.find(".pSEmailInput").removeClass("pSError"),""==a.deliverydate)c.find("[data-pickup-date").addClass("pSError");else{c.find("[data-pickup-date").removeClass("pSError");
c=new Date(a.deliverydate);var d=await this.pwa.amp.ampGetState("user");if(d.data.favoriteStore)d.data.favoriteStore.pickupDate=a.deliverydate,d.data.favoriteStore.email=a.email;else{let f=JSON.parse(localStorage.getItem("user"));d.data.favoriteStore={};Object.assign(d.data.favoriteStore,f.favoriteStore,{pickupDate:a.deliverydate,email:a.email});d.data.college=f.college}this.userCollegeDataSet(d,!0);await this.pwa.amp.ampsSetState({college:{pickupModal:!1,pickUpMsg:`Pickup on ${"Jan Feb Mar Apr May June July Aug Sept Oct Nov Dec".split(" ")[c.getMonth()]} ${c.getUTCDate()}`,
selectedDate:c.toISOString()}});a=b.clone();a.attr("data-modal-close",!0);this.pwa.util.scrollToggle(this.pwa.session.docObjActive,a);this.pickupSchedulerModalUpdate(b.closest(".modal"))}else c.find(".pSEmailInput").addClass("pSError")}async setMyStore(a){const [b,c]=await Promise.all([this.pwa.amp.ampGetState("changeStore"),this.pwa.amp.ampGetState("changeCollege")]);a=JSON.parse(a);b.searchMethod&&"college"===b.searchMethod&&"1"===a.index&&this.updateFavoriteStoreHandler(a.storeId);this.pwa.site.tealiumClickEventEmitter($(`<div data-cta="collegeSetStore" data-attribute="{pnh_college_name: '${c.schoolName}' , pnh_store_id: '${b.storeId}'}"></div>`)[0])}userCollegeDataGet(){return this.favoriteStore=
JSON.parse(localStorage.getItem("user")).favoriteStore}userCollegeDataSet(a,b){if(!this.favoriteStore||a.data.favoriteStore.storeId!==this.favoriteStore.storeId||b)localStorage.setItem("user",JSON.stringify({college:a.data.college,favoriteStore:a.data.favoriteStore})),this.userCollegeDataGet()}useRegularBopis(a){this.regularBopis=JSON.parse(a)}async updateFavoriteStoreHandler(a){try{const b=await this.pwa.amp.ampGetState("user"),c=JSON.parse(localStorage.getItem("user"));let d=b.data.favoriteStore?
b.data.favoriteStore:c&&c.favoriteStore?c.favoriteStore:{},f=b.data.college?b.data.college:c&&c.college?c.college:{};Object.assign(d,{storeId:a,isClosest:!0});let g=new Date;g.setDate(g.getDate()+30);Object.assign(f,{isCollege:!0,expires:g.toISOString()});localStorage.setItem("user",JSON.stringify({college:f,favoriteStore:d}));const h=this.userCollegeDataGet();if(!this.pwa.user.ATG_PROFILE_DATA){this.pwa.session.collegeAssetsPrefetch||setTimeout(location.reload.bind(location),250);return}await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/customers/${this.pwa.user.ATG_PROFILE_DATA}/favourite-store/${a}/true`,
{body:{reserveDate:h&&h.pickupDate},credentials:"include",method:"PUT",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())})}catch(b){console.warn(`College: updateFavoriteStoreHandler. Could not update user favorite store. Error: ${b}`)}this.pwa.session.collegeAssetsPrefetch||setTimeout(location.reload.bind(location),250)}validateEmail(a){return a.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}}
class Desktop{constructor(a){this.pwa=a;this.isDesktop=768<=window.innerWidth;this.isResized=!1;window.addEventListener("resize",this.pwa.util.onThrottledBegin(this.onResizeBeginRouter.bind(this),1E3),{passive:!0});window.addEventListener("resize",this.pwa.util.onThrottledEnd(this.onResizeEndRouter.bind(this)),{passive:!0})}openImgModal(){this.pwa.amp.ampsSetState({u:{modalImg:!0}})}ampBeforeRenderPlp(a){this.isDesktop&&(this.plpAdsAmpBindMacroParamUpdate(a),this.plpAdsAmpListParamUpdate(a),a.find("#viewCategory_mobile-BrowseListing").attr("id",
"viewCategory-BrowseListing"),a.find("#viewSearchResult_mobile-SearchListing").attr("id","viewSearchResult-SearchListing"))}ampBeforeRenderPdp(a){this.isDesktop&&(a.find("body.pdpV2").length?(a.find(".childProdWrap").addClass("active listView").removeClass("gridView"),a.find("#childProdsList").removeAttr("hidden"),this.pwa.amp.ampSetStateBeforeRender(a,"childView",{active:!0,view:"list"})):(a.find("#collections").removeClass("accClosed").addClass("accExpanded"),this.pwa.util.toggleHiddenBeforeRender("#collections .accPanel",
a,"u",{collExpanded:!0})),a.find("#viewItem_mobile-PDP").attr("id","viewItem-PDP"),this.pwa.quickView.quickViewLoading||this.pwa.desktop.addProdSlideNumb(a,5),this.pwa.pdpStickyNav.stickyNavBeforeRender(a))}ampPostRenderPdp(a){if(this.isDesktop){this.pwa.pdpStickyNav.stickyNavPostRender(a);(0<a.find(".starterPack").length||a.hasClass("pdpV21"))&&a.addClass("stickyCont");try{0<a.find(".prodSlides21").length&&a.find(".prodSlides21")[0].addEventListener("mouseenter",function(b){this.pwa.imgZoom.init(a,
"#prodSlideCarouselSku")}.bind(this))}catch(b){console.warn(`this.pwa.imgZoom.init Unable to add zoom images. Error: ${b}`)}}}async ampBeforeRenderAll(a){this.isDesktop&&(a.find("body.navV4")||this.initNavConstants(a),this.pwa.session.desktopCssLoaded=!1,await this.ampBeforeRenderDeskCss(a),this.ampAds(a))}ampPostRenderAll(a){this.isDesktop&&(this.pwa.desktop.makeScrollbarGutter(a),this.pwa.navPanel.navMouseleaveListenerRegister(a))}makeScrollbarGutter(a){if(a.length&&window.innerWidth>document.documentElement.clientWidth){let b;
a.each((c,d)=>{b=window.innerWidth-d.clientWidth});b&&($("style[data-scrollbar]").length||$("head").append($(`
        <style data-wm="appshell" data-scrollbar>
          .PWAMP.modalOpen{
            width: calc(100% - ${b}px);
          }
          .PWAMP.modalOpen .sbGutter {
            position: fixed;
            display: block;
            top:0;
            bottom: 0;
            right: 0;
            width: ${b}px;
            height:100vh;
            background: white;
            border-left: 1px solid #E7E7E7;
            z-index: 1000;
          }
        </style>
      `)),a.parent().prepend(`<style data-scrollbar>
            body.modalOpen {
              --scrollbarWidth: calc(100% - ${b}px)
            }
          </style>`),$("body").append('<div class="wHide sbGutter"></div>'))}}async onResizeEndAll(a){await this.ampBeforeRenderDeskCss(a);this.pwa.navPanel.navMouseleaveListenerRegister(a);this.pwa.navPanel.navDskCategoryDragScrollRegister(a.find("#navCategoriesBar"));this.pwa.appshell.renderCartSticky();this.pwa.sayt.topProductsRender(a.find("#searchSuggestions"));$("#sa_s22_instagram, #womp-pp-message").removeClass("invisible");if(this.pwa.session.features.registryEnable)this.pwa.registry.onResizeEnd(a)}onResizeEndHome(a){this.pwa.paginatedSlider.resize(a,
{containerClass:"certonaSliderWrap",cardClass:"tealium-product-tile",carouselSelector:".sliderContainer",cardsVisible:6})}onResizeEndPlp(a){this.plpAdsAmpBindMacroParamUpdate(a);this.pwa.util.positionAppshellElement("div#sa_s22_instagram[data-page-type][data-count]","#socialannex");this.plpDropdownFacetRender(a.find("#dskFacetsList"))}onResizeEndPdp(a){this.pwa.util.positionAppshellElement("#womp-pp-message","#ppPlaceholder");this.pwa.paginatedSlider.resize(a)}onResizeBeginRouter(){$(this.pwa.session.docObjActive.shadowBody).length&&
$("#sa_s22_instagram, #womp-pp-message").addClass("invisible")}onResizeEndRouter(){this.isDesktop=768<=window.innerWidth;this.isResized=!0;const a=this.pwa.session.docTests;for(const c of Object.values(this.pwa.session.docs)){if(!c.href)continue;var b=new URL(c.href);b=`${b.pathname}${b.search}`;const d=$(c.shadowBody);if(a.isHomeReg.test(b))this.onResizeEndHome(d);if(a.isPLPReg.test(b))this.onResizeEndPlp(d);if(a.isPDPReg.test(b))this.onResizeEndPdp(d);this.onResizeEndAll(d)}}plpAdsAmpBindMacroParamUpdate(a){a.find("#prodListSrc").each((b,
c)=>{b=$(c);b.attr("expression",this.plpAdsParamReplace(b.attr("expression")))})}plpAdsAmpListParamUpdate(a){a.find("[data-prod-list-src]").each((b,c)=>{b=$(c);b.attr("src",this.plpAdsParamReplace(b.attr("src")))})}plpAdsParamReplace(a){let b="&slot=15010",c="&slot=15005";this.pwa.session.parsedURL&&this.pwa.session.parsedURL.basePath&&/store\/category\//.test(this.pwa.session.parsedURL.basePath)&&(b="&slot=15020",c="&slot=15015");return a.replace(b,c)}plpDropdownFacetRender(a){setTimeout(function(){a.find(".dskPlpOpt").each((b,
c)=>{b=$(c);c.offsetTop?b.addClass("hide"):b.removeClass("hide")})}.bind(null,a))}plpRelatedCategoriesRender(a){const b=window.innerWidth;if(!(1024>b)){var c=a.find("amp-carousel.plpCatNavList");a=Array.from(c.find(".plpCatNavItm"));var d=[[]],f=5;1100<b&&(f=6);1250<b&&(f=7);a.forEach(g=>{d[d.length-1].length<f?d[d.length-1].push(g):d.push([g])});d.forEach(g=>{const h=$('<div class="relatedCatsContainer" style="display:flex!important;justify-content:center;"></div>');h.append(g);c.append(h)});c.attr("type",
"slides")}}async setStateOnBrkPt(a,b,c=">="){const d=window.innerWidth,f=async function(g){try{return await this.pwa.amp.ampsSetState(g),!0}catch(h){return console.warn(`Unable to set state for object ${g}, with error: ${h}`),!1}}.bind(this);switch(c){case ">=":if(d>=a)return await f(b);break;case ">":if(d>a)return await f(b);case "<":if(d<a)return await f(b);break;case "<=":if(d<=a)return await f(b);case "==":if(d==a)return await f(b);default:return!1}}addProdSlideNumb(a,b){if(!(1024>window.innerWidth)){var c=
this.pwa.session.isPdpV21;a.find(".prodSlideSelector").each(function(){var d=$(this),f=d.find("[data-cta='prodThumbSlide']").length;const g=d.find("[data-cta='prodThumbSlide']").eq(b-1);d=d.find("[data-cta='prodThumbSlide']")[4];f>=b&&0==g.find(".prodImgSeeMore").length&&(f=c?`<span class="dBRad0375  vp05 gp05 black s12 sHide tHide flex bold midCtr whiteBg noTap txtCtr prodImgSeeMore2">+${f-(b-1)} more</span>`:`<span class="sHide tHide flex midCtr noTap txtCtr prodImgSeeMore">See ${f-(b-1)} more</span>`,
0==g.find(".prodImgSeeMore2,.prodImgSeeMore").length&&0==g.closest(".placeholder").length&&g.append(f),g.addClass("seeMore"),d.setAttribute("data-click-handler","desktop.openImgModal"))})}}async ampBeforeRenderDeskCss(a){if(!this.pwa.session.desktopCssLoaded){var b=this.pwa.session,c=a.find("html").attr("data-version")||b.cssVersion;c=parseInt(c);357>=c&&(c=358);var d=$("#deskStyles").attr("data-css-version")||this.pwa.session.cssVersion;c>d&&(c=d);try{var f=`desktop_v${c}_id${b.wompSiteId}.css`;
if(window.wData||this.pwa.session.isPreprod)f=`staging_desktop_v${c}_id${b.wompSiteId}.css`;const g=await fetch(`/amp/7865/${f}`);b.deskCss=await g.text()}catch(g){console.error("Error fetching desktop.css",g)}(0!==a.find("body").length?a.find("body"):a).prepend($(`<style>${b.deskCss}</style>`));this.pwa.session.desktopCssLoaded=!0}}async modifyMarketingBanner(a,b){a=a.find("#marketingBannerCarousel");b?a.attr("height","35"):0<a.length&&(await this.setStateOnBrkPt(768,{mBanHeight:35}),await this.setStateOnBrkPt(768,
{mBanHeight:80},"<"))}plpFacetClick(a){var b=a.closest("body").find(".plpFilterRange.invalidRange").length;if(!a.is(".plpRangeIpt, .plpFSIpt")&&!b)return b=a.closest(".dskPlpOpt").not(".active"),a.closest("body").find(".dskPlpOpt").removeClass("active"),b.addClass("active"),a.closest(".dskFacetsPills.invalidRange").removeClass("invalidRange"),!0}ampAds(a){if(1024>window.innerWidth)return!1;$(this.pwa.$$$(a[0],"amp-ad")).each((b,c)=>{b=$(c);(c=b.attr("data-slot"))&&b.attr("data-slot",c.replace(/mweb/gi,
"").replace(/_Mweb_/gi,"_"));(c=b.attr("json"))&&b.attr("json",c.replace(/_Mweb_/gi,"_"));b.attr("data-multi-size")&&!/AboveProduct/i.test(b.attr("id"))&&b.attr("data-multi-size","970x250,728x90,1x1")});return!0}async initDskMenu(a){if(!(1280>window.innerWidth)){var b=await this.pwa.amp.ampGetState("navState");if(!(b&&b.nav2Obj&&b.nav3Obj))try{let c=(await this.pwa.amp.ampGetState(/navV1/.test(a[0].className)||311<=a[0].getAttribute("data-version")?"navV1Data":"nav")).data.filter(d=>"categories"==
d.label.toLowerCase());if(0<c.length){let d=b.nav3Obj?b.nav3Obj:null,f=b.nav3Header;0<c[0].items.length&&null==d&&(d=c[0].items[0][0],f=d.label);this.pwa.amp.ampsSetState({navState:{nav2Obj:c[0],nav3Obj:d,nav3Header:f}})}}catch(c){console.warn(`Unable to set categories nav object for desktop menu. Error: ${c}`)}}}async initAcctState(a){if(!(1280>window.innerWidth))try{const [b,c]=await Promise.all([this.pwa.amp.ampGetState("user"),this.pwa.amp.ampGetState("nav")]);(this.pwa.session.isDebug&&0==c.authenticated&&
null!=b.data.loginStatus&&"0"!=b.data.loginStatus||b.data.userFirstName&&c.username!==b.data.userFirstName)&&this.pwa.amp.ampsSetState({nav:{authenticated:null!=b.data.loginStatus&&"0"!=b.data.loginStatus,username:b.data.userFirstName?b.data.userFirstName:""}})}catch(b){console.error(`Unable to set account state. Error: ${b}`)}}async initNavConstants(a){if(!(1280>window.innerWidth))try{const b=this.pwa.amp.ampGetStateBeforeRender(a,"navConstants");this.pwa.amp.ampSetStateBeforeRender(a,"nav",{constants:b.contstants,
accountData:b.accountData,authenticated:!1,username:""})}catch(b){console.warn("Error trying to initialize acct state")}}}
class PDPStickyNav{constructor(a,b,c){this.pwa=a;this.stickySelector=b;this.io=void 0;this.options={stickyNavId:"pdpStickyMenu",stickyHeadId:"headerStickyNav",linkClass:"pdpTabLink",sectionAttr:"data-sectionId",sectionClass:"pdpNavSection",headToggleClass:"pdpStickyActive",stickyHeadClass:"pdpNavTabsContHead",breakpoint:1280};Object.assign(this.options,c)}stickyNavPostRender(a){window.innerWidth<this.options.breakpoint||a.find(`#${this.options.stickyNavId}`).hasClass("pdpNavTabsCont2")||(this.pwa.intersectHandlersRegister("stickySections",
a,`.${this.options.sectionClass}`,this.stickyNavIntersectionHandler.bind(this),{threshold:0,rootMargin:"-20% 0px -79% 0px"}),this.pwa.intersectHandlersRegister("pdpStickyNav",a,`#${this.options.stickyNavId}`,this.headerStickyIntersectHandler.bind(this),{threshold:[0,0],rootMargin:"-100px 0px 0px 0px"}))}stickyNavBeforeRender(a){window.innerWidth<this.options.breakpoint||a.find(`#${this.options.stickyNavId}`).hasClass("pdpNavTabsCont2")||this.createHeaderSticky(a.find(`#${this.options.stickyNavId}`),
a)}stickyNavIntersectionHandler(a,b){var c=$(b.target);0< !c.length||0==b.intersectionRatio||(a=$(c).attr("id"),c=c.closest("body"),a=c.find(`[${this.options.sectionAttr}='${a}']`),0<b.boundingClientRect.height&&(c.find(`.${this.options.linkClass}.active`).removeClass("active"),0<a.length&&a.addClass("active")))}createHeaderSticky(a,b){if(!(0<b.find(`#${this.options.stickyHeadId}`).length||0==a.length)){try{let c=a.clone();c.attr("id","").addClass();b.find("header")[0].insertAdjacentHTML("beforeend",
`<div id="${this.options.stickyHeadId}" class="${this.options.stickyHeadClass}"> ${c[0].outerHTML}</div>`);return!0}catch(c){this.pwa.errorCustom("Error cloning sticky nav into header",{err:c})}return!1}}headerStickyIntersectHandler(a,b){a=$(b.target).closest("body");if(0==b.intersectionRatio&&50>b.boundingClientRect.top)return a.addClass(`${this.options.headToggleClass}`),!0;a.removeClass(`${this.options.headToggleClass}`);return!1}}
class ImgZoom{constructor(a,b){this.pwa=a;a=Object.assign({},b);this.slideSelector=".prodSlide";this.zoomImgWidth=a.zoomImgWidth||2E3;this.zoomImgHeight=a.zoomImgHeight||2E3;this.activeSlideSelector=a.activeSlideSelector||".i-amphtml-carousel-slide-item[aria-hidden='false']";this.mainImgSelector=a.mainImgSelecor||"amp-img, amp-layout";this.initialized=!1}async init(a,b,c){this.slideSelector=c||this.slideSelector;b=a.find(b);if(!b.attr("data-imgZoom")){this.modal$=b.closest(".modalImg");this.zoomOnPage=
!a.closest("body").hasClass("pdpV21");try{this.insertZoomImg(b),this.addZoomEvents(b),this.initialized=!0,b.attr("data-imgZoom",!0)}catch(d){console.warn(`Error in init for imgZoom. Error: ${d}`)}}}addZoomEvents(a){if(0<a.length){const b=this.imgZoom.bind(this),c=this.imgOut.bind(this);a[0].addEventListener("mouseenter",b);a[0].addEventListener("mousemove",b);a[0].addEventListener("mouseleave",c);a[0].addEventListener("click",c);return!0}return!1}imgZoom(a){try{const d=$(a.currentTarget).find(this.activeSlideSelector);
if(this.modal$.hasClass("active")||0!=this.zoomOnPage){var b=d.find(".zoomImg");if(0!=b.length){var c=this.getMouseOffsets(a,d[0]);b.css({zIndex:1,height:"2000px",width:"2000px",transform:`translate(${c.x}px,${c.y}px)`,pointerEvents:"none",opacity:1,objectFit:"cover"});b.removeClass("hide")}}}catch(d){console.warn(`Error zooming img. Error: ${d}`)}}imgOut(a){$(a.currentTarget).find(".zoomImg").css("opacity",0)}async insertZoomImg(a){const b=this.createZoomUrl,c=this.mainImgSelector,d=this.zoomImgWidth,
f=this.zoomImgHeight;a.find(this.slideSelector).each(function(g,h){g=$(this).find(c);if(0==g.length)return!0;h=new URL(g.attr("src"));h=g.attr("data-cgc-image-zoom")||b(h,d,f);g="Zoomed image of "+g.attr("alt");g=`<img class="zoomImg" style="opacity: 0" src="${h.toString()}" alt="${g}">`;$(this).append(g)})}createZoomUrl(a,b,c){let d=a.searchParams;d.set("wid",b);d.set("hei",c);a.search=d.toString();return a}getMouseOffsets(a,b){b=b.getBoundingClientRect();return{x:-Math.abs((this.zoomImgWidth-b.width)/
b.width*(a.pageX-b.left)),y:-Math.abs((this.zoomImgHeight-b.height)/b.height*(a.pageY-b.top))}}}
class PickItModal{constructor(a){this.pwa=a;this.templateProp="fulfillmentModalTemp";this.modalId="fulfillmentModal";this.searchRadius=50;this.modalState={};this.radiusSelector=[5,10,15,20,25,50]}async render(a,b,c){try{this.pwa.util.scriptAddMustache();let d=(await Promise.all([this.pwa.session[this.templateProp],this.pwa.util.waitForProp("Mustache")]))[0];if(a){if(this.modalState=void 0,this.modalState=await this.getModalData(b),!this.modalState)throw Error(`PickItModal.render unable to get data to render modal: Error: ${e}`);
}else d=$(d).find("#formSection").html();if(!this.modalState)return;let f=Mustache.render(d,this.modalState);this.pwa.appshell.elems.loadingOverlay.removeClass("loading");a?(this.closeModal(),$("body").append(f)):$("#formSection").html(f);this.search();c&&this.addSlider(c);return!0}catch(d){console.warn(`PickItModal.render: Unable to render cart OOS modal. Error: ${d}`)}return!1}async loadTemplate(){try{return this.pwa.session[this.templateProp]||(this.pwa.session[this.templateProp]=this.pwa.appshell.fetchAppshellTmp(this.pwa.session.apiInfo.pickItModal,
"fulfillmentModal")),this.pwa.session[this.templateProp]}catch(a){console.warn(`PickItModal.loadTemplate: Error in fetching the pickItModal template. Error: ${a}`)}}async getModalData(a){let b=void 0,c=a.cartError,d="shipping";if(a.isPickIt||a.isDeliverIt)d=a.isPickIt?"at your store":"same day delivery";try{const [h,k]=await Promise.all([this.pwa.amp.ampGetState("changeStore"),this.pwa.amp.ampGetState("storeInfo")]);if(this.pwa.session.docTests.isPDPReg.test(location.pathname)){var f=a?a.prodId:this.pwa.util.prodIdGet(location);
const [n,q]=await Promise.all([this.pwa.pdpDataAbstraction.getSkuDetails(f),this.pwa.amp.ampGetState(`skuFacets${f}`)]);delete n.data;b={qty:q.qty,DISPLAY_NAME:n.DISPLAY_NAME,IMG:{imageId:n.PRODUCT_IMG_ARRAY[0].imageId,desc:n.PRODUCT_IMG_ARRAY[0].description},skuId:q.skuId,skuFacets:q,prodId:f,isBackorder:n.isBackorder||!1}}else{var g=await this.pwa.plp.getPlpItemData(a.prodId);g||=await this.pwa.plp.getPlpItemData(a.prodId);b={qty:1,DISPLAY_NAME:g.DISPLAY_NAME,IMG:{imageId:g.scene7imageID,desc:g.DISPLAY_NAME},
skuId:g.SKU_ID&&0<g.SKU_ID.length?g.SKU_ID[0]:"",prodId:g.PRODUCT_ID,isBackorder:g.BACKORDER_FLAG||!1}}let l=g=f="",m=!0;try{f=k.data&&k.data.store&&k.data.store.postalCode?k.data.store.postalCode:"",g=h.location||k.data&&k.data.store&&k.data.store.postalCode?k.data.store.postalCode:"",l=k.data.store.commonName,l+=40==k.data.store.storeType?" buybuy BABY":30==k.data.store.storeType?" Harmon":" Bed Bath & Beyond",m=h.onlyAvailableStores}catch(n){console.log(`PickItModal no stores found. Error: ${n}`)}let p=
this.radiusRender();b=Object.assign(b,{isPickIt:a.isPickIt||!1,isShipIt:a.isShipIt,isDeliverIt:a.isDeliverIt||!1,storeRadius:this.searchRadius,fulfillmentType:d,radiusSelector:p,postalCode:f,unitDistance:this.pwa.session.isCANADA?"km":"Miles",currentLocation:g,scene7RootPath:this.pwa.session.apiInfo.scene7RootUrl,onlyAvailableSelected:c?c:m?m:!0,onlyAvailableStores:!1,showClForm:g?!1:!0,cartError:c,changeStore:h,storeName:l,modalTemplate:!0})}catch(h){console.warn(`PickItModal.getModalData: Unable to get data to render prod pick it modal. Error: ${h}`),
b=!1}return b}radiusRender(){return this.radiusSelector.map(a=>({radius:a,selected:a==this.searchRadius?"selected":""}))}async search(a,b,c){a=void 0;c="";try{if(b)if(a=b.find("#clFormLocale").val(),!a||0==a.length)this.changeState(this.modalState,{changeStoreErr:!0,showClForm:!0},!0);else if(this.modalState.changeStore)return this.modalState.changeStore.location=a,this.changeState(this.modalState,{currentLocation:a,showClForm:!0},!0),!0;if(this.modalState.currentLocation||a){$("#alStoreStockResults").html("Loading...");
let d=await this.getStoreData(a||this.modalState.currentLocation);d=Object.assign(d,{storeTemplate:!0,href:`${window.location.origin}${window.location.pathname}`,qty:this.modalState.qty,skuId:this.modalState.skuId,prodId:this.modalState.prodId,currentLocation:this.modalState.currentLocation,storeRadius:this.searchRadius||this.modalState.changeStore.searchRadius,unitDistance:this.modalState.unitDistance,cartError:this.modalState.cartError});d.data.otherStores=this.modifyStoreData(d.data,this.modalState.onlyAvailableSelected);
2<d.data.otherStores.length?d.data.displayStores=d.data.otherStores.slice(0,2):(d.data.displayStores=d.data.otherStores,d.data.hideShowMore=!0);this.storeData=d;c=await this.renderStoreData(this.storeData)}}catch(d){console.warn(`PickItModal.search: Unable to get storeData for cart error modal. Error: ${d}`),c='<div class="vp05 gp1 panelAlert">There was an error trying to load the store data. Please try again.</div>'}$("#alStoreStockResults").html(c);return!0}async renderStoreData(a){let b="";try{let c=
await Promise.all([this.pwa.session[this.templateProp],this.pwa.util.waitForProp("Mustache")]);b=Mustache.render(c[0],a)}catch(c){console.warn(`PickItModal.renderStoreData: Problem render store data. Error: ${c}`)}return b}modifyStoreData(a,b){let c=this.pwa.session.isBBB_US?10:this.pwa.session.isCANADA?50:40,d=this.pwa.session.isBBB_US?"BedBathUS":this.pwa.session.isCANADA?"BedBathCanada":"BuyBuyBaby";const f=this.pwa.college.favoriteStore;return a.otherStores.filter(g=>{g.storeType==c&&(g.setStore=
!0);try{g.favStore=a.favStore&&0<a.favStore.length?g.storeId==a.favStore[0].storeId:!1;g.setStore=c==g.storeType;g.distance=parseFloat(g.distance).toFixed(2);g.storeTimings=g.storeTimings.split(",");let h=g.siteBopus.filter(k=>k.siteId==d);g.bopisFlag=0<h.length?parseInt(h[0].bopusFlag):0;g.curbsideFlag=parseInt(g.curbsideFlag)||0;g.isClosest=f&&f.storeId===g.storeId&&f.isClosest}catch(h){}return b?0==g.atcStatus||2==g.atcStatus:g.storeType==c||0==g.atcStatus||2==g.atcStatus})}async getStoreData(a){let b=
void 0;try{if(!this.modalState)throw Error("Modal State has not been initialized");b=await (await fetch(`${this.pwa.session.apiInfo.storeSkuSearch}&favStoreId=${this.modalState.changeStore.storeId}&latitude=${this.modalState.changeStore.latitude}&longitude=${this.modalState.changeStore.longitude}&qty=${this.modalState.qty||1}&radius=${this.modalState.storeRadius}&registryId=&searchString=${a||this.modalState.changeStore.location||this.modalState.postalCode}&skuId=${this.modalState.skuId||""}`)).json()}catch(c){console.warn(`PickItModal.getStoreData: Unable to get store data. Error: ${c}`)}return b}changeState(a,
b,c){try{a=a?Object.assign(a,b):b,c&&this.render(!1)}catch(d){console.warn(`PickItModal.changeState: Could not change state object. Error: ${d}`)}return a}async setAsMyStore(a){try{let b=JSON.parse(a);b.isClosest&&this.pwa.college.updateFavoriteStoreHandler(b.storeId);let c=b.storeId;await this.pwa.amp.ampsSetState({apiUrl:{page:0,sddZipParam:"",pageParam:"&start=0&perPage=24",storeOnlyParam:`&storeOnlyProducts=true&storeId=${c}`},cart:{storeId:c},changeStore:{csModal:!1,location:b.location,nearestStores:null,
ssModal:!1,storeId:c,storeOnly:!0,sddActive:!1,sddActiveSearch:!1},locationDirty:!0,u:null});this.closeModal()}catch(b){console.warn("PickItModal.setAsMyStore: Unable to set store")}return!0}async pickItModalClick(a,b){b.is(".showAll")&&(this.storeData.data.displayStores=this.storeData.data.otherStores.slice(0,this.storeData.data.otherStores.length>this.storeData.data.displayStores.length+2?this.storeData.data.displayStores.length+2:this.storeData.data.otherStores.length+1),this.storeData.data.hideShowMore=
this.storeData.data.displayStores.length==this.storeData.data.otherStores.length,a=await this.renderStoreData(this.storeData),$("#alStoreStockResults").html(a),this.storeData.data.otherStores.length==this.storeData.data.displayStores.length&&$("#alStoreStockResults").find(".showAllCont").remove());b.is("[data-radius-btn]")&&(a=b.next(),a.hasClass("hide")?a.removeClass("hide"):a.addClass("hide"));if(b.is(".radItm")&&(a=b.attr("option"))){let c=this.modalState.radiusSelector;try{this.pwa.amp.ampsSetState({changeStore:{searchRadius:a}}),
this.searchRadius=parseInt(a),c=this.radiusRender()}catch(d){console.warn(`PickItModal.pickItModalClick: Unable to set search radius. Error: ${d}`)}this.changeState(this.modalState,{storeRadius:a,radiusSelector:c,showClForm:!0},!0)}b.is("[data-current-location]")&&(a=await this.pwa.site.getCurrLocation(b))&&(a=-1<a.indexOf("-")?a.slice(0,a.indexOf("-")):a,this.changeState(this.modalState,{currentLocation:a,showClForm:!0,zip:a},!0));b.is("[data-rad-close]")&&b.closest(".pickItMRad").addClass("hide")}async pickIt(a,
b){this.pwa.site.formSubmitRouter(b);this.closeModal();return!0}closeModal(){$(`#${this.modalId}`).remove()}addSlider(a){let b=this.modalState.isShipIt?"Similar Products Available for Standard Shipping":this.modalState.isPickIt?`Similar Products Available ${this.modalState.storeName?"at "+this.modalState.storeName:"for Pickup"}`:"Similar Products Available for Same Day Delivery";this.pwa.appshell.loadCartModalSlider(a,$("#sliderContainer"),{ctaType:b,pagination:!1,removeFirst:!0,cta:!1})}async fetchSimilarProducts(a){try{const b=
await fetch(`${this.pwa.session.apiInfo.cartSliderApi}?${this.pwa.site.objToQueryStr({scheme:"pdp_fbw",currencyCode:"USD",country:"US",site:this.pwa.session.siteId,products:`${this.pwa.session.siteId}_${a.prodId}`,context:`${a.prodId}`,isBrowser:!0,storeId:a.storeId||null,number:4,web3feo:"abc",isGroupby:!0})}`);let c=await b.json();if(200!==b.status)throw Error(`Error fetching ${this.pwa.session.apiInfo.cartSliderApi} container for change store modal`);c.title=`Similar Products Available ${a.storeName?
" at "+a.storeName:""}`;c.ctaType=a.ctaType;return c}catch(b){console.warn(`PickitModal.fetchSimilarProducts Error: ${b}`)}}async pickItInteraction(a){let b=!0;try{if(!a.prodId||!a.skuId)return;await this.pwa.util.waitForProp("docObjActive",this.pwa.session);this.loadTemplate();const c=[this.fetchSimilarProducts({prodId:a.prodId,ctaType:"pickIt"})];if(!this.pwa.appshell.cartModalTmp){let d=this.pwa.appshell.fetchAppshellTmp(this.pwa.session.apiInfo.cartSlider,"cartSlider");c.push(d)}b=await this.render(!0,
{skuId:a.skuId,prodId:a.prodId,storeId:a.storeId,isPickIt:!0,isDeliverId:!1,isShipIt:!1,cartError:!1},c);try{this.pwa.session.docTests.isPLPReg.test(location.pathname)||this.clearInteractionParams()}catch(d){console.warn(`pickItModal.pickItInteraction Error: ${d}`),b=!1}}catch(c){console.warn(`PickItModal.changeStoreClick Error: ${c}`),b=!1}return b}scrollPlp(){try{this.pwa.site.setPlpPositionFromAmp(),this.clearInteractionParams()}catch(a){console.warn(`pickItModal.scrollPlp Error: ${a}`)}return!0}clearInteractionParams(){let a=
new URL(location.href);if(a.searchParams.get("type")){for(const b of this.pwa.site.interactionParamsToClear)a.searchParams.delete(b);window.history.replaceState(null,this.pwa.session.docObjActive.shadowDoc.title||this.pwa.session.titleDefault,a.href)}}}
class DeliveryModal extends PickItModal{constructor(a){super();this.pwa=a}async initRender(a){this.loadTemplate();await this.pwa.util.waitForProp("docObjActive",this.pwa.session);this.render(!0,a);try{let b=new URL(location.href);if(b.searchParams.get("type")){for(const c of this.pwa.site.interactionParamsToClear)b.searchParams.delete(c);window.history.pushState({},this.pwa.session.docObjActive.shadowDoc.title||this.pwa.session.titleDefault,b.toString())}}catch(b){return console.warn(`pickItModal.pickItInteraction Error: ${b}`),
!1}return!0}async getModalData(a){let b={prodId:"",skuId:"",zip:"",deliveryModal:!0,storeTemplate:!1,onlyAvailableStores:!1,modalTemplate:!0,isShipIt:!0,zipLabel:"Zip Code"};Object.assign(b,a);try{const [c,d]=await Promise.all([this.pwa.amp.ampGetState(`skuFacets${b.prodId}`),this.pwa.pdpDataAbstraction.getSkuDetails()]);delete d.data;b=Object.assign(b,{qty:c.qty||1,scene7RootPath:this.pwa.session.apiInfo.scene7RootUrl,DISPLAY_NAME:d.DISPLAY_NAME,IMG:{imageId:d.PRODUCT_IMG_ARRAY[0].imageId,desc:d.PRODUCT_IMG_ARRAY[0].description}});
this.pwa.session.isCANADA&&(b.zipLabel="Postal Code")}catch(c){console.warn(`deliveryModal.getModalData Error: ${c}`)}return b}async search(a,b,c){a=void 0;c="";let d=this.pwa.session.isCANADA?/[A-VXY][0-9][A-Z] ?[0-9]?[A-Z]?[0-9]?$/:/^[0-9]{5}$/;try{let f=this.modalState.zip,g={data:{PRODUCT_DETAILS:{sddZipcode:""}}};try{g=await this.pwa.amp.ampGetState(`pdpDet${this.modalState.prodId}`)}catch(k){console.warn(`deliveryModal.search pdpDet getAmpState failed. Error: ${k}`),g.data.PRODUCT_DETAILS.SKU_ID=
""}if(""==this.modalState.skuId||this.modalState.skuId==g.data.PRODUCT_DETAILS.SKU_ID&&this.modalState.zip==g.data.PRODUCT_DETAILS.sddZipcode&&!b)a=g.data.PRODUCT_DETAILS;else{if(b){let l=`${b.find("#clFormLocale").val()}`;if(d.test(l))b.removeClass("formError");else return b.addClass("formError"),!1;""!==l.trim()&&l.trim()!==f.trim()&&(f=l)}$("#alStoreStockResults").html("Loading...");await this.pwa.amp.ampsSetState({changeStore:{sddZipcode:f}});let k=$(this.pwa.session.docObjActive.shadowBody).find(`#prod2FulfillmentList${this.modalState.prodId}`).attr("src");
k||=$(this.pwa.session.docObjActive.shadowBody).find(`#cProdFulfillmentList${this.modalState.prodId}`).attr("src");if(k){if(/TIMEZONE/.test(k)){let l=(new Date).getTimezoneOffset();k=k.replace(/TIMEZONE/,l)}k+=`&__amp_source_origin=${encodeURIComponent(location.origin)}`;a=(await (await fetch(k,{cache:"force-cache",headers:{"cache-control":"max-age=120"}})).json()).data.PRODUCT_DETAILS}if(!a)throw Error("Unable to get skuDetails");}let h={zip:f,prodId:this.modalState.prodId,skuId:this.modalState.skuId,
inStock:a.ONLINE_INVENTORY||!1,sddEligible:a.sddAvailable||!1,shipDeliveryMsg:a.shipDeliveryMsg||null,sddDeliveryMsg:a.sddDeliveryMsg||null,freeShippingMessage:a.freeShippingMessage||null,sddShippingFeeMsg:a.sddShippingFeeMsg||null,isBackorder:a.isBackorder||!1,deliveryTemplate:!0,storeOnly:a.storeOnly||!1,href:`${location.origin}${location.pathname}`,personalized:a.CUSTOMIZATION_OFFERED_FLAG||!1,hideSdd:!this.pwa.session.features.sdd};h.OOS=h.inStock||h.sddEligible?!1:!0;h.OOS&&this.renderSimilar(h.prodId);
c=await this.renderStoreData(h)}catch(f){console.warn(`deliverModal.search Error: ${f}`),c='<div class="vp05 gp1 panelAlert">There was an error trying to load the store data. Please try again.</div>'}$("#alStoreStockResults").html(c);return c}async atc(a,b){this.pwa.site.formSubmitRouter(b);this.closeModal();return!0}async renderSimilar(a){a=[this.fetchSimilarProducts({prodId:a,ctaType:"cart"})];if(!this.pwa.appshell.cartModalTmp){let b=this.pwa.appshell.fetchAppshellTmp(this.pwa.session.apiInfo.cartSlider,
"cartSlider");a.push(b)}this.addSlider(a)}}
class PaginatedSlider{constructor(a,b){this.pwa=a;this.breakpoint=b||1101;this.visibleProperty="data-display-count";this.cls={containerClass:"dskSliderContainer",wrapClass:"dskSliderWrap",scrollContClass:"dskSliderScroll",cardClass:"dskSliderCard"}}init(a,b){const c=Object.assign({containerClass:"sliderWrap",cardClass:"amp-sacrifice",carouselSelector:"amp-carousel",scrollContClass:"i-amphtml-carousel-scroll",cardsVisible:5},b);if(!(window.innerWidth<this.breakpoint)){c.visibleProperty=this.visibleProperty;
try{let g=a.find(`.${c.containerClass}`);0==g.length&&(g=a.closest(`.${c.containerClass}`));if(0!=g.length){var d=this.cls,f=this.calcCardWidth;g.each(function(){var h=$(this);for(var k in c)d.hasOwnProperty(k)&&-1<k.indexOf("Class")&&(h.is(`.${c[k]}`)?h.addClass(d[k]):h.find(`.${c[k]}`).addClass(d[k]));h=h.find(c.carouselSelector);h.addClass(d.wrapClass);var l=h.attr(c.visibleProperty)||c.cardsVisible;h.attr(c.visibleProperty,l);k=h.find(`.${c.cardClass}`);k.addClass("sliderCard");f(h,k,Number.parseInt(l));
l=Number.parseInt(l);k.length>l&&0==h.find(".sliderControlCont").length&&h.after('\n        <div class="sliderControlsCont sHide">\n          <div class="leftSliderControl sliderControl" data-direction=0 tabindex="0" role="button">\n            <svg class="wi wiCaret deg90 noTap">\n              <use xlink:href="#wiCaret"></use>\n            </svg>\n          </div>\n          <div class="rightSliderControl sliderControl active" data-direction=1 tabindex="0" role="button">\n            <svg class="wi wiCaret deg270 noTap">\n              <use xlink:href="#wiCaret"></use>\n            </svg>\n          </div>\n      </div>')})}}catch(g){console.warn(`Error setting up the desktop sliders. Error: ${g}`)}}}sliderClick(a,
b){var c={sliderWrapClass:"dskSliderContainer",carouselClass:"dskSliderWrap",sliderControlClass:"sliderControl",scrollContClass:"dskSliderScroll",sliderCardClass:"dskSliderCard",visibleProperty:"data-display-count",visible:5};var d=b?Object.assign(c,b):c;b=$(a.target);var f=b.closest(`.${d.sliderWrapClass}`),g=Number.parseInt(f.find(`.${d.carouselClass}`).attr(d.visibleProperty))||d.visible;f.find(`.${d.sliderControlClass}`).addClass("active");a=f.find(`.${d.scrollContClass}`);a=0==a.length?f.find(".i-amphtml-carousel-scroll"):
a;c=a;var h=f.find(`.${d.sliderCardClass}`);f=b.attr("data-direction");0!=c.length&&0!=h.length&&f&&0!=b.length&&g?(d=h.outerWidth(),h=d*h.length,g*=d,c=c.eq(0)[0].scrollLeft,c=1==f?h-(c+g)>g?g+c:h:c<=g+d/2?0:c-g,(0==c||2*c+d/2>h)&&b.removeClass("active"),b=c):b=0;a[0].scrollLeft=b;return!0}calcCardWidth(a,b,c){let d=(a.outerWidth()/c).toFixed(2);d&&!isNaN(d)&&(b.css("width",`${d}px`),a.width(d*c),a.addClass("calculated"));a.is(".modProductCarousel.viewV5 amp-carousel")&&(b.css("height",`${1.45*d}px`),
b.find(".sliderCard").css("height","100%"))}resize(a,b){if(window.innerWidth<this.breakpoint)a.find(`.${this.cls.cardClass}`).css("width",""),a.find(`.${this.cls.wrapClass}`).css("width","").removeClass("calculated");else{let c=a.find(`.${this.cls.wrapClass}`);if(0==c.length)this.init(a),b&&this.init(a,b);else{const d=this.cls,f=this.visibleProperty,g=this.calcCardWidth;c.each(function(){if(!$(this).hasClass("calculated")){let h=$(this);const k=h.attr(f)||5;g(h,h.find(`.${d.cardClass}`),k)}})}}}}
class Ideaboard{constructor(a){this.pwa=a}ideaAccToggle(a){$(a.currentTarget).parent().toggleClass("ideaAccExpanded")}async ideaAdd(a,b){if(this.pwa.session.features.ideaboardV2&&!this.ideaValidate(b))this.pwa.util.stopEvent(b);else try{this.pwa.util.stopEvent(b);var c=$(b.target);if(this.pwa.util.formValidate(c)){var d=this.pwa.util.formToObject(c);b="createIdeaboard";var f={};if(this.pwa.session.features.ideaboardV2){var g={},h="";if(d.id)b="addIdeaboard",g={productId:d.productId,skuId:/\[/i.test(d.skuId)?
"":d.skuId||"",productName:d.productName},h=`${location.origin}/apis/services/ideaboard/v1.0/item?ideaboardId=${d.id}`;else{const k=c.find(".ideaPill.active").map((l,m)=>$(m).text()).get();g={boardName:(d.boardName||"").trim(),description:(d.description||"").trim(),isPrivate:"on"==d.isPrivate?!0:!1,item:{productId:d.productId,productName:d.productName},tags:k.length?k:[]};h=`${location.origin}/apis/services/ideaboard/v1.0/`}this.pwa.user.ATG_PROFILE_DATA&&(h+=/\?/.test(h)?"&":"?",h+=`ownerName=${this.pwa.user.ampUserInfo?
this.pwa.user.ampUserInfo.data.tealiumUserData.customer_name||"":""}&profileId=${this.pwa.user.ATG_PROFILE_DATA}`);if(this.pwa.session.isPreprod||this.pwa.session.isPreview)h+=/\?/.test(h)?"&":"?",h+="web3feo";f=await fetch(h,{body:JSON.stringify(g),credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/json","x-bbb-site-id":this.pwa.session.siteId})})}else g={ideaBoardRequest:{ideaBoardName:d.ideaBoardName||"",ideaBoardItems:[{productId:d.productId||"",skuId:/\[/i.test(d.skuId)?
"":d.skuId||"",referenceNumber:"",ltlShipMethod:""}]}},d.ideaBoardId&&(b="addIdeaboard",Object.assign(g.ideaBoardRequest,{ideaBoardId:d.ideaBoardId||""})),h=`ideaBoardInputJSONString=${encodeURIComponent(JSON.stringify(g))}`,f=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/ideaboard/item`,{body:h,credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});c="";if("ERROR"==
f.serviceStatus)return f.error=!0,this.ideaModalRender(f);c=this.pwa.session.features.ideaboardV2?d.boardName:f.data.component.ideaBoardVO.ideaBoardName;this.ideaModalClose(c);"createIdeaboard"==b?this.pwa.site.tealiumClickEventEmitter($(`<div data-cta='${this.currentPageType}CreateNewIdeaboard'
          data-attribute='{
            "product_id": ["${a.productId}"],
            "ideaboard_name": "${c}",
            "product_price": ["${a.price}"],
            "skuName": "${a.title}"
            ${"number"==typeof a.position?`,"product_position_clicked": "${a.position}"`:""}
            ${a.secIdentifier?`,"secIdentifier": "${a.secIdentifier}"`:""}
          }'>
        </div>`)[0]):"addIdeaboard"==b&&this.pwa.site.tealiumClickEventEmitter($(`<div data-cta='${this.currentPageType}AddToIdeaboard'
          data-attribute='{
            "product_id": ["${a.productId}"],
            "ideaboard_name": "${c}",
            "product_price": ["${a.price}"],
            "skuName": "${a.title}"
            ${"number"==typeof a.position?`,"product_position_clicked": "${a.position}"`:""}
            ${a.secIdentifier?`,"secIdentifier": "${a.secIdentifier}"`:""}
            ${a.skuId?`,"product_sku_id": "${a.skuId}"`:""}

          }'>
        </div>`)[0])}}catch(k){console.log(k),this.ideaModalRender({error:"Unable to add to ideaboard"})}}ideaCheck(a){a=$(a.target);!a.is(".ideaDisabled")&&a.prev().length&&(a=a.prev(),a.prop("checked",!a.prop("checked")))}ideaCountUpdate(a){a=$(a.target);try{let b=a.val().length;$(".ideaDescCount").text(`${b}/200`)}catch(b){console.warn("Could not update count of idea board description")}}async ideaModalListBoards(a,b,c){c&&/(&reg|&trade)/g.test(c.search)&&(b=/title=(.*?)&img=/.exec(c.search))&&
(a.title=decodeURIComponent(b[1].replace(/=/g,"").replace(/\+/g," ")));/b3h2\.scene7\.com/.test(a.img)||(a.scene7Url=this.pwa.session.apiInfo.scene7RootUrl+"/");b="";(c=/\/store\/([^/]*)?/i.exec(location.pathname))&&(b=c[1]);"product"==b?this.currentPageType="pdp":/brand|category|s/.test(b)?this.currentPageType="plp":this.currentPageType="home";this.pwa.util.scriptAddMustache();let d;if(this.pwa.session.features.ideaboardV2){b=await (await fetch(`${location.origin}/apis/services/ideaboard/v1.0/?${this.pwa.user.ATG_PROFILE_DATA?
`profileId=${this.pwa.user.ATG_PROFILE_DATA}&`:""}orderBy=creationDate&productId=${a.productId}&ownerName=${this.pwa.user.ampUserInfo?this.pwa.user.ampUserInfo.data.tealiumUserData.customer_name||"":""}${this.pwa.session.isPreprod||this.pwa.session.isPreview?"&web3feo":""}`,{credentials:"include",method:"GET",headers:Object.assign({"Content-Type":"application/json","x-bbb-site-id":this.pwa.session.siteId})})).json();[c]=await Promise.all([this.pwa.amp.ampGetState("user"),this.pwa.util.waitForProp("Mustache")]);
b.prodObj=a;c.data.loginStatus=parseInt(c.data.loginStatus)||0;b.user=c;b.listIdeaboardsV2=!0;$("body").addClass("modalOpen");0==b.user.data.loginStatus&&(b.disablePriv=!0);b.emptyBoardImg=this.pwa.session.isBABY?"babytitleimage":this.pwa.session.isHARMON?"harmontitleimage":"emptyTileIcon";try{d=0==b.user.data.loginStatus&&4==b.data[0].itemCount}catch(f){}}else{b=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/customers/customer-id/idea-boards?ignoreItemDetails=${a.ignoreItemDetails||
"false"}&productId=${a.productId}`,{credentials:"include",method:"GET",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});[c]=await Promise.all([this.pwa.amp.ampGetState("user"),this.pwa.util.waitForProp("Mustache")]);b.prodObj=a;c.data.loginStatus=parseInt(c.data.loginStatus)||0;b.user=c;b.listIdeaboards=!0;try{d=0==b.user.data.loginStatus&&4==b.data.atgResponse[0].itemCount}catch(f){}}d&&(b.error=!0,b.errorAnonItemsMaxExceeded=
!0);"ERROR"==b.serviceStatus&&(b.error=!0,b.errorApiFailed=!0);this.ideaboardsObj=b;this.ideaModalRender(b)}ideaModalRender(a){$("#modalIdeaWrap").remove();var b=$("#modalIdeaTemplate");let c="";Array.from(b[0].content.children).forEach(f=>c+=f.outerHTML);b=Mustache.render(c,a);$("body").append(b);b=$("#modalIdeaWrap");let d=b.find(".modalCloseJs");0<d.length&&d[0].focus();b.find(".ideaCreateBoardJs").on("click",function(){var f=this.ideaboardsObj;f&&(this.pwa.session.features.ideaboardV2?(f.listIdeaboardsV2=
!1,f.createIdeaboardV2=!0,f.data&&f.data.length&&0==f.user.data.loginStatus&&(f.error=!0,f.errorAnonIdeaMaxExceeded=!0)):(f.listIdeaboards=!1,f.createIdeaboard=!0,f.data.atgResponse&&f.data.atgResponse.length&&0==f.user.data.loginStatus&&(f.error=!0,f.errorAnonIdeaMaxExceeded=!0)),this.ideaModalRender(f),(f=$("#ideaProdAddName, #ideaProdAddNameV2")[0])&&f.focus(),this.pwa.session.features.ideaboardV2&&($(".ideaProdPrivLabel").on("click",this.ideaCheck),$(".ideaAccordHead").on("click",this.ideaAccToggle),
$(".ideaAccPanel").on("click",this.ideaPillToggle),$("#ideaProdDesc").on("input",this.ideaCountUpdate),$("#ideaProdAddNameV2").on("input",this.ideaPreventChars)))}.bind(this));b.find(".ideaProdAdd").on("submit",this.ideaAdd.bind(this,a.prodObj));b.find("input").on("keyup",f=>{const g=f.target,h=this.pwa.util.formValidateInput(g.validity);g.setAttribute("validity",h);$(f.target.form).addClass("formDirty")});a.listIdeaboards&&this.ideaModalLoadEvent(a.prodObj)}async ideaModalLoadEvent(a){if(window.triggerLoadEvent)try{this.pwa.site.tealiumClickEventEmitter($(`<div data-cta='${this.currentPageType}AddToIdeaboardSnowplow'
            data-attribute='{
              "product_id": ["${a.productId}"],
              "product_price": ["${a.price}"]
              ${"number"==typeof a.position?`,"product_position_clicked": "${a.position}"`:""}
              ${a.secIdentifier?`,"secIdentifier": "${a.secIdentifier}"`:""}
            }'>
          </div>`)[0]),window.triggerLoadEvent(`dataLayer=${encodeURIComponent(JSON.stringify({boosted_search_engine:"solr_s1",call_to_actiontype:"ideaboard add modal",channel:"My Account",content_pagetype:"",crossell_page:"",crossell_product:"",facet_order:"",facets_applied:"",feo_site_indicator:"AMP Pages",ideaboard_name:"",internal_search_term:"",landingPageUrl:document.location.href,navigation_path:"My Account",page_function:"My Account",page_name:"ideaboard add modal",page_referrer_url:"",page_type:"My Account",
pagename_breadcrumb:"My Account >Add to Idea Board",product_finding_method:"",product_id:[a.productId],product_pagetype:"",product_position_clicked:"",product_price:[a.price],search_engine_used:"Solr",search_words_applied:"",session_referrer:"",session_referrer_domain:"",sheer_id_indicator:"Not Verified",site_channel:"mobile",sort_value:"",subnavigation_path:"My Account",user_type:"non registered user"}))}`)}catch(b){console.warn(`Unable to send ideaModalLoad Event. Error: ${e}`)}}async ideaModalClose(a){$("#modalIdeaWrap").remove();
let b="";b=this.pwa.session.features.ideaboardV2?`Item is successfully added to ${a}`:`The item has been successfully added to ${a?a:"the ideaboard"}.`;a=`
    <button id="msgIdeaboardAdded" class="msg msgIdeaboardAdded active msgCloseJs">
      ${b}
    </button>`;$("body").append(a);$(".msgCloseJs").on("click",()=>{let c=$("#msgIdeaboardAdded");c.removeClass("active");setTimeout(function(d){d.remove()}.bind(this,c),500)});setTimeout(()=>{$(".msgCloseJs").trigger("click")},2E3)}ideaPillToggle(a){$(a.target).toggleClass("active");$(".createIdeaAdded").text($(".ideaPill.active").length)}ideaPreventChars(a){let b=/[^a-zA-Z0-9\-'.$\s]/gi,c=this.selectionStart,d=a.target.value;b.test(d)&&($(a.target).val(d.replace(b,"")),c--);0<c&&" "==d[c-1]&&(1==
c?($(a.target).val(""),c--):" "==d[c-2]&&(c--,$(a.target).val(d.slice(0,c))));this.setSelectionRange(c,c)}async ideaProdInfoFromDom(){var a=await this.pwa.util.waitForProp("docObjActive",this.pwa.session);a=$(await this.pwa.util.waitForProp("shadowBody",a));await this.pwa.util.waitForElement(".trackIsPrice",a[0]);return{price:a.find(".trackIsPrice").text().trim()}}ideaValidate(a){a=$("#ideaProdAddNameV2");if(!a.length||a.val())return!0;$("#ideaInputCont").addClass("ideaInvalid");return!1}}
class Mo{constructor(a){this.pwa=a}async moLoad(a,b){if(this.pwa.session.isDebug)debugger;b.searchParams.delete("wmPwa");document.cookie="wmPwa=true; max-age=0; path=/; secure; expires=Thu, 01 Jan 1970 00:00:01 GMT";this.pwa.session.docTests.isAmpReg.test(`${b.pathname}${b.searchParams}`)&&b.searchParams.set("wmSkipPwa",1);location.href=b.href;console.log("loading MO");return!0}}
class NavPanel{constructor(a){this.pwa=a;this.registeredDocs=[];this.botFullMenuTemplate=(a=$("#botFullMenuTemplate")[0])?a.innerHTML:""}_navClose(a){this.pwa.amp.ampsSetState({u:{nav:""},navState:{activeDskNav:"",flyoutMenu:"",isCatNav:!1,isTopNav:!1,nav1Header:"",nav1Obj:null,nav2Header:"",nav2Obj:null}});a.removeClass("modalOpen");$("body").removeClass("modalOpen")}_navMouseleave(a,b){!this.dskNavCategoryDebounce&&a.hasClass("modalOpen")&&/modalOpen/.test(a[0].className)&&!$(b.relatedTarget).closest("[data-nav-mouseleave]").length&&
this._navClose(a)}async botNavRender(a){this.pwa.util.scriptAddMustache();var [b]=await Promise.all([this.pwa.amp.ampGetState("navV2Data"),this.pwa.util.waitForProp("Mustache")]);b=$(Mustache.render(this.botFullMenuTemplate,b));b.find("a").each((c,d)=>{/\/category\/([a-z\-]+\/){3}[0-9]+\/?$/i.test(d.href)&&$(d).remove()});a.after(b)}navDskCategoryBtnClickDebounce(a){return this.pwa.desktop.isDesktop&&a&&"categoriesLink"==a.attr("data-test")&&!this.dskNavCategoryDebounce?(this.dskNavCategoryDebounce=
!0,setTimeout(function(){this.dskNavCategoryDebounce=!1}.bind(this),1E3),!0):!1}navDskCategoryDragScrollRegister(a){function b(n){if(k){var q=n.pageX-f[0].offsetLeft-m;if(!/navPill/.test(n.path[0].className)||3<Math.abs(q))l=!0,n.preventDefault(),f[0].scrollLeft=p-q}}function c(n){k=!1;window.removeEventListener("mouseup",c);window.removeEventListener("mousemove",h(b,25));f[0].classList.remove("grabbing");g.classList.remove("noTxtSelect")}function d(n){l&&n.preventDefault()}if(a&&a.length&&!a.attr("data-nav-dragscroll-registered")){var f=
a.find(".navPillsBar"),g=a.closest("body")[0];if(f.find("a").closest("div").innerWidth()<=f.innerWidth())f.removeClass("grab grabbing").off("mousedown").off("mouseup").find(".navPill").off("click",d),$(g).removeClass("grab grabbing").off("mousedown").off("mouseup");else{var h=this.pwa.util.simpleThrottle,k=!1,l=!1,m,p;f.addClass("grab");f.on("mousedown",function(n){l=!1;k=!0;window.addEventListener("mousemove",h(b,25));window.addEventListener("mouseup",c);g.classList.add("noTxtSelect");f[0].classList.add("grabbing");
m=n.pageX-f[0].offsetLeft;p=f[0].scrollLeft}).find(".navPill").on("click",d);a.attr("data-nav-dragscroll-registered","1")}}}navMouseleaveListenerRegister(a){if(!a.attr("data-nav-mouseleave-registered")){var b=this._navMouseleave.bind(this,a);a.find("[data-nav-mouseleave]").each((c,d)=>d.addEventListener("mouseleave",b));a.attr("data-nav-mouseleave-registered","1")}}}
class Personalize{constructor(a){this.pwa=a;this.personalizedSku=[];this.messageListenerAdded=!1}addMessageListener(){this.messageListenerAdded=!0;window.addEventListener("message",a=>{if(location.origin===a.origin&&/personalizeModal/.test(a.data))try{let b=JSON.parse(a.data);"close"===b.action?this.closeModal():"saveData"===b.action?(this.venderPersonalizeDataGet(b),this.closeModal()):"personalizeReady"===b.action?$(this.pwa.session.docObjActive.shadowBody).find("#vendorIframeModal").attr("data-personalize-ready",
!0):"error"===b.action&&(this.closeModal(),this.reportError())}catch(b){console.warn(`Personalize: personalizeModal event listener: could not decode data. Error: ${b}`),this.closeModal()}"https://bbb.snowmachine.me"===a.origin&&(this.sendMessage(a.data,$(this.pwa.session.docObjActive.shadowBody)),"customizationCancel"===a.data.name&&this.closeModal())})}async addVendorModal(a){var b=a.closest("body").find("#vendorIframeModal");let c=this.pwa.site.prodIdGet(new URL(location.href));if(!b.length&&(b=
await this.pwa.amp.ampGetState(`pdpDet${c}`),b.data.PRODUCT_DETAILS.CUSTOMIZATION_OFFERED_FLAG)){this.personalizedSku=[];let d=b.data.PRODUCT_DETAILS.VENDOR_ID[0];for(const f of b.data.SKU_DETAILS){let g=f.SKU_ID,h=sessionStorage.getItem(`personalized-${g}`);h&&await this.venderPersonalizeDataGet({sku:g,refnum:h,vendorId:d})}this.personalizeModalRender(c,b.data.PRODUCT_DETAILS.SKU_ID)}b=await this.pwa.pdpDataAbstraction.getSkuDetails(c);this.personalizedSku[b.SKU_ID]?(a.addClass("personalized"),a.closest("body").find("#stickyCtaList").addClass("personalized")):
(a.removeClass("personalized"),a.closest("body").find("#stickyCtaList").removeClass("personalized"))}async ampListPostRenderPersonalize(a){if(a.is("#stickyCtaList")&&a.is(".personalized")){var b=this.pwa.site.prodIdGet(new URL(location.href));b=await this.pwa.pdpDataAbstraction.getSkuDetails(b);a.find(".stickyPrice").html(this.personalizedSku[b.SKU_ID]["final-price"])}}closeModal(){$(this.pwa.session.docObjActive.shadowBody).find("#vendorIframeModal").removeClass("active");$("body").removeClass("modalOpen")}imageArrayUpdate(a,
b,c){c=this.personalizedSku[c];1===b?(c={description:(c.images[0].description||"").replace(/"/g,"&quot;"),idx:-1,personalizeUrl:c.imageURL_hires||c.images[0].previews[0].url,personalizeUrlSm:c.images[0].previews[3]?c.images[0].previews[c.images[0].previews.length-1].url:c.imageURL_hires||c.images[0].previews[0].url,type:"image"},a.unshift(c)):a=a.slice(1);a.forEach(d=>{d.idx+=b});return a}async openModal(a){let b=$(this.pwa.session.docObjActive.shadowBody);if(b.hasClass("pdp")){let c=b.find("#vendorIframeModal");
c.length&&c.attr("data-personalize-ready")||await this.pwa.util.waitForElement("#vendorIframeModal[data-personalize-ready]",b[0]);$("body").addClass("modalOpen");b.find("#vendorIframeModal").addClass("active");this.sendMessage(JSON.stringify({personalizeCallId:"personalizeParentCall",action:"updateVendorModal",skuId:a,refnum:this.personalizedSku[a]?this.personalizedSku[a].refnum:""}),b)}else{let c=0;const d=setInterval(()=>{b=$(this.pwa.session.docObjActive.shadowBody);c+=1;b.hasClass("pdp")?(clearInterval(d),
this.openModal(a)):5<c&&clearInterval(d)},150)}}async personalizeModalRender(a,b){var c=await this.pwa.amp.ampGetState(`pdpDet${a}`);(c=c.data.PRODUCT_DETAILS.VENDOR_ID?c.data.PRODUCT_DETAILS.VENDOR_ID[0]:"")?(a=await this.vendorUrlGet(a,b,c),a=this.vendorIframeTemplate(a),$(this.pwa.session.docObjActive.shadowBody).append(a),this.messageListenerAdded||this.addMessageListener()):console.warn("Personalize: personalizeModalRender, Couldn't get vendorId")}async personalizeParamRouter(a){await this.pwa.util.waitForProp("docObjActive",
this.pwa.session);a.skuId?this.openModal(a.skuId):(a=this.pwa.site.prodIdGet(new URL(location.href)),a=(await this.pwa.pdpDataAbstraction.getSkuDetails(a)).SKU_ID,this.openModal(a))}async removeData(a){let b=this.pwa.site.prodIdGet(new URL(location.href)),c=await this.pwa.amp.ampGetState(`pdpDet${b}`);if(c.data.PRODUCT_DETAILS.SKU_ID==a){var d=c.data.PRODUCT_DETAILS;d.IS_PRICE=d.notPersonalizePrice;delete d.notPersonalizePrice;delete d.personalized;d.PRODUCT_IMG_ARRAY=this.imageArrayUpdate(d.PRODUCT_IMG_ARRAY,
-1,a)}c.data.SKU_DETAILS.forEach(function(f){f.SKU_ID===a&&(delete f.personalized,f.IS_PRICE=f.notPersonalizePrice,delete f.notPersonalizePrice,f.PRODUCT_IMG_ARRAY=this.imageArrayUpdate(f.PRODUCT_IMG_ARRAY,-1,a))},this);$(this.pwa.session.docObjActive.shadowBody).find(".prodFulfillmentList2, #stickyCtaList").removeClass("personalized");delete this.personalizedSku[a];sessionStorage.removeItem(`personalized-${a}`);d={};d[`pdpDet${b}`]=c;this.pwa.amp.ampsSetState(d)}reportError(){$("body").addClass("modalOpen");
let a=this.reportErrorModalTemplate();$(this.pwa.session.docObjActive.shadowBody).append(a)}reportErrorModalClose(a,b){b.closest(".modal").remove()}reportErrorModalTemplate(){return'\n    <div id="vendorErrorModal" class="modal active">\n      <style>\n        .panelAlert {\n          background: #fff1f2;\n          border: 2px solid #f2c0c1;\n          border-radius: 5px;\n          line-height: 1.43;\n        }\n      </style>\n      <div class="modalContent flexModal">\n        <div class="flex midCtr modalContentInner parent">\n          <button class="btn modalClose" data-modal-close aria-label="Close vendor error Modal" type="button" data-click-handler="personalize.reportErrorModalClose()">\n            <svg class="wi wiClose noTap">\n              <use xlink:href="#wiClose"></use>\n            </svg>\n          </button>\n          <div class="vp05 gp1 panelAlert">\n            We are sorry! A system error occurred. Personalization isn\'t available for this product right now. Please call 1-800-GO-BEYOND\n            or email us at customer.service@bedbath.com for assistance.\n          </div>\n        </div>\n      </div>\n    </div>\n    '}sendMessage(a,
b){b=b.find("#vendorIframeModal iframe");b.length&&b[0].contentWindow.postMessage(a)}async updatePdp(a,b){let c=await this.pwa.amp.ampGetState(`pdpDet${a}`),d=this.personalizedSku[b];if(c.data.PRODUCT_DETAILS.SKU_ID==b){var f=c.data.PRODUCT_DETAILS;f.personalized=d;f.notPersonalizePrice=f.IS_PRICE;f.IS_PRICE=d["final-price"];f.PRODUCT_IMG_ARRAY=this.imageArrayUpdate(f.PRODUCT_IMG_ARRAY,1,b)}c.data.SKU_DETAILS.forEach(function(g){g.SKU_ID===b&&(g.personalized=d,g.notPersonalizePrice=g.IS_PRICE,g.IS_PRICE=
d["final-price"],g.PRODUCT_IMG_ARRAY=this.imageArrayUpdate(g.PRODUCT_IMG_ARRAY,1,b))},this);$(this.pwa.session.docObjActive.shadowBody).find(".prodFulfillmentList2, #stickyCtaList").addClass("personalized");f={};f[`pdpDet${a}`]=c;this.pwa.amp.ampsSetState(f)}async vendorDetailsGet(a){if(this.vendorDetails&&this.vendorDetails.data&&this.vendorDetails.vendorId==a)return this.vendorDetails.data.data.keysConfig[`/configs/vendorConfig/vendorInfo/${a}`];this.vendorDetails={data:await (await fetch(`${location.origin}/apis/stateless/v1.0/config/v3/site-configs/vendorconfig/vendorinfo/${a}?caller=xt`,
{credentials:"include",method:"GET",headers:Object.assign({"Content-Type":"application/json, text/plain, */*","x-bbb-site-id":this.pwa.session.siteId})})).json(),vendorId:a};return this.vendorDetails.data.data.keysConfig[`/configs/vendorConfig/vendorInfo/${a}`]}vendorIframeTemplate(a){return`
    <style>
      #vendorIframeModal {
        background: none;
        overflow-y: hidden;
      }
    </style>
    <div id="vendorIframeModal" class="modal">
      <iframe
        class="s12 h100"
        src=${a}
        title="Personalize Vendor Modal"
      >
      </iframe>
    </div>
    `}async venderPersonalizeDataGet(a){let b=a.sku;var c=await (await fetch(`${location.origin}/apis/services/catalog/v2.0/personalization/price?vendorId=${a.vendorId||this.vendorDetails.vendorId}&sku=${b}&refNum=${a.refnum}&siteId=${this.pwa.session.siteId}&channel=DesktopWeb`,{credentials:"include",method:"GET",headers:Object.assign({"Content-Type":"application/json","x-bbb-site-id":this.pwa.session.siteId})})).json();Object.assign(a,c.data.customizations[0]);this.personalizedSku[b]&&await this.removeData(b);
this.personalizedSku[b]=a;c=this.pwa.site.prodIdGet(new URL(location.href));sessionStorage.setItem(`personalized-${b}`,a.refnum);this.updatePdp(c,b)}async vendorUrlGet(a,b,c,d){let f=await this.vendorDetailsGet(c);return`${location.origin}/amp/7865/vendorFrameV1.html?vendorId=${c}&siteId=${this.pwa.session.siteId}&prodId=${a}&skuId=${b}${d?`refnum=${d}`:""}&vendorDetails=${encodeURIComponent(JSON.stringify(f))}`}}
class Pdp{constructor(a){this.pwa=a;this.baseImgUrlReg=/https[^?]+/gi}async ampBeforeRenderPdp(a,b,c,d){function f(h){a.find("[data-filters]").filter(`
            [data-filters="filtersWrap"],
            [data-filters="${h}Active"]
            `).removeAttr("hidden")}if(this.pwa.session.docTests.isPDPReg.test(b.pathname)){this.pwa.session.ampStateUnstable=!0;a.find("#skuIdByColorSize").attr("expression"," ( !colorAndSize ? ( color ? getObj(prodStateId).data.SKU_DETAILS.filter( skuObj => skuObj.COLOR == color ) : size ? getObj(prodStateId).data.SKU_DETAILS.filter( skuObj => skuObj.SKU_SIZE == size ) : [] ) : (getObj(prodStateId).data.SKU_DETAILS.filter( skuObj => skuObj.COLOR == color && skuObj.SKU_SIZE == size.replace('&#x2F;', '/') ) ) )[0].SKU_ID || '' ");
this.collectionBeforeRender(a,b);a.find("#childView").length&&(a.find("#collections").addClass("accExpanded").find("#childProdsList").removeAttr("hidden"),a.find("#collections").length&&a.find("body").hasClass("pdpV21")?this.pwa.amp.ampSetStateBeforeRender(a,"childView",{active:!0,view:"list"}):a.find("body").hasClass("pdpV21")||this.pwa.amp.ampSetStateBeforeRender(a,"childView",{active:!0,view:"list"}));if(d){let h=this.pwa.site.prodIdGet(b),k=a.find("#skuSlides script")[0],l={};k&&(l=JSON.parse(k.textContent));
let m=l[d];d&&m?(a.find(".placeholder .prodSlide amp-img, .placeholder .prodSlideThumb, .placeholder img[data-hero]").each((p,n)=>{p=$(n);if(p.is(".prodSlideThumb"))return p.addClass("wHide");var q=p.attr("src");let t=m[0].imageId;n=`${this.pwa.session.apiInfo.scene7RootUrl}/${t}`;q&&t&&(q=q.replace(this.baseImgUrlReg,n),p.attr("src",q),q=p.attr("srcset"))&&(q=q.replace(this.baseImgUrlReg,n),p.attr("srcset",q))}),a.find(`#prodFulfillmentList${h}`).attr("pdpSkuIdUpdatePending",d)):a.find(`#prodFulfillmentList${h}`).attr("pdpSkuIdUpdatePending",
"ampBindTrigger")}["#prodSlideCarousel amp-img","#prodSlideSelector amp-img"].forEach(function(h){h=a.find(h).eq(0);h.length&&(h.html(`
          <img
            alt="${h.attr("alt")}"
            src="${h.attr("src")}"
            class="i-amphtml-fill-content i-amphtml-replaced-content"
          >
        `),h[0].outerHTML=h[0].outerHTML.replace(/amp-img/g,"amp-layout"))});this.pwa.quickView.quickViewBeforeRender(a.find("body"),b);/writeReview=/gi.test(b.search)&&await this.pwa.site.scrapeProdData(a,b);a.find("#prodDeliverZipList").attr("binding","always");var g="";c&&c.storeId&&(g+=`&bopisStoreId=${c.storeId}`);c&&c.sddZipcode&&(g+=`&sddStoreId=${c.sddStoreId||1}`);g&&a.find("\n                #prodSku,\n                #pricesList,\n                #freeShipAllList,\n                #outOfStockBtnList,\n                #otherCartsList,\n                #prodSkusAll,\n                #countdownTimer\n              ").each((h,
k)=>{k.setAttribute("src",k.getAttribute("src")+g)});/sdd=true/i.test(b.search)&&(f("sdd"),this.pwa.amp.ampSetStateBeforeRender(a,"skuFacets",{sddActive:!0}),this.pwa.amp.ampSetStateBeforeRender(a,"pdpCtaType","deliverIt"));/pickup=true/i.test(b.search)&&(f("bopis"),this.pwa.amp.ampSetStateBeforeRender(a,"skuFacets",{bopisActive:!0}),this.pwa.amp.ampSetStateBeforeRender(a,"pdpCtaType","pickItUp"));/gift-card\//i.test(b.pathname)&&a.find("div#payOption").remove();a.find("[data-init-height]").each((h,
k)=>{try{const l=$(k),m=JSON.parse(l.attr("data-init-height")),p=Object.entries(m).filter(([n])=>parseInt(n)<=window.innerWidth).pop();p&&l.attr("height",p[1]);l.is("[data-setParentMinHeight]")&&l.parent().css("min-height",p[1])}catch(l){console.log("unable to set amp-list initial height based on document width")}});this.pwa.session.features.pdpKlarna?a.find("div#payOption div.klarna").css({display:"block"}):a.find(".paymentOption.klarna").remove();this.pwa.session.features.pdpShowShowMorePaymentsLink||
(a.find("div#payOption div.moreOptions").hide(),this.pwa.session.features.pdpKlarna?a.find("div#payOption").css({height:"auto","min-height":"72px"}):a.find("div#payOption").css({height:"auto","min-height":"46px"}));c=a.find("#PLA-ads-container");this.pwa.session.features.pdpPla&&b.searchParams.has("mcid")?(b=a.find("style[amp-custom]"),b.text(b.text()+"\n        #PLA-ads {\n          min-height: 640px;\n        }\n        .amp-sacrifice.plaItem {\n          height: auto;\n          line-height: 1.2;\n        }\n        div.plaItem:nth-of-type(n + 5) {\n          display: none;\n        }\n        .showMore div.plaItem:nth-of-type(n + 5) {\n          display: block;\n        }\n        .bRad05 {\n          border-radius: 0.5rem;\n          overflow: hidden;\n        }\n        @media (min-width: 31rem) {\n          .ph6 {\n            width: 50%;\n          }\n        }\n        @media (min-width: 48rem) {\n          .plaContainer {\n            margin-top: 3rem;\n          }\n          div.plaItem:nth-of-type(n + 4) {\n            display: none;\n          }\n          .showMore div.plaItem:nth-of-type(n + 4) {\n            display: block;\n          }\n        }\n        @media (min-width: 64rem) {\n          #PLA-ads {\n            min-height: 664px;\n          }\n          div.plaItem:nth-of-type(n + 4) {\n            display: block;\n          }\n          div.plaItem:nth-of-type(n + 5) {\n            display: none;\n          }\n          .showMore div.plaItem:nth-of-type(n + 5) {\n            display: block;\n          }\n        }\n        @media (min-width: 80rem) {\n          #PLA-ads {\n            min-height: 691px;\n          }\n        }\n      "),
c.removeClass("wHide")):c.remove();this.pwa.session.pdpBreadcrumb&&0<this.pwa.session.pdpBreadcrumb.length&&this.setPdpBreadcrumb(a);this.pwa.desktop.ampBeforeRenderPdp(a)}}async ampListPostRenderPdp(a){this.scrollAfterListLoad(a);if(a.is(".pricesList"))return this.pwa.util.resetListHeight(a),this.pwa.site.updatePaymentOptionPriceLabels();if(a.is("#accList"))this.pwa.site.socialAnnexPosition(),window.pdpLoadChildProdData&&window.pdpLoadChildProdData();else if(a.is(".prodAttr2List")&&(this.pwa.util.resetListHeight(a),
a.find(".attrWrapper").eq(1).outerHeight()>a.height()&&a.height(a.find(".attrWrapper").eq(1).outerHeight())),a.is("#prodTitleList,.prodTitleList2"))this.pwa.util.resetListHeight(a);else{if(a.is(".prodFulfillmentList,.prodFulfillmentList2")){this.pwa.util.resetListHeight(a);/type=oosForm/gi.test(location.search)&&this.pwa.site.pdpOosAmpHandler(a);var b=a.attr("pdpSkuIdUpdatePending");console.log("pendingStatus",b);if(b){if("ampBindTrigger"!=b){b=a.closest("body");var c=this.pwa.site.prodIdGet(new URL(location.href));
c=await this.pwa.amp.ampGetState(`pdpDet${c}`);b.find(".prodTitle").html(c.data.PRODUCT_DETAILS.DISPLAY_NAME)}a.removeAttr("pdpSkuIdUpdatePending")}this.pwa.session.features.registryEnable&&this.pwa.user.hasRegistry&&this.pwa.registry.renderCtaMenuFlag&&(b=a.find(".registryCta"),b.length&&this.pwa.registry.registryCtaMenuRender(b,!0));await this.pwa.personalize.addVendorModal(a)}a.is(".collegeFulfillList1")&&this.pwa.college.isCollege&&this.pwa.college.modifyBopisMsg(a);a.is(".prodRatings2, .prodRatings")&&
this.pwa.pdp.stickyReviewsWidth(a);a.is(".colors2List")&&this.pwa.util.resetListHeight(a);a.is(".cProdCardList")&&this.pwa.pdp.tealiumPdpCollectionItemsEvents(a);a.is("#reviews,#qnaPreviewList")&&this.pwa.site.socialAnnexPosition()}}async tealiumPdpCollectionItemsEvents(a){if(!this.pwa.session.isFast&&(await this.pwa.util.waitForProp("pdpIOCallback").catch(c=>console.log(c)),window.pdpIOCallback)){var b=new IntersectionObserver(window.pdpIOCallback,{root:null,rootMargin:"0px",threshold:1});a.find(".cProdCard").each((c,
d)=>b.observe(d))}}async ampPostRenderPdp(a,b,c){this.pwa.session.docTests.isPDPReg.test(c)&&(this.pwa.quickView.quickViewPostRender(a),this.pwa.desktop.ampPostRenderPdp(a),this.pwa.site.recentlyViewedDataUpdate(b),this.pwa.session.isPdpV21||this.pwa.site.activatePaymentOptions(a),/collections/i.test(b.hash)&&document.addEventListener("ampStateIsStable",function(d){d.find('[data-interact="expandCollections"]').each((f,g)=>g.click())}.bind(null,a)),/reviews/i.test(b.hash)&&document.addEventListener("ampStateIsStable",
function(d){d.find('[data-cta="pdpProductReviewsClick"]').each((f,g)=>g.click())}.bind(null,a)),this.pwa.intersectHandlersRegister("prodDetailsIntersection",a[0],".prodDescCont",async(d,f)=>{this.pwa.site.checkSeoHeight(a,{limitContClass:"prodDescCont",btnClass:"descBtn",contClass:"descTxt",overlay:"showMoreCover"});return d.intersectHandlerUnregister("prodDetailsIntersection",f.target)}),this.pwa.intersectHandlersRegister("spectListRender",a[0],".specificationList",async(d,f)=>{if(0<f.intersectionRatio)return this.updateSpecs(a),
d.intersectHandlerUnregister("spectListRender",f.target)}),b=a.find("#marketplaceShippingCont"),b.length&&b.text().trim()&&!b.hasClass("wHide")&&(b.closest(".parent").addClass("vb25").find(".showMoreCover").remove(),a.find(".shippingPolicyBtn").remove(),b.children().removeAttr("[class]"),b.prev().remove()))}stickyReviewsWidth(a){var b=a.find('div[data-cta="pdpProductReviewsClick"]');let c=0;b.length&&(c=b.text().replace("Reviews","").trim().length);let d=12+8*c;a=a.closest("body").find("#stickyReviewsList");
b=0;a.length&&(b=a.width());d>b&&a.each((f,g)=>{$(g).width(`${d}px`)})}async updateStructuredData(){if(!this.pwa.session.features.pdpStructuredData)try{let a=this.pwa.appshell.elems.head.find("#ldData"),b=this.pwa.appshell.elems.head.find("#schemaGraph")||this.pwa.appshell.elems.body.find("#schemaGraph"),c=await this.pwa.pdpDataAbstraction.getSkuDetails();if((b||a)&&c){let d={};try{b.length&&!a.length?d=JSON.parse(b.html())["@graph"].find(f=>"Product"==f["@type"]):a.length&&(d=d=JSON.parse(a.html()))}catch(f){console.warn(`Unable to parse structured data. Error: ${f}`);
return}c.SKU_ID?(d.offers.availability=c.IS_EVERLIVING?"https://schema.org/Discontinued":c.ONLINE_INVENTORY||c.bopisAvailable||c.sddAvailable?c.data&&c.data.PRODUCT_DETAILS&&c.data.PRODUCT_DETAILS.storeOnly?"https://schema.org/InStoreOnly":0<c.BOPUS_EXCLUSION_FLAG?"https://schema.org/OnlineOnly":c.isBackorder?"https://schema.org/BackOrder":c.isPreorder?"https://schema.org/PreOrder":"https://schema.org/InStock":"https://schema.org/OutOfStock",d.sku=c.SKU_ID,(/skuId=[0-9]+/.test(location.search)||c.data.params.skuId!=
c.SKU_ID)&&d.offers&&(d.offers["@type"]="Offer",d.offers.price=c.IS_PRICE.replace("$",""),delete d.offers.lowPrice,delete d.offers.highPrice)):d.offers.availability="Positive"==c.ONLINE_INVENTORY||1==c.ONLINE_INVENTORY?"https://schema.org/InStock":c.storeOnly||c.data&&c.data.PRODUCT_DETAILS&&c.data.PRODUCT_DETAILS.storeOnly?"https://schema.org/InStoreOnly":"https://schema.org/OutOfStock";d.name=c.DISPLAY_NAME;b.length&&!a.length?d.aggregateRating.itemReviewed.name=c.DISPLAY_NAME:a.length&&(d.aggregateRating.name=
c.DISPLAY_NAME);d.image=this.pwa.session.apiInfo.scene7RootUrl+"/"+c.PRODUCT_IMG_ARRAY[0].imageId;if(b.length&&!a.length){const f=JSON.parse(b.html());f["@graph"].splice(2,1,d);b.html(JSON.stringify(f))}else a.length&&a.html(JSON.stringify(d))}}catch(a){}}setPdpBreadcrumb(a){try{a.find("#productScript .breadcrumbs2 a").remove();let b=a.find("[data-dynamic-breadcumb]");this.pwa.session.pdpBreadcrumb.map(c=>{b.append(`<a class="black capitalize breadcrumb2" href='${c.url}'>${c.value}</a>`)});return!0}catch{return console.warn(`pdp.setPdpBreadcrumb Unable to add pdp breadcrumb, Error: ${e}`),
!1}}async updateSpecs(a){try{let g=a.find("[data-specs-sku]");if(0==g.length)return!1;let h=await this.pwa.site.prodIdGet(new URL(location.href));if(h){var b=await this.pwa.pdpDataAbstraction.getSkuDetails(h),c=b.SKU_ID,d=a.find("#specificationTemplate");if(!c||!d||!b.SPECS)return!1;a={};a.items=b.SPECS.map(k=>{let [l,m]=Object.entries(k)[0];return{key:l,value:m}});await Promise.all([this.pwa.util.scriptAddMustache(),this.pwa.util.waitForProp("Mustache")]);var f=Mustache.render(d.html(),a);g.html(f);
return!0}}catch(g){return console.warn(`pdp.updateSpecs Unable to update, Error: ${g}`),!1}}async paymentToggle(a,b,c){a=b.closest("body");await this.pwa.site.activatePaymentOptions(a);b=b.next();""==b.attr("hidden")||b.attr("hidden")?b.removeAttr("hidden"):b.attr("hidden","true")}async collectAddToShopList(a,b,c){try{let d=b.closest("form").find('[name="products"]').val();d=d.replace(/,]/gi,"]");let f=JSON.parse(decodeURIComponent(d)).reduce((g,h,k)=>{"0"!==h.qty&&g.push([h.prodId,h.skuId]);return g},
[]);this.pwa.user.bulkShoppingListAdd(f)}catch(d){return console.log(`pdp.collectAddToShopList error. Error: ${d}`),!1}return!0}async copySocialUrl(a,b,c){try{const d=b.closest(".modalContentInner").find(".shareTxt").val();await navigator.clipboard.writeText(d)}catch(d){console.warn(`Error trying to copy to clipboard. Error: ${d}`)}}async collectionParamRouter(a,b){this.pwa.site.cartAdd(a,b)}collectionBeforeRender(a,b){if("collectionAtc"===b.searchParams.get("type")){try{let c=JSON.parse(decodeURIComponent(b.searchParams.get("products")).replace(/},]/i,
"}]")),d=c.reduce((f,g)=>f+=`<div class="static pixel">
        <amp-state id="pdpDet${g.prodId}"
            data-amp-replace="TIMEZONE"
            src="${this.pwa.session.apiInfo.apiPdpDetails}${g.prodId}${this.pwa.session.apiInfo.apiPdpParams}&isChild=true&tz=TIMEZONE&skuId=${g.skuId}${g.fulfillment?`&fulfillment=${g.fulfillment}`:""}${g.qty?`&qty=${g.qty}`:""}&allSkus=true&ssr=true"
        ></amp-state>
        </div>`,"");this.pwa.amp.ampSetStateBeforeRender(a,"collectionObj",c);a.find("#childProdsDataList").remove();a.find("#second").prepend(d);return!0}catch(c){console.warn(`pdp.collectionParamRouter Error: ${c}`)}return!1}}async collectionHydrate(){try{setTimeout(this.pwa.amp.ampsAmpStateIsStableEvt.bind(this),500);let a=await this.pwa.amp.ampGetState("collectionObj"),b={};for(const c in a)try{let d=parseInt(a[c].qty);b[`skuFacets${a[c].prodId}`]={qty:d,fulfillment:a[c].fulfillment}}catch(d){}await this.pwa.amp.ampsSetState(JSON.stringify(b))}catch(a){console.warn(`pdp.collectionHydrate: Error hydrating the collection data. Error: ${a}`)}}async collectionAmpToPwa(a){/type=collectionAtc/.test(location.search)&&
(a.closest("amp-list")[0].scrollIntoView({block:"end",behavior:"auto",inline:"center"}),this.pwa.pdp.collectionHydrate(),this.pwa.util.clearParams(["type","products","sddZip","storeId"],location.href))}async collectionAtcError(a){}scrollAfterListLoad(a){if(this.pwa.session.scrollToNode&&this.pwa.session.scrollList&&a.is(this.pwa.session.scrollList)){var b=a.closest("body").find(this.pwa.session.scrollToNode);delete this.pwa.session.scrollToNode;delete this.pwa.session.scrollList;0<b.length&&setTimeout(()=>
{b[0].scrollIntoView({behavior:"smooth"})},20)}}initScrollAfterListLoad(a){let [b,c]=a.split(",");$(this.pwa.session.docObjActive.shadowBody).find(b).hasClass("i-amphtml-layout")||(this.pwa.session.scrollToNode=c,this.pwa.session.scrollList=b)}}
class Plp{constructor(a){this.pwa=a;this.getFeedbackUrl=this.getFeedbackUrl.bind(this)}async ampPostRender(a){const b=this.pwa.session.docTests,c=location.pathname;b.isPLPReg.test(c)&&!b.isCLPReg.test(c)&&(this.yesNoFeedback(a),this.plpSddZipModalRender(a),a=await this.pwa.amp.ampGetState("prodList"),this.pwa.appshell.elems.head.find('meta[name="robots"]').remove(),this.pwa.appshell.elems.head.append(`<meta name="robots" content="${a.metaSeoFacetValue}">`))}getFeedbackUrl(a,b){var c="https://secure.opinionlab.com/ccc01/comment_card_d.asp?referer=",
d=`https://search.${location.origin.replace("https://","")}&customVars=`;a:{var f=document.cookie.split(";");for(let g=0;g<f.length;g++){let h=f[g];for(;" "==h.charAt(0);)h=h.substring(1);if(0==h.indexOf("QuantumMetricSessionID=")){f=h.substring(23,h.length);break a}}f=""}a={QM:f,FULL_URL:location.href,Yes_No_Response:a};b&&(a.No_Response=b);return c+=encodeURIComponent(`${d}${JSON.stringify(a)}`)}async facetedPlpSeo(){const a=await this.pwa.amp.ampGetState("prodList");if(!(2<a.appliedFacets.length||
0===a.appliedFacets.length)){var b=["RATINGS","ATTRIBUTES_FACET","s_f_binProduct_Type"],c=a.appliedFacets.filter(k=>!b.includes(k.id)),d=new Map;c.forEach(k=>{a.facets.forEach(l=>{k.id===l.id&&(l=k.id,d[l]?d[l].value.push(k.value):d[l]={value:[k.value]})})});var f=["visualVariant.nonvisualVariant.SKU_FOR_SWATCH.COLOR_GROUP","BRAND","visualVariant.nonvisualVariant.SKU_FOR_SWATCH.SKU_SIZE"," s_f_binInterior_Construction_Material"],g=new Map,h=[];Object.keys(d).forEach(k=>{f.includes(k)?g[k]={value:`${d[k].value.join(" ")}`}:
h.push(`${d[k].value.join(" ")}`)});c=$("title").text().split(" | ")||[];$("title").attr("data-title")?c[0]=$("title").attr("data-title"):$("title").attr("data-title",c[0]);c=`${g["visualVariant.nonvisualVariant.SKU_FOR_SWATCH.COLOR_GROUP"]?`${g["visualVariant.nonvisualVariant.SKU_FOR_SWATCH.COLOR_GROUP"].value} `:""}${g.BRAND?`${g.BRAND.value} `:""}${g["visualVariant.nonvisualVariant.SKU_FOR_SWATCH.SKU_SIZE"]?`${g["visualVariant.nonvisualVariant.SKU_FOR_SWATCH.SKU_SIZE"].value} `:""}${g.s_f_binInterior_Construction_Material?
`${g.s_f_binInterior_Construction_Material.value} `:""}${c[0]} ${h.join(" ")}${1<c.length?" | "+c.at(-1):""}`;h.join(" ");$("title").text(c)}}plpSddZipModalRender(a){if(wmPwa.session.isCANADA)a.find("#sddZipcode").on("propertychange input",this.pwa.util.fixCaZipcode);else a.find("#sddZipcode").on("propertychange input",this.pwa.util.forceNumeric)}yesNoFeedback(a){const b=a.find(".feedbackCont");b.removeClass("pwaOnly");a=b.find("[data-feedbackLink]");0< !a.length||(a[0].href=this.getFeedbackUrl("Yes"),
b.find(".feedbackItm").on("click",function(c){c=c.target;b.find("[data-feedbackLink]")[1].href=this.getFeedbackUrl("No",c.dataset.feedbackitm)}.bind(this)))}async getPlpItemData(a){if(this.pwa.session.docTests.isPLPReg.test(location.pathname))try{return(await this.pwa.amp.ampGetState("prodList")).response.docs.filter(b=>b.PRODUCT_ID==a)[0]}catch(b){console.warn(`Error getting PLP prod item data from prodList. Error: ${b}`)}}getPlpBreadcrumbs(a){var b=[];if(this.pwa.session.docTests.isSearchReg.test(location.pathname))return b=
a.querySelector("#searchTitleList .catTitle").innerText,[{url:location.href,value:`Back to search results${b?" for "+b:""}`}];if(this.pwa.session.docTests.isPLPReg.test(location.pathname)){const c=(a=Array.from(a.querySelectorAll(".breadcrumbs li")))&&a.length;for(let d=0;d<c-1;d++)b.push({url:a[d].innerHTML.match(/href="([^"]*)/)[1],value:a[d].outerText.toLowerCase()});b.push({url:location.pathname,value:a[c-1].outerText.toLowerCase()});return b}}}
class PencilBanner{constructor(a){this.pwa=a;this.enabled=!0;try{this.enabled=sessionStorage.getItem("hideTopBanner")?!1:!0}catch(b){this.enabled=!1}this.appshellPencilBannerPlaceholder=$("#pencilBannerWrap");this.ampPencilBannerCss=`
    /* 1.15.21 moving Pencil Banner CSS into ampBeforeRender to reduce layout Shift */
    .hidePencil #headerWrap {
      transform: translateY(calc(var(--pencilBannerHeight) * -1));
    }
    .hidePencil .navWrap,
    .hidePencil .overlay {
      transform: translateY(var(--pencilBannerHeight));
    }
    .hidePencil .navWrap.catNav,
    .hidePencil .overlay.catNav {
      transform: translateY(0);
      height: calc(100vh - var(--headHeight) );
    }
    /* User has closed the pencil banner */
    .hidePencilAmp .navWrap.catNav,
    .hidePencilAmp .overlay.catNav {
      height: calc(100vh - var(--headHeight));
    }
    .hidePencilAmp .overlay.catNav {
      top: var(--headHeight);
    }
    @media (min-width: 80rem) {
      .hidePencil .navWrap,
      .hidePencil .overlay.active {
        transform: translateY(0);
        height: calc(100vh - var(--headHeight) );
      }
      .hidePencilAmp .navWrap.catNav {
        height: fit-content;
        top: calc(var(--headHeight) - 8px);
      }
      .hidePencilAmp .overlay.active {
        height: calc(100vh - var(--headHeight));
      }
    }

    #headerWrap {
      background: var(--hBackPri);
      transform: translateY(0);
      transition: transform 400ms ease-out;
      z-index: 100;
      will-change: transform;
    }
    .pencilBannerWrap {
      background-color: ${this.pwa.session.isBABY?"#00a39b":"#002855"};
      ${this.pwa.session.isBABY?"border-bottom: 1px solid #3fbbb1;":""}
      color: #fff;
      display: table;
      font-family: var(--fontMain);
      box-sizing: border-box;
      height: var(--pencilBannerHeight);
      max-height: var(--pencilBannerHeight);
      overflow: hidden;
    }
    .tableRow {
      display: table-row;
      height: 100%;
    }
    .pencilBannerContent {
      color: #fff;
      display: table-cell;
      height: var(--pencilBannerHeight);
      line-height: 1.2;
      margin: 0;
      padding-right: var(--pencilBannerHeight);
      text-align: center;
      vertical-align: middle;
      width: 100%;
    }
    .pencilBannerContent a {
        color: inherit;
    }
    .btn.pencilBannerClose {
      background: none;
      border: none;
      padding: .5rem;
      position: absolute;
      right: 0;
      top: 0;
      color: currentColor;
      height: var(--pencilBannerHeight);
    }
    #pencilObserver {
        display: block;
        position: relative;
        height: var(--pencilBannerHeight);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 100%;
    }
    .pencilSpacer,
    .pencilObserver {
      height: var(--pencilBannerHeight);
    }
    .pencilSpacer {
      pointer-events: none;
    }
    @media (max-width: 767px) {
      .hidePencil #searchcontainer#searchcontainer {
        top: var(--pencilBannerHeight);
      }
    }

    /* amp-list Pencil banner  */
    #pencilBannerWrap > :first-child {
      height: var(--pencilBannerHeight);
      overflow: hidden;
      padding-right: var(--pencilBannerHeight);
    }
    `}ampBeforeRender(a,b){if(!b.searchParams.has("quickView")){b=a.find(".pencilBannerAL");b.length||(b=a.find("#pencilBannerAL"));if(b.length)a.closest("html").find("style[amp-custom]").each((c,d)=>{d.innerHTML+=this.ampPencilBannerCss}),this.enabled||(b.remove(),a.find("#pencilBannerTemplate").remove(),a.addClass("hidePencilAmp"));else{if(!this.enabled)return;a.closest("html").find("style[amp-custom]").each((c,d)=>{d.innerHTML+=this.ampPencilBannerCss});a.find("#headerWrap").prepend('<div id="pencilBanner" class="s12 midCtr pencilBannerWrap"></div>')}this.enabled&&
a.prepend('<div id="pencilObserver" class="pencilObserver"></div>')}}async ampPostRender(a){if(this.enabled){var b=a.find(".pencilBannerAL");b.length||(b=a.find("#pencilBannerAL"));if(b.length)b.on("tap click",this.remove.bind(this));else{let d;try{d=(await this.pwa.amp.ampGetState("user")).data.LOCAL_HEADER_PROMO}catch(f){throw this.pwa.errorCustom("Problem getting pencil data from user state",f);}if(!d.length||!/^</i.test(d[0]))return;a.find("#pencilBanner").removeClass("midCtr").html(`
        ${$(d[0]).addClass("s12 pencilBannerContent").outerHTML()}`);a.find("#pencilBanner p").append('<button\n              class="midCtr btn pencilBannerClose modalCloseJs"\n              aria-label="Close Marketing Banner"\n            >\n              <svg class="wi wiClose noTap">\n                <use xlink:href="#wiClose"></use>\n              </svg>\n            </button>\n          ');a.find("#pencilObserver, #pencilBanner, .pencilBannerAL, #pencilBannerAL").remove();a.find("#pencilBanner").on("tap click",
this.remove.bind(this))}var c=a[0];this.pwa.intersectHandlersRegister("pencilObserve",c,"#pencilObserver",(d,f)=>{0==f.intersectionRatio?c.classList.add("hidePencil"):c.classList.remove("hidePencil")});$("#wmShellContentWrap #headerWrap").remove()}}appshellBeforeRender(){this.appshellPencilBannerPlaceholder[this.enabled?"removeClass":"addClass"]("hide")}remove(a){if($(a.target).is(".modalCloseJs")){a=$(a.currentTarget).closest("body");a.find("#pencilObserver, #pencilBanner, .pencilBannerAL, #pencilBannerAL").remove();
a.removeClass("hidePencil");a.addClass("hidePencilAmp");a[0].pencilObserve.disconnect();try{window.sessionStorage.hideTopBanner=!0}catch(b){}}}}
class Quickview{constructor(a){this.pwa=a;this.quickViewBtn='\n    <div class="s12 midCtr btnQuickViewWrap">\n      <div class="vb05 btn btnOutlinePrimary btnQuickView">\n        Quickview\n      </div>\n    </div>';this.quickViewLoaded=!1}quickViewOpen(a){}quickViewClose(a){a&&this.pwa.util.stopEvent(a);$("body").removeClass("pdpActive quickViewAppshell");this.quickViewLoaded=!1}quickViewBeforeRender(a,b){}quickViewPostRender(a){}}
class FindMyCollege{constructor(a){this.enabled=!1;this.pwa=a;a=location.origin+"/apis/stateless/v1.0/college/colleges-by-state/";const b=location.origin+"/apis/stateless/v1.0/college/colleges-by-id/?college_id=";this.ampFindMyCollegeCss="\n      .findMyCollegeCont {\n        margin: 2rem auto;\n      }\n      .findMyCollegeCont .radItm:hover {\n        background-color: #d6d6d6;\n      }\n      .findMyCollegeBtn {\n        height: 50px;\n      }\n    ";this.collegeSelector=`
    <amp-state id="collegeInfo" src="" [src]="changeCollege.collegeId ? '${b}' + changeCollege.collegeId : ''"></amp-state>
    <amp-state id="stateNames">
      <script type="application/json">
        ["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"]
      </script>
    </amp-state>
    <amp-state id="schoolNames" src=""
      [src]="changeCollege.selection.stateName ? '${a}' + changeCollege.selection.stateName :
      ''">
      </amp-state>

    <div class="t10 flex midCtr findMyCollegeCont">
      <span class="t3 gr05 txtCenter">find the closest store to your college</span>
      <div class="t3 gr1 clIpt">
        <button
          class="s12 txtLeft borderNone radBtn mid flex just vCtr hBet"
          on="tap:AMP.setState({changeCollege: {searchStateModal: true}})"
          data-test="csstateSearchBtn"
        >
            <span
              class="parent bold lineClamp1 txtBlk"
              style="bottom: -3px"
              [text]="changeCollege.selection.stateName || 'State'"
              >State</span
            >
          <svg
            class="vt05 vb025 gr025 wi-down-arrow"
            xmlns="http://www.w3.org/2000/svg"
            height="16"
            width="16"
            viewBox="0 0 12.01 6.15"
            style="height: 23px; margin-right: 15px; width: 14px"
          >
            <path
              fill="#8c8c8c"
              d="M6 6.15a1.07 1.07 0 01-.6-.2l-5-4.2A1 1 0 01.25.35a1 1 0 011.4-.1L6 3.85l4.4-3.6a1 1 0 011.4.1 1 1 0 01-.1 1.4L6.65 6a1.85 1.85 0 01-.65.15z"
              data-name="Filter/Arrow/Down"
            ></path>
          </svg>
        </button>
        <div
          class="s12 vp1 gp05 fill whiteBg absolute ssMRad findCollegeStateModal hide"
          [class]="'s12 vp1 gp1 fill whiteBg absolute ssMRad findCollegeStateModal ' + (changeCollege.searchStateModal ? '' : 'hide')"
        >
          <button
            class="absolute ctr txtBlk borderNone btnLink ssClose"
            on="tap:AMP.setState({changeCollege: {searchStateModal: false}})"
          >
            <svg
              class="gr025 wi-close"
              xmlns="http://www.w3.org/2000/svg"
              height="16"
              width="16"
              viewBox="0 0 10.49 10.48"
            >
              <g data-name="Layer 2">
                <path
                  d="M5.24 3.83L8.78.29a1 1 0 111.41 1.41L6.66 5.24l3.54 3.54a1 1 0 11-1.41 1.41L5.24 6.66l-3.53 3.53A1 1 0 01.29 8.78l3.54-3.54L.29 1.71A1 1 0 011.71.29z"
                  data-name="Layer 1"
                ></path>
              </g>
            </svg>
          </button>
          <div class="modalBody">
            <amp-selector
              class="
                radList
                i-amphtml-element i-amphtml-layout-container i-amphtml-built
              "
              on="select:AMP.setState({changeCollege: {
                selection:{
                  stateName: event.targetOption,
                },
                searchStateModal: false
              }})"
              i-amphtml-layout="container"
              role="listbox"
            >
              <amp-list
                layout="fixed-height"
                height="100"
                class="variableAmpList"
                src="amp-state:stateNames"
                items="."
              >
                <template type="amp-mustache">
                  <button
                    class="s12 whiteBg txtBlk txtLeft borderNone radItm"
                    option="{{.}}"
                    >{{.}}</button
                  >
                </template>
              </amp-list>
            </amp-selector>
          </div>
        </div>
      </div>
      <div class="t3 gr1 clIpt">
        <button
          class="s12 txtLeft borderNone radBtn mid flex just vCtr hBet"
          on="tap:AMP.setState({changeCollege: {searchSchoolModal: true}})"
          data-test="csstateSearchBtn"
          disabled
          [disabled]="!changeCollege.selection.stateName"
        >
            <span
              class="parent bold lineClamp1 txtBlk"
              style="bottom: -3px"
              [text]="changeCollege.schoolName || 'College'"
              >
                College
              </span>
          <svg
            class="vt05 gr025 wi-down-arrow"
            xmlns="http://www.w3.org/2000/svg"
            height="16"
            width="16"
            viewBox="0 0 12.01 6.15"
            style="
              height: 23px;
              margin-right: 15px;
              width: 14px;
            "
          >
            <path
              fill="#8c8c8c"
              d="M6 6.15a1.07 1.07 0 01-.6-.2l-5-4.2A1 1 0 01.25.35a1 1 0 011.4-.1L6 3.85l4.4-3.6a1 1 0 011.4.1 1 1 0 01-.1 1.4L6.65 6a1.85 1.85 0 01-.65.15z"
              data-name="Filter/Arrow/Down"
            ></path>
          </svg>
        </button>
        <div
          class="s12 vp1 gp05 fill whiteBg absolute ssMRad findCollegeSchoolModal hide"
          [class]="'s12 vp1 gp1 fill whiteBg absolute ssMRad findCollegeSchoolModal ' + (changeCollege.searchSchoolModal ? '' : 'hide')"
        >
          <button
            class="absolute ctr txtBlk borderNone btnLink ssClose"
            on="tap:AMP.setState({changeCollege: {searchSchoolModal: false}})"
          >
            <svg
              class="gr025 wi-close"
              xmlns="http://www.w3.org/2000/svg"
              height="16"
              width="16"
              viewBox="0 0 10.49 10.48"
            >
              <g data-name="Layer 2">
                <path
                  d="M5.24 3.83L8.78.29a1 1 0 111.41 1.41L6.66 5.24l3.54 3.54a1 1 0 11-1.41 1.41L5.24 6.66l-3.53 3.53A1 1 0 01.29 8.78l3.54-3.54L.29 1.71A1 1 0 011.71.29z"
                  data-name="Layer 1"
                ></path>
              </g>
            </svg>
          </button>
          <div class="modalBody">
            <amp-selector
              class="
                radList
                i-amphtml-element i-amphtml-layout-container i-amphtml-built
              "
              on="select:AMP.setState({changeCollege: {
                selection:{
                  schoolName: event.targetOption,
                  collegeId: schoolNames.data.colleges.filter(x=>x.collegeName == event.targetOption)[0].collegeID
                },
                searchSchoolModal: false
              }})"
              i-amphtml-layout="container"
              role="listbox"
            >
              <amp-list
                layout="fixed-height"
                height="100"
                class="variableAmpList"
                src="amp-state:empty"
                [src]="changeCollege.selection.stateName ? schoolNames.data.colleges : empty"
                single-item
              >
                <template type="amp-mustache">
                  <button
                    class="s12 whiteBg txtBlk txtLeft borderNone radItm"
                    option="{{collegeName}}"
                    collegeseoname="{{collegeSeoName}}"
                    >{{collegeName}}</button
                  >
                </template>
              </amp-list>
            </amp-selector>
          </div>
        </div>
      </div>
      <button
        class="t3 bold btn clIpt findMyCollegeBtn"
        [class]="'t3 bold btn findMyCollegeBtn' + (changeCollege.selection.schoolName ? ' btnOutlinePrimary' : ' clIpt')"
        disabled [disabled]="!changeCollege.selection.schoolName"
        on="tap:AMP.setState({
          changeCollege: changeCollege.selection
        })"
        >
        Find your school
      </button>
    </div>



    `}ampBeforeRender(a,b){this.enabled&&(a.find("#findMyCollegePlaceholder").replaceWith(this.collegeSelector),a.closest("html").find("style[amp-custom]").each((c,d)=>{d.innerHTML+=this.ampFindMyCollegeCss}))}}
class Prefetch{constructor(a){this.pwa=a;this.prefetchSession=a.session.prefetch}prefetchCheck(a){return this.pwa.session.isPreview||this.pwa.session.isPreprod||this.pwa.session.isNoFetch||!this.prefetchSession.prefetchesAvailable||this.prefetchSession.prefetched[a]||a==location.pathname?!1:!0}async prefetchHandler(a,b){if(a.hasAttribute("data-intersecting")&&this.prefetchCheck(b.pathname)){try{--this.prefetchSession.prefetchesAvailable,this.prefetchSession.prefetched[b.pathname]=1,b.searchParams.delete("skuId"),
await fetch(b.href),this.prefetchSession.prefetchesAvailable+=1}catch(c){this.prefetchSession.prefetchesAvailable+=1}this.pwa.intersectHandlerUnregister("wmPrefetch",a)}}prefetchHandlerDelay(a,b){const c=a.prefetch,d=b.target;if(b.isIntersecting)d.setAttribute("data-intersecting",!0);else return d.removeAttribute("data-intersecting");b=new URL(d.href);const f=a.amp.ampUrl(b),g=a.util.urlObjGet(f);c.prefetchCheck(g.pathname,b.pathname)&&setTimeout(()=>{requestIdleCallback(c.prefetchHandler.bind(c,
d,g))},c.prefetchSession.prefetchDelay)}}
class Pwa{constructor(a,b){this.session={amp_sessionStorageIds:["changeStore","storeInfo"],amp_sessionStorage:{},amp_localStorageIds:[],amp_localStorage:{},docs:{primary:{docnum:"1",hostElem:document.querySelector("#wmHostPrimary"),shadowDoc:null,shadowBody:null,href:null},pdp:{docnum:"2",hostElem:document.querySelector("#wmHostPdp"),shadowDoc:null,shadowBody:null,href:null}},history:{},isInteractionReg:/^(?!a)a/i,isFast:/wmFast/i.test(location.search),pageLoad:0,prefetch:{prefetched:{},prefetchDelay:300,
prefetchesAvailable:5},titleDefault:"",runSiteSpect:!0,isBABY:/baby/i.test(location.hostname)?!0:!1,isCANADA:/ca/i.test(location.hostname)?!0:!1,isHARMON:/harmonfacevalues/i.test(location.hostname)?!0:!1,isBBB_US:/www\.bedbathandbeyond\.com|bbbyapp/i.test(location.hostname)?!0:!1};this.sessionInit(b);this.regExp={hash:/#.*/i,scrollTo:/(\w+).scrollTo/i,tmAndReg:/-(trade|tm|reg)-/gi};a.requestIdleCallback=a.requestIdleCallback||function(c){var d=Date.now();return setTimeout(function(){c({didTimeout:!1,
timeRemaining:function(){return Math.max(0,50-(Date.now()-d))}})},1)};$.fn.extend({outerHTML:function(){return this.get().map(c=>c.outerHTML).join("\n")}});this.util=new Util(this);this.$$$=this.util.querySelectorAllDomAndTemplate;this.amp=new Amp(this);this.appshell=new Appshell(this);this.analytics=new Analytics(this);this.college=new College(this);this.desktop=new Desktop(this);this.ideaboard=new Ideaboard(this);this.imgZoom=new ImgZoom(this);this.pdpStickyNav=new PDPStickyNav(this);this.mo=new Mo(this);
this.navPanel=new NavPanel(this);this.paginatedSlider=new PaginatedSlider(this);this.personalize=new Personalize(this);this.plp=new Plp(this);this.pdp=new Pdp(this);this.pencilBanner=new PencilBanner(this);this.findMyCollege=new FindMyCollege(this);this.prefetch=new Prefetch(this);this.sayt=new Sayt(this);this.pickItModal=new PickItModal(this);this.deliveryModal=new DeliveryModal(this);this.cart=new Cart(this);this.site=new Site(this);this.user=new User(this);this.session.features.registryEnable&&
(this.registry=new Registry(this));this.quickView=new Quickview(this);this.pwa=this;this.win=a;this.win.addEventListener("popstate",c=>{setTimeout(this.historyPopStateHandler.bind(this,c),0)});if(this.pwa.util.isDesktop())for(const c of Object.values(this.session.docs))this.util.scrollEvtThrottle(this.headerScrollFn,c.hostElem.parentNode,100)}async blurBodyHandler(a,b){a=b.target;"filtersSearchInput"===a.id&&(this.session.pendingProdListHistoryUpdate=!0);if($(a).is(".setQtyInputJs"))try{let c={};
if($(a).hasClass("collectionQtyDD")){let d=Math.abs(parseInt(b.target.value));d=d?d:0;const f=$(a).parent().find(".scrollTarget").attr("id").replace("qtyListTarget","");c[`skuFacets${f}`]={qty10plus:10<=d?!0:!1,qty:d}}else{let d=await this.pwa.pdpDataAbstraction.getPDPState("skuFacets"),f=Math.abs(parseInt(d.qty));f=f?f:1;10>f&&(c[`skuFacets${this.pwa.site.prodIdGet(new URL(this.pwa.session.docs.pdp.href))}`]={qty10plus:!1,qty:f})}this.pwa.amp.ampsSetState(c)}catch(c){console.warn("Unable to parse qauntity from skuFacets")}}headerScrollFn(a){a=
window.scrollY;a!=this.session.docObjActive.lastScrollPosition&&(100<a&&a>this.session.docObjActive.lastScrollPosition?$(this.session.docObjActive.shadowBody).addClass("miniHeader"):$(this.session.docObjActive.shadowBody).removeClass("miniHeader"),this.session.docObjActive.lastScrollPosition=a)}clickAncestorHref(a){for(a=a.target;a&&("A"!=a.tagName||!a.href);)a=a.parentElement;if(!a||!a.href)return null;var b=a.getAttribute("target")||"_self";b=!/_(self|top|parent)/i.test(b);let c=a.hasAttribute("download");
return b||c?null:a.href}async clickBodyHandler(a,b){let c=$(b.target);if(!c.is(".wmHost")){this.pwa.session.isDebug&&console.trace("Click Event",a,b);if(b.defaultPrevented)return!1;var d=!1;this.site.tealiumClickEventEmitter(b.target.cloneNode(!1));var f=$(".registryFooterPanel");!this.pwa.session.features.registryEnable||!f.length||c.is("[data-registry-footer]")||c.closest(".registryFooterPanel").length||c.closest("[data-registry-footer]").length||this.pwa.registry.closeRegistryFooterPanel();this.pwa.session.features.registryEnable&&
this.pwa.user.hasRegistry&&this.pwa.registry.renderCtaMenuFlag&&delete this.pwa.registry.renderCtaMenuFlag;this.pwa.util.scrollToggle(a,c);c.is(".klarnaInfoIcon,.afterPayInfoIcon")&&(d=!0,this.pwa.site.paymentOptionClick(c));c.is("#payToggle")&&this.pwa.site.activatePaymentOptions(c.closest("body"));c.is(".clGps")&&this.pwa.site.getCurrLocation(c,"bopis");c.is(".useGpsForZipJs")&&this.pwa.site.getCurrLocation(c,"sdd");(f=c.attr("data-click-handler"))&&this.dataEventHandlerParseAndCall(f,c,b);if(!this.pwa.navPanel.navDskCategoryBtnClickDebounce(c)){f=
$(b.target).attr("href");try{var g=this.pwa.session.ctaParams;for(let k=0;k<g.length;k+=1){var h=g[k];if((new RegExp(h,"gi")).test(f)){const l=new URL(f);this.pwa.site.scrapeProdData($(a.shadowBody),l,h);d=!0}}}catch(k){console.warn(`Unable to get CTA parameters from pwa session or error matching parameters to url. Error ${k}`)}c.is("[data-cls],.btnSize,.swatchTap")&&(this.pwa.site.socialAnnexHide(),setTimeout(this.pwa.site.socialAnnexPosition.bind(this),600));768<=window.innerWidth&&(this.pwa.site.dskCloseOnClick(b),
$(b.target).hasClass("filterModal")&&this.pwa.amp.ampsSetState({plpModals:{dskFilter:!1}}),this.pwa.desktop.plpFacetClick($(b.target),a.shadowBody),c.is("\n        .modal.active,\n        .modalImg.active,\n        .modalActive.filtersReviewsCont\n      ")&&(this.pwa.amp.ampsSetState({u:{modalDynamic:null,modalImg:null,modalZip:null,reviewsExpanded:null,storePickupModal:null,qa:null,vendorModal:!1,cartError:!1}}),$("body").removeClass("modalOpen")));c.is(".fullProdDet")&&this.pwa.quickView.quickViewClose(b);
g=$(b.target).attr("data-dsk-click");"string"==typeof g&&"categories"==g.toLowerCase()&&this.pwa.desktop.initDskMenu(c.closest("body"));c.is('#prodBopisCbPwa, [data-click="changeStore"], .nav1Btn, .navBack, .navItem')&&setTimeout(this.amp.ampStoreAmpStates.bind(this.amp),200);c.hasClass("oosFormCancel")&&(b.preventDefault(),c.closest("body").removeClass("modalOpen"),this.pwa.amp.ampsSetState({u:{outOfStockModal:!1}}));c.is(".linkClearRecent")&&this.site.recentSearchClear();if(c.is(".sliderControl"))this.pwa.paginatedSlider.sliderClick(b);
else{if(g=this.clickAncestorHref(b))h=c.closest(".prodCardWrap, .adCard.overflowHidden"),h.attr("data-cta")&&this.site.tealiumClickEventEmitter(h.clone()[0]);c.is(".pdpTabLink2")&&setTimeout(async k=>{c.closest("body").find(".underline").attr("style","");c.closest("li").find(".underline").attr("style","opacity: 1;")},950);if(this.pwa.session.docTests.isPDPReg.test(location.pathname)&&$(a.shadowBody).find(".qtyOptionList").hasClass("active")&&!c.is(".qtyOpt")&&!c.is(".qtySelectBtn")){let k={};$(a.shadowBody).find(".qtyOptionList.active").each((l,
m)=>{try{let p=$(m).hasClass("ffOptionList")?"ffListTargetList":"qtyList",n=$(m).attr("id");(n=n.replace("qtyBtns","").replace("ffilmentBtns",""))&&`${p}${n}`!=c.attr("id")&&(k[`skuFacets${n}`]={qtyExpanded:!1,fullFillExpanded:!1},this.pwa.amp.ampsSetState(k))}catch(p){console.warn(`clickbody handler, error closing quantity. Error: ${p}`)}})}if(b.ctrlKey&&g||b.metaKey&&g)d=!0,window.open(g,"_blank");a&&g&&!d&&(d=void 0,c.is("[data-no-click-interaction]")||([,d]=await this.site.interactionParamRouter(this.util.urlObjGet(g))),
d||setTimeout(function(k,l){this.load(k,l)}.bind(this,g,a)),d=!0);d?this.util.stopEvent(b):/prodBopisCb|plpCb|plpPill|sort|plpPage/i.test(c.attr("class"))&&(this.session.pendingProdListHistoryUpdate=!0)}}}}errorCustom(a,b){let c=Error(a);c.data=b||{};if(this.session.isStaging){b={data:b,date:Date.now(),message:a,stack:c.stack};try{sessionStorage.setItem("pwaExpectedError",JSON.stringify(b))}catch(d){}console.log(b);if(this.session.isDebug&&"ampPageNotBuilt"!==a)debugger}return c}dataEventHandlerRegister(a){a.find("[data-change-handler]").each((b,
c)=>{b=$(c);c=b.attr("data-change-handler");b.on("propertychange input",this.pwa.dataEventHandlerParseAndCall.bind(this,c,null))})}async dataEventHandlerParseAndCall(a,b,c){if(a)if(a=a.replace(") ,","),"),/\),/.test(a)){const d=RegExp("(.*?\\)),","g");let f;for(;null!==(f=d.exec(a));)await this.dataEventHandleSingleCall(f[1].trim(),b,c);a=a.slice(a.lastIndexOf("),")+2);await this.dataEventHandleSingleCall(a.trim(),b,c)}else await this.dataEventHandleSingleCall(a,b,c)}async dataEventHandleSingleCall(a,
b,c){let [d,...f]=a.split(".");f=f.join(".");a=/\((.*)\)/i.exec(f||"");let g="";a&&(f=f.replace(a[0],""),g=a[1]);if(d&&f)try{return await this.pwa[d][f](g,b,c)}catch(h){console.log(`Error calling this.pwa[${d}][${f}]`,h)}}formSubmitHandler(a){try{let b=$(a.target);this.site.formSubmitRouter(b)&&this.util.stopEvent(a)}catch(b){console.log(b)}}formSubmitHandlerRegistration(a,b){b.addEventListener("submit",this.formSubmitHandler.bind(this),!0)}historyPopStateHandler(a){a=`${location.pathname}${location.search}`;
const b=new URL(this.session.docObjActive.href);a!=`${b.pathname}${b.search}`&&(this.session.history=this.session.history||{},a=this.session.history[location.href]||{},a.referrer&&this.util.referrerSet(a.referrer),this.session.popStateInProgress=!0,this.load(location.href))}historyPush(a){if(!(new URL(a.href||location.href)).searchParams.has("quickView"))if(this.session.popStateInProgress)this.session.popStateInProgress=!1;else{let b=this.session.history[a.href]||{};b.referrer=1==this.session.pageLoad?
document.referrer:window.location.href;this.session.history[a.href]=b;if(1!=this.session.pageLoad||this.pwa.session.redirectInProgress)this.pwa.session.redirectInProgress=!1,this.util.referrerSet(b.referrer),this.win.history.pushState(b,a.shadowDoc.title||this.session.titleDefault,a.href)}}intersectHandlersRegister(a,b,c,d,f){let g={rootMargin:"0px 50% 100% 50%",threshold:[0,1]};f&&Object.assign(g,f);if(!d||!b||!c)return console.error(this.errorCustom("Intersection observer missing required elements",
{element:b.outerHTML,selector:c,fn:d}));let h;f=b.closest("body");h=f[a]?f[a]:f[a]=new IntersectionObserver(k=>{k.forEach(d.bind(null,this))},{root:null,rootMargin:g.rootMargin,threshold:g.threshold});$(b).find(c).each((k,l)=>{try{h.observe(l)}catch(m){this.errorCustom("IntersectionObserver failed to run on anchor",{anchor:l,err:m})}})}intersectHandlerUnregister(a,b){const c=b.closest("body");c&&(a=c[a])&&a.unobserve(b)}async load(a){console.log(`version: ${this.session.appshellVersion}, loading: ${a}`);
try{let b=this.util.urlObjGet(a);[b]=await this.site.interactionParamRouter(b);const c=this.loadTypeGet(b);if(c.constructor==Error)throw c;if("isNotPwa"==c)return this.noLoad(b.href);if("isDiffDomain"==c)return window.location.href=a;if("isAnchorHashCurrentPage"==c)return this.util.scrollIntoView(this.session.docObjActive.shadowBody,b.href);await this.appshell.appshellBeforeRender(this.session);let d=this.loadDocGet(c,b);await this.amp.ampBeforeUnload(d);this.scrollPositionStore(this.session.popStateInProgress?
this.session.docObjActive.href:location.href);if("isAmp"==c)d=await this.amp.ampLoad(d,b);else if("isMo"==c)return await this.mo.moLoad(d,b);this.pwa.quickView.quickViewLoaded||this.scrollPositionRestore(b.href);this.appshell.appshellPostRender(this.session,d);b.hash&&this.util.scrollIntoView(d.shadowBody,b.hash);this.session.pageLoad+=1;this.session.redirectCount=0;this.historyPush(d);this.session.docObjActive=d;"isAmp"==c&&this.amp.ampPostRender(this.session.docObjActive,b);1==this.session.pageLoad?
requestIdleCallback(this.site.loadFirstPagePostRender.bind(this.site,this)):requestIdleCallback(this.site.scriptsEveryPagePostRender.bind(this.site));return"Successfully loaded"}catch(b){return this.loadErrorHandler(a,b)}}loadDocGet(a,b){if("isLoadedInOtherDoc"==a)for(const c of Object.values(this.session.docs)){if(c.href==b.href)return c}else{if("isAmp"==a)return this.session.docTests.isPDPReg.test(b.pathname)?this.session.docs.pdp:this.session.docs.primary;if("isMo"==a)return this.session.docs.mo}return this.session.docObjActive||
this.session.docs.primary}loadErrorHandler(a,b,c=!0){delete this.session.ampAnalyticsIframeHtml;delete this.session.pendingSkuSelection;this.session.docPrefetch=null;if("same url as current url"!=b.message)if("wompRedirect"==b.message)if(this.session.redirectCount+=1,3<this.session.redirectCount)this.noLoad(b.data);else try{let d=new URL(location.href),f=new URL(b.data);0==this.pwa.session.pageLoad&&f.searchParams.has("wmSkipPwa")&&d.pathname.includes(f.pathname)&&(/(mcid|utm_)=/i.test(d.search)||
d.pathname.includes("/store/brand"))&&(f=d,f.searchParams.set("wmSkipPwa",1));this.load(f.href)}catch(d){this.load(b.data)}else if("ampPageNotBuilt"==b.message&&(this.session.isStaging||this.session.isDebug))this.session.waitingForPageBuild=!0,setTimeout(function(d){this.load(d)}.bind(this,b.data.urlObj.href),1E3);else if(c){console.trace(b);if(this.pwa.session.isDebug)debugger;this.noLoad(a)}}loadTypeGet(a){if(!a)return this.errorCustom("Cannot load page, invalid href",a);if(a.hostname!==location.hostname)return"isDiffDomain";
if(0<this.session.pageLoad){for(var b of Object.values(this.session.docs))if(b!==this.session.docObjActive&&b.href==a.href)return"isLoadedInOtherDoc";if(0==this.session.popStateInProgress&&a.href==location.href)return this.errorCustom("same url as current url",a.href);if(0==this.session.popStateInProgress&&a.href.replace(this.regExp.hash,"")==location.href.replace(this.regExp.hash,""))return"isAnchorHashCurrentPage"}b=`${a.pathname}${a.search}`;var c=this.session.docTests;if(c.isNotPwaReg.test(b)||
!c.isPwaHostReg.test(a.hostname))return"isNotPwa";if(/wm(No|Skip)Pwa/i.test(a.search)||c.isMoReg.test(b))return"isMo";if(c.isAmpReg.test(b)){if(c.isPLPReg&&c.isPLPReg.test(b))if(c=a.pathname,b=/^\/store\/category\/(new-arrivals|clearance-savings)/i.test(c),c=c.replace(/^\/|\/\d+.*$/gi,""),c=c.split("/").length,5==c||b&&4==c)this.site.tealiumConfig.plpLevel="l3";else if(4==c||b&&3==c)this.site.tealiumConfig.plpLevel="l2";a.searchParams.has("quickView")&&(this.quickView.quickViewLoaded=!0);return"isAmp"}return"isMo"}modifyCbccSearch(a,
b){if(void 0==b.responseCBCC.concepts)a.closest("body").find(".cBccBanner").hide();else{var c="",d="";try{d=`${b.responseCBCC.concepts[0].numFound.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}`}catch(g){console.log(g)}var f=b.responseCBCC.concepts[0].url.replace(/\/store\/s\/.*/,"");f=`/apis/services/cbcc/redirect/v1.0/cookie-redirect?url=${encodeURIComponent(`${f}${location.pathname}${location.search}`)}`;/BuyBuyBaby/.test(b.responseCBCC.concepts[0].name)?c="buybuy BABY":/BedBathUS/.test(b.responseCBCC.concepts[0].name)?
c="Bed Bath & Beyond":/HarmonUS/.test(b.responseCBCC.concepts[0].name)&&(c="Harmon",f=f.replace(/store-\d*(?:%2F)?/,""));try{let g=a.closest("body").find("#cBccSearchLink");g.attr("href",f);g.contents()[0].replaceWith(`${c} (${d}) `);let h=a.closest("body").find(".cBccBanner a");h.attr("href",f);h.contents()[0].replaceWith(`${c} (${d} results) `);h.parent().parent().removeAttr("style")}catch(g){a.closest("body").find(".cBccBanner").hide()}}}noLoad(a,b=!1){if(this.session.isDebug){debugger;console.log("Reloading without PWA")}a=
new URL(a);a.searchParams.delete("wmPwa");b?(document.cookie="wmNoPwa=true; max-age=604800; path=/; secure",document.cookie="wmPwa=true; max-age=0; path=/; secure; expires=Thu, 01 Jan 1970 00:00:01 GMT;",a.searchParams.set("wmNoPwa","true"),this.sw.unregister()):a.searchParams.set("wmSkipPwa","true");window.stop&&window.stop();location.href=a.href}scrollPositionRestore(a){if(1!=this.session.appshellVersion){var b=this.session.history[a]||{scrollY:0};window.scroll(0,b.scrollY);this.session.history[a]=
b}}scrollPositionStore(a){if(1!=this.session.appshellVersion){this.session.history=this.session.history||{};var b=this.session.history[a]||{};b.scrollY=window.scrollY;this.session.history[a]=b}}scrollToHandler(a,b,c){this.util.scrollIntoView(a,b)}sessionInit(a){a=a||{};this.session.appshellVersion=document.body.getAttribute("data-version")||1;history.scrollRestoration="manual";Object.assign(this.session,a);this.session.docTests.isUnclosedBrandReg=/^\/store\/brand\/[^\/]+?\/[^\/]+$/i;this.session.docTests.isBrandReg=
/^\/store\/brand/i;/wmPwa/i.test(location.search)&&(this.session.isStaging=!0,/wmPla/i.test(location.search)&&(this.session.features.pdpPla=!0));/wmNoFetch/i.test(location.search)&&(this.session.isNoFetch=!0);this.session.docTests.isPDPReg=/\/store\/product\//i;this.session.docTests.isHomeReg=/^\/(store)?\/?(\?.*)?$/i;this.session.isMobile=this.session.userAgentConfig.mobile.reg.test(navigator.userAgent);this.session.isDebug=/wmDebug/i.test(location.search);this.session.features=this.session.features||
{};/wmPdpList/i.test(location.search)&&(this.session.features.pdpShoppingList=!0);/wmOptimized/i.test(location.search)&&(this.session.ampHost=`${this.session.ampHost}/wm-optimized`);/wmTopAd/i.test(location.search)&&(this.session.features.plpAboveFoldAd=!0);/wmPlpList/i.test(location.search)&&(this.session.features.plpShoppingList=!0);/wmPreorder/i.test(location.search)&&(this.session.features.sitePreorder=!0);/wmBackorder/i.test(location.search)&&(this.session.features.siteBackorder=!0);/wmIdeaboardV2/i.test(location.search)&&
(this.session.features.ideaboardV2=!0);/wmPla/i.test(location.search)&&(this.session.features.pdpPla=!0);/wmAtcModalV2/i.test(location.search)&&(this.session.features.atcEditQuantity=!0);if(this.session.docTests.isPLPReg.test(location.href)||this.session.docTests.isSearchReg.test(location.href))this.session.firstLoad=!0;/wmPla/i.test(location.search)&&(this.session.features.pdpPla=!0)}}
class Registry{constructor(a){this.pwa=a;this.registryItemAddedModal={data:null,dom:null,template:null};this.registryCta={data:null,dom:null,template:null};this.registryFooter={data:null,dom:null,template:null};this.registryNav={data:null,dom:null,template:null};this.registrySidebar={data:null,dom:null,template:null};this.caRegistryTypeIds={BA1:"300003",BRD:"300001",COL:"300006",HSW:"300004"};this.registryTypeIds={BA1:"200007",BRD:"200001",COL:"200005",HSW:"200004"};this.refConfig={Wedding:"48316",
Baby:"48342",Birthday:"48334",Retirement:"48334",Anniversary:"48334",Housewarming:"48334","College/University":"48338",University:"48338","Commitment Ceremony":"48316",Other:"48334",refID_BBY:"0",refID_REG:"0"};this.registryFooterClickHandler=this.registryFooterClickHandler.bind(this);this.registrySideBarClickHandler=this.registrySideBarClickHandler.bind(this);if(this.pwa.user.hasRegistry)try{this.pwa.site.interactions.push({paramKey:"action",paramVal:"appointment",handler:this.bookAppointmentRouted,
thisArg:this,stopNav:!0})}catch(b){console.warn(`Registry: Constructor, Could not add to param router Error: ${b}`)}this.init()}async activeRegistryChange(a,b){let c=a[0];this.registryFooter.rendered=!1;c.registryNavRendered=!1;c.registrySidebarRendered=!1;this.registryFooter.data=void 0;this.registryNav.data=void 0;this.registrySidebar.data=void 0;this.registryStoreFinderModal.data=void 0;try{b=`registryId=${b}`,await fetch(`${location.origin}/apis/stateful/v1.0/registry/active`,{method:"PUT",headers:Object.assign({accept:"application/json, text/plain, */*",
"atg-rest-depth":2,"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet()),body:b})}catch(d){console.warn(`Failed to call active registry change API. Error: ${d}`)}this.registryAllRender(a,location)}ampBeforeRender(a,b,c){this.pwa.user.hasRegistry&&this.pwa.session.registryAssetsPrefetch?(this.renderCtaMenuFlag=!1,this.ampBeforeRenderReserveSpace(a,b)):this.pwa.user.hasAcct&&this.ownRecommended&&this.ownRecommended.data&&this.ownRecommended.data.recommendedRegistryList&&
this.registryCtaBeforeRender(a,b)}ampBeforeRenderReserveSpace(a,b){this.isRegistryPage(b)&&(1024>window.innerWidth&&a.find("#wm_footer").addClass("hasRegistryFooter"),this.registryCtaBeforeRender(a,b))}backfillPdpCta(a){return 0==this.pwa.$$$(a[0],".registryCtaCont").length?($(this.pwa.$$$(a[0],".pdpQtyInputCont")).each(function(){0==$(this).closest("amp-list").length&&($(this).next("div.s9").addClass("fulfillCtaCont"),$(this).after('<div id="registryCtaCont" class="s12 vt1 wHide parent registryCtaCont">\n                <button class="btn btnLrg btnPrimary s12 registryCta{{^bopisAvailable}} bopisOOS{{/bopisAvailable}}{{^ONLINE_INVENTORY}} shipItOOS{{/ONLINE_INVENTORY}}" data-click-handler="registry.registryCtaClick"\n                [class]="\'btn btnLrg btnPrimary s12 registryCta{{^bopisAvailable}} bopisOOS{{/bopisAvailable}}{{^ONLINE_INVENTORY}} shipItOOS{{/ONLINE_INVENTORY}} \' + pdpCtaType">\n                    Add to Registry\n                    <svg viewBox="0 0 12.01 6.15" class="wi wiCaret g05 noTap"> <path d="M6 6.15a1.07 1.07 0 01-.6-.2l-5-4.2A1 1 0 01.25.35a1 1 0 011.4-.1L6 3.85l4.4-3.6a1 1 0 011.4.1 1 1 0 01-.1 1.4L6.65 6a1.85 1.85 0 01-.65.15z"></path> </svg>\n                  </button>\n              </div>'))}),
!0):!1}backfillPlpCta(a){if(0==this.pwa.$$$(a[0],".registryCtaCont").length){let b='{{^MARKETPLACE_ITEM_FLAG}}\n        {{^CUSTOMIZATION_OFFERED_FLAG_boolean}}\n          {{^MSWP_FLAG}}\n              \x3c!-- Registry --\x3e\n              <div class="s12 vt1 parent registryCtaCont {{^inventoryStatus_boolean}} shipItOOS{{/inventoryStatus_boolean}}{{^availableInStore}} bopisOOS{{/availableInStore}}"\n              data-prod-reg=\'{"prodId": "{{PRODUCT_ID}}", "skuId":"{{SKU_ID.0}}", "price": "{{isPriceRangeStr}}", "parentProdId": "{{PRODUCT_ID}}", "title": "{{DISPLAY_NAME}}", "prodImg": "{{SCENE7_URL}}"}\'\n              [class]="\n              \'s12 vt1 parent registryCtaCont {{^inventoryStatus_boolean}} shipItOOS{{/inventoryStatus_boolean}}{{^availableInStore}} bopisOOS{{/availableInStore}}\' + (\n                  (\n                      \'{{COLLECTION_FLAG}}\' == \'1\'\n                  )\n                  ? \' hide\'\n                  : \'\'\n              )">\n                  <button class="btn btnLrg btnPrimary s12 registryCta" data-click-handler="registry.registryCtaClick"  data-reg-item=\'{qty:1,skuId:"{{#skuSelected}}{{skuSelected}}{{/skuSelected}}{{^skuSelected}}{{SKU_ID.0}}{{/skuSelected}}",prodId:"{{PRODUCT_ID}}",type:"registry"}\'>\n                      Add to Registry\n                      <svg viewBox="0 0 12.01 6.15" class="wi wiCaret g05 noTap"> <path d="M6 6.15a1.07 1.07 0 01-.6-.2l-5-4.2A1 1 0 01.25.35a1 1 0 011.4-.1L6 3.85l4.4-3.6a1 1 0 011.4.1 1 1 0 01-.1 1.4L6.65 6a1.85 1.85 0 01-.65.15z"></path> </svg>\n                  </button>\n              </div>\n            {{/MSWP_FLAG}}\n          {{/CUSTOMIZATION_OFFERED_FLAG_boolean}}\n        {{/MARKETPLACE_ITEM_FLAG}}\n      ';
$(this.pwa.$$$(a[0],".prodCardR .grow1")).after(b);b=b.replace(/registryCtaCont /gi,"registryCtaCont sswp{{TYPE}} ");$(this.pwa.$$$(a[0],".epCellCtaLink")).after(b);return!0}return!1}async bookAppointmentDataGet(){let a=(await this.registryNavDataGet()).data.activeRegistry;return{fn:a.primaryRegistrantFirstName||"",ln:"masked"==a.primaryRegistrantLastName?"false":a.primaryRegistrantLastName||"",coFn:a.coRegistrantFirstName||"false",coLn:"masked"==a.coRegistrantLastName?"false":a.coRegistrantLastName||
"false",email:/\*/.test(a.primaryRegistrantEmail)?"false":a.primaryRegistrantEmail||"",coEmail:/\*/.test(a.coRegistrantEmail)?"false":a.coRegistrantEmail||"",num:a.primaryRegistrantPrimaryPhoneNum||"false",regId:a.registryId||"",date:a.eventDate||"",eventType:a.eventType||""}}async bookAppointmentIframeModalTemplate(a){let b=await this.bookAppointmentDataGet();return`
      <style>
        .bAHead {
          font: 600 20px/1.4 var(--fontMain);
        }
      </style>
      <div id="bookAppointmentIframeModal" class="modal active">
        <div class="modalContent h100">
          <button class="btn modalClose" data-click-handler="registry.closeModal" data-modal-close aria-label="Close Modal" type="button">
            <svg class="wi wiClose noTap">
              <use xlink:href="#wiClose"></use>
            </svg>
          </button>
          <div class="modalContentInner flex col h100">
            <div class="vb1 txtCtr bAHead">Great! Let's book an appointment.</div>
            <div class="grow1 h100">
              <iframe
                class="s12 h100"
                src=${`https://bespoke.bookingbug.com/bbb${this.pwa.session.isPreprod?"/staging":""}/new_booking.html?abc=1&siteId=${this.pwa.session.isBBB_US?1:this.pwa.session.isBABY?2:3}&storeId=${a}&regFN=${b.fn}&regLN=${b.ln}&coregFN=${b.coFn}&coregLN=${b.coLn}&email=${b.email}&coregEmail=${b.coEmail}&contactNum=${b.num}&registryId=${b.regId}&eventDate=${b.date}&catID=${this.refConfig[b.eventType]?`&preselectedServiceRef=${this.refConfig[b.eventType]}`:""}`}
              >
              </iframe>
            </div>
          </div>
        </div>
      </div>
    `}bookAppointmentRadiusModalClick(a,b){if(b.is(".registryCsRadBtn")){a=b.closest(".modal").find(".registryRadiusModal");a.toggleClass("active");a.find(".registryRadiusBtn.active").removeClass("active");let c=b.find(".registryRadius").text();a.find(`[data-value='${c}']`).addClass("active")}b.is(".registryRadiusBtn")&&(b.closest("#modalRegistryStoreFinder").find(".registryRadius").text(b.attr("data-value")),this.closeModal("false",b))}async bookAppointmentRender(a,b){b&&b.length&&this.closeModal("true",
b);try{let c=await this.bookAppointmentIframeModalTemplate(a);$(this.pwa.session.docObjActive.shadowBody).append(c)}catch(c){console.warn(`Registry, bookAppointment: Couldn't add to shadowbody. Error: ${c}`)}}async bookAppointmentRouted(){if(!(1024<=window.innerWidth)){var [a]=await Promise.all([this.registryNavDataGet(),this.pwa.util.waitForProp("Mustache"),this.pwa.util.waitForProp("docObjActive",this.pwa.session)]);a&&a.data&&a.data.activeRegistry.favStoreId?this.bookAppointmentRender(a.data.activeRegistry.favStoreId):
this.bookAppointmentStoreFinderRender()}}bookAppointmentSeeMoreClick(a,b){b.closest(".registrySeeMore").addClass("active")}bookAppointmentStoreModalClick(a,b){a=b.find(".registryStoreForm");a.length&&(""!==a.find("#registryClFormLocale").val()&&a.removeClass("formErr"),b.find(".registryRadiusModal").removeClass("active"))}async bookAppointmentStoreFinderRender(){await this.pwa.util.waitForProp("registryStoreFinderModal",this);$("body").addClass("modalOpen");let a={geoLevel:this.pwa.session.isCANADA?
"City and Province, or Postal Code":"City and State, or Zip",isCA:this.pwa.session.isCANADA,isBABY:this.pwa.session.isBABY,measurement:this.pwa.session.isCANADA?"km":"miles",storeFinder:!0};try{const b=Mustache.render(this.registryStoreFinderModal.template,a);$(this.pwa.session.docObjActive.shadowBody).append(b)}catch(b){console.warn(`Registry, bookAppointmentStoreFinderRender: Couldn't add to shadowbody. Error: ${b}`)}}bookAppointmentStoreDataModify(a){a.searchResults.forEach(b=>{let c=0;try{c=parseInt((new RegExp(`{"bopusFlag":\\s"(\\d)","siteId":\\s"${this.pwa.session.siteId}"}`)).exec(b.fields.siteBopus)[1])}catch(d){}b.fields.bopisFlag=
c;b.distance=parseFloat(b.distance).toFixed(1);b.fields.hours=b.fields.hours.split(",");b.unitDistance=this.pwa.session.isCANADA?"km":"miles"})}async bookAppointmentStoreResultsRender(a,b,c){let d="";a="";c=b.closest("#modalRegistryStoreFinder").find(".registryStoreForm");var f=this.pwa.session.isCANADA;b.is(".registryCurrLocBtn")&&(d=await this.pwa.site.getCurrentLocation(),a=".storeResults");if(b.is(".registryStoreFinderSubmit")){a=c.find("#registryClFormLocale");if(""==a.val()){c.addClass("formErr");
return}c.removeClass("formErr");d=a.val();a=".modalContentInner"}let g=b.closest(".modal").find(".registryRadius").text();f=await (await fetch(`https://www.mapquestapi.com/search/v2/radius?key=Gmjtd%7Clu6120u8nh,2w%3Do5-lwt2l&inFormat=json&json=%7B%22origin%22:%22${d}%22,%22hostedDataList%22:[%7B%22extraCriteria%22:%22(+%5C%22display_online%5C%22+%3D+%3F+)+and+(+%5C%22store_type%5C%22+%3D+%3F+${f?"or+%5C%22country%5C%22+%3D+%3F+":""})%22,%22tableName%22:%22mqap.34703_AllInfo${this.pwa.session.isPreprod?
"_dev":""}%22,%22parameters%22:[%22Y%22,%22${f?"50%22,%22CA%22":"10%22"}],%22columnNames%22:[]%7D],%22options%22:%7B%22radius%22:%22${g}%22,%22maxMatches%22:${f?"100":"20"},%22ambiguities%22:%22ignore%22,%22units%22:%22${f?"k":"m"}%22%7D%7D`)).json();f.searchResults?(this.bookAppointmentStoreDataModify(f),c=Mustache.render(this.registryStoreFinderModal.template,f),b.closest("#modalRegistryStoreFinder").find(a).html(c)):c.addClass("formErr")}async checkListToggleModalClick(a,b){if(b.is(".modalClose"))b.parent().find("checklistOff").length||
(this.registryNav.data=void 0),this.closeModal("true",b);else{b.parent().toggleClass("checklistOff");var c={};try{let f=await this.registryNavDataGet(),g=await this.checkListToggleModalDataGet(f.data.activeRegistry.registryId),h=g.data.registryResVO.registrySummaryVO.favStoreId,k=g.data.registryResVO.registrySummaryVO.eventDate;g=g.data.registryResVO.registryVO;c={"sessionBean.registryTypesEvent":g.registryType.registryTypeName,"registryVO.registryId":g.registryId,"registryVO.coRegistrant.firstName":g.coRegistrant.firstName||
"","registryVO.primaryRegistrant.cellPhone":g.primaryRegistrant.primaryPhone||"","registryVO.primaryRegistrant.firstName":g.primaryRegistrant.firstName,"registryVO.primaryRegistrant.lastName":g.primaryRegistrant.lastName,"registryVO.primaryRegistrant.babyMaidenName":g.event.babyName||"","registryVO.primaryRegistrant.contactAddress.firstName":g.primaryRegistrant.contactAddress.firstName,"registryVO.primaryRegistrant.contactAddress.lastName":g.primaryRegistrant.contactAddress.lastName,"registryVO.primaryRegistrant.primaryPhone":g.primaryRegistrant.primaryPhone,
"registryVO.refStoreContactMethod":"","registryVO.registryType.registryTypeName":g.registryType.registryTypeName,updateSimplified:!0,"registryVO.prefStoreNum":h,"registryVO.primaryRegistrant.contactAddress.addressLine1":g.primaryRegistrant.contactAddress.addressLine1,"registryVO.primaryRegistrant.contactAddress.addressLine2":g.primaryRegistrant.contactAddress.addressLine2,"registryVO.primaryRegistrant.contactAddress.city":g.primaryRegistrant.contactAddress.city,"registryVO.primaryRegistrant.contactAddress.state":g.primaryRegistrant.contactAddress.state,
"registryVO.primaryRegistrant.contactAddress.zip":g.primaryRegistrant.contactAddress.zip,"registryVO.primaryRegistrant.contactAddress.poBoxAddress":g.primaryRegistrant.contactAddress.poBoxAddress||"","registryVO.primaryRegistrant.contactAddress.qasValidated":g.primaryRegistrant.contactAddress.qasValidated,"registryVO.shipping.shippingAddress.addressLine1":g.shipping.shippingAddress.addressLine1,"registryVO.shipping.shippingAddress.addressLine2":g.shipping.shippingAddress.addressLine2,"registryVO.shipping.shippingAddress.city":g.shipping.shippingAddress.city,
"registryVO.shipping.shippingAddress.firstName":g.shipping.shippingAddress.firstName,"registryVO.shipping.shippingAddress.lastName":g.shipping.shippingAddress.lastName,"registryVO.shipping.shippingAddress.state":g.shipping.shippingAddress.state,"registryVO.shipping.shippingAddress.qasValidated":g.shipping.shippingAddress.qasValidated,regContactAddress:"",shippingAddress:"shipAdrressSameAsRegistrant",futureShippingAddress:"","registryVO.shipping.shippingAddress.zip":g.shipping.shippingAddress.zip||
"","registryVO.shipping.shippingAddress.poBoxAddress":g.shipping.shippingAddress.poBoxAddress||"","registryVO.shipping.futureShippingAddress.addressLine1":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.addressLine1||"":"","registryVO.shipping.futureShippingAddress.addressLine2":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.addressLine2||"":"","registryVO.shipping.futureShippingAddress.city":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.city||
"":"","registryVO.shipping.futureShippingAddress.firstName":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.firstName||"":"","registryVO.shipping.futureShippingAddress.lastName":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.lastName||"":"","registryVO.shipping.futureShippingAddress.state":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.state||"":"","registryVO.shipping.futureShippingAddress.country":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.country||
"":"","registryVO.shipping.futureShippingAddress.qasValidated":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.qasValidated:"","registryVO.shipping.futureShippingAddress.zip":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.zip||"":"","registryVO.shipping.futureShippingAddress.poBoxAddress":g.shipping.futureshippingAddress?g.shipping.futureshippingAddress.poBoxAddress||"":"","registryVO.shipping.futureShippingDate":g.shipping.futureShippingDate||"",futureShippingDateSelected:"",
"registryVO.coRegistrant.email":"masked"==g.coRegistrant.email?null:g.coRegistrant.email?encodeURIComponent(g.coRegistrant.email):"","registryVO.primaryRegistrant.email":"masked"==g.primaryRegistrant.email?null:g.primaryRegistrant.email?encodeURIComponent(g.primaryRegistrant.email):"","registryVO.networkAffiliation":g.networkAffiliation,"registryVO.event.guestCount":g.event.guestCount,"registryVO.event.babyGender":g.event.babyGender,"registryVO.coRegistrant.lastName":g.coRegistrant.contactAddress.lastName||
"","registryVO.event.eventDate":k,"registryVO.event.showerDate":g.event.showerDate||"","registryVO.regBG":g.regBG||"","registryVO.coRegBG":g.coRegBG||"","registryVO.event.babyNurseryTheme":g.event.babyNurseryTheme||"","registryVO.coRegOwner":!1,makeRegistryPublic:!0,deactivateRegistry:!1,coRegEmailFoundPopupStatus:!1,coRegEmailNotFoundPopupStatus:!1,"registryVO.event.college":g.event.college||"",showChecklist:"on"==a?!0:!1};var d=Object.keys(c).map(l=>l+"="+c[l]).join("&")}catch(f){console.warn(`Registry: checklistToggleModalClick. Could not get all registries data. Error: ${f}`);
return}await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/registry/edit`,{body:d,credentials:"include",method:"PUT",headers:Object.assign({"atg-rest-depth":2,"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())})}}async checkListToggleModalDataGet(a){if(this.registryStoreFinderModal&&this.registryStoreFinderModal.data)return this.registryStoreFinderModal.data;this.registryStoreFinderModal.data=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v2.0/registry/${a}`,
{body:"isGiftGiver=false&formRegistryController=true",credentials:"include",method:"POST",headers:Object.assign(await this.pwa.user.sessionConfirmationHeadersGetOrSet(),{"atg-rest-depth":"7","Content-Type":"application/x-www-form-urlencoded"})});return this.registryStoreFinderModal.data}checkListToggleModalRender(a){let b=this.checkListToggleModalTemplate();a.append(b)}checkListToggleModalTemplate(){return`
    <div id="modalRegistryChecklistToggle" class="modal active" tabindex="-1">
      <style>
        .checkListToggleHead{
          color: #002855;
          font: 600 24px/1.25 var(--fontDisplay);
          margin-top: 316px;
        }
        .babyChecklistToggle .checkListToggleHead{
          color: #000;
          font: 500 24px/1.25 var(--fontMain);
        }
        .checklistToggleTxt {
          font-weight: 300;
          line-height: 1.2;
        }
        .babyChecklistToggle .checklistToggleTxt {
          font-size: 16px;
          line-height: 1.37;
        }
        .toggleOff,
        .checklistOff .toggleOn {
          display: none;
        }
        .checklistOff .toggleOff{
          display: block;
        }
        .babyChecklistToggle .checklistVisible {
          font: 500 14px/1.43 var(--fontMain);
        }
      </style>
      <div class="modalContent flex mid col ${this.pwa.session.isBABY?"babyChecklistToggle":""}">
        <button class="btn modalClose" data-click-handler="registry.checkListToggleModalClick()" data-modal-close aria-label="Close Modal" type="button">
          <svg class="wi wiClose noTap">
            <use xlink:href="#wiClose"></use>
          </svg>
        </button>
        <div class="vb05 checkListToggleHead">Checklist</div>
        <div class="vb025 checklistToggleTxt">Your checklist is turned off.</div>
        <div class="vb05 checklistToggleTxt">Turn it back on by selecting the toggle below.</div>
        <div class="flex mid checklistOff">
          <img src="/static/assets/images/toggle-off.png" alt="toggle-off" class="gr05 h100 toggleOff" data-click-handler="registry.checkListToggleModalClick(on)">
          <img src="/static/assets/images/${this.pwa.session.isBABY?"baby-toggle-on.png":"bbb-toggle-on.png"}" alt="toggle-on" class="gr05 h100 toggleOn" data-click-handler="registry.checkListToggleModalClick(off)">
          <h6 class="bold checklistVisible">Checklist Visibility</h6>
        </div>
      </div>
    </div>
    `}closeModal(a,b){"true"==a?b.closest(".modal").remove():b.closest(".modal").removeClass("active")}async registryCtaClick(a,b){if(!this.registryCta.data)return!1;this.ownRecommended.data.recommendedRegistryList.length||1<this.registryCta.data.data.registryList.length?this.registryCtaMenuRender(b):(b.addClass("noTap"),b.attr("data-modal-open","true"),this.pwa.util.scrollToggle(this.pwa.session.docObjActive,b),a=this.registryCta.data.data.activeRegistry.registryId,this.registrySendCtaBeacon(a,b),
await this.registryItemAddedModalRender(a,b),b.removeAttr("data-modal-open"),b.removeClass("noTap"));return!0}aboveVertCenter(a){a=a[0].getBoundingClientRect();return-1<a.top&&a.top<=$(window).height()/2}async registrySendCtaBeacon(a,b){try{const c=this.pwa.session.docTests.isPDPReg.test(location.pathname),d=this.pwa.session.docTests.isPLPReg.test(location.pathname),f=this.pwa.session.docObjActive.shadowBody,g=b.clone(),[h]=c?await this.createPdpRegObj(a,b):await this.createPlpRegObj(a,b);let [k,
l]=c?await Promise.all([this.pwa.pdpDataAbstraction.getSkuDetails(),this.pwa.pdpDataAbstraction.getPDPState("pdpDet")]):[],m=await this.pwa.plp.getPlpItemData(h.prodId);const p=l?l.data.PRODUCT_DETAILS:{},n=this.registryCta.data.data.registryList.filter(z=>z.registryId==a)[0];let q,t;c&&(q="pdpAddToRegistry",t={inventory_status:k.ONLINE_INVENTORY?"in stock":"out of stock",product_category:[p.CATEGORY_BREADCRUMBS[0].name],product_has_personalization:[k.CUSTOMIZATION_OFFERED_FLAG_boolean],product_image_name:[k.PRODUCT_IMG_ARRAY[0].description],
product_image_url:[this.pwa.session.apiInfo.scene7RootUrl+h.prodImg],product_id:[h.prodId],product_name:[h.title],product_price:[h.price.replace("$","")],product_sku_id:[h.skuId],skuName:[h.title],product_url:[k.PDP_URL],registrants_name:[`${n.primaryRegistrantFirstName} ${n.primaryRegistrantLastName}`],registry_add_location:["PDP"],registry_event_date:[this.registryCta.data.data.activeRegistry.eventDate],registry_id:[h.registryId],registry_purchased:[this.registryCta.data.data.activeRegistry.giftPurchased],
registry_total_items:[this.registryCta.data.data.activeRegistry.giftRegistered],registry_type:[this.registryCta.data.data.activeRegistry.eventType],prodQty:[h.qty]});if(d){const z=$(f).find(".breadcrumbLink span").eq(0).text();q="plpAddToRegistry";t={inventory_status:m.storeInventoryStatus_boolean?"in stock":"out of stock",product_category:[z],product_has_personalization:[m.CUSTOMIZATION_OFFERED_FLAG_boolean],product_image_name:[h.title],product_image_url:[this.pwa.session.apiInfo.scene7RootUrl+h.prodImg],
product_id:[h.prodId],product_name:[h.title],product_price:[h.price.replace("$","")],product_sku_id:[h.skuId],skuName:[h.title],product_url:[m.url],registrants_name:[`${n.primaryRegistrantFirstName} ${n.primaryRegistrantLastName}`],registry_add_location:["PLP"],registry_event_date:[this.registryCta.data.data.activeRegistry.eventDate],registry_id:[h.registryId],registry_purchased:[this.registryCta.data.data.activeRegistry.giftPurchased],registry_total_items:[this.registryCta.data.data.activeRegistry.giftRegistered],
registry_type:[this.registryCta.data.data.activeRegistry.eventType],prodQty:[h.qty]}}const v=await this.pwa.analytics.getLtlData({prodId:h.prodId,skuId:h.skuId});Object.assign(t,v);g.attr("data-cta",q).attr("data-attribute",JSON.stringify(t));this.pwa.site.tealiumClickEventEmitter(g[0],t)}catch(c){console.log("error sending add to registry beacon:",c)}}async registryListClick(a,b){this.registryItemAddedModalRender(a,b);this.registrySendCtaBeacon(a,b);this.registryCtaMenuRender(b)}async createCollectionRegObj(a,
b){try{let c=[];const d=b.closest("form"),f=this.pwa.util.formToObject(d).products,g=await this.pwa.pdpDataAbstraction.getPDPState("pdpDet");let h=this.registryCta.data.data.registryList.filter(l=>l.registryId==a)[0];const k={registryId:a,parentProdId:g.data.PRODUCT_DETAILS.PARENT_PROD_INFO?g.data.PRODUCT_DETAILS.PARENT_PROD_INFO[0].PRODUCT_ID:g.data.PRODUCT_DETAILS.PRODUCT_ID,registryName:h?h.eventType:"",title:g.data.PRODUCT_DETAILS.DISPLAY_NAME,prodImg:g.data.PRODUCT_DETAILS.PRODUCT_IMG_ARRAY[0].imageId||
null,personalizeImg:g.data.PRODUCT_DETAILS.PRODUCT_IMG_ARRAY[0].personalizeUrlSm||null};JSON.parse(decodeURIComponent(f).replace(/},]/i,"}]")).forEach(l=>{l.qty&&l.skuId&&"0"!==l.qty&&c.push(Object.assign({},k,{skuId:l.skuId,prodId:l.prodId,qty:l.qty}))});return c}catch(c){console.warn(`Error building pdp collection registration object. Error: ${c}`)}return[]}async createPdpRegObj(a,b){try{if(b.length&&b.closest("form").hasClass("addToRegC"))return this.createCollectionRegObj(a,b);const c=await this.pwa.pdpDataAbstraction.getSkuDetails(),
d=await this.pwa.pdpDataAbstraction.getPDPState("pdpDet"),f=await this.pwa.pdpDataAbstraction.getPDPState("skuFacets");let g=this.registryCta.data.data.registryList.filter(h=>h.registryId==a)[0];return[{qty:f.qty||1,registryId:a,skuId:c.SKU_ID,prodId:d.data.PRODUCT_DETAILS.PRODUCT_ID,price:c.IS_PRICE,parentProdId:d.data.PRODUCT_DETAILS.PARENT_PROD_INFO?d.data.PRODUCT_DETAILS.PARENT_PROD_INFO[0].PRODUCT_ID:d.data.PRODUCT_DETAILS.PRODUCT_ID,registryName:g?g.eventType:"",title:c.DISPLAY_NAME,prodImg:c.PRODUCT_IMG_ARRAY[0].imageId||
null,personalizeImg:c.PRODUCT_IMG_ARRAY[0].personalizeUrlSm||null}]}catch(c){console.warn(`Error building pdp registration object. Error: ${c}`)}return[]}async createPlpRegObj(a,b){try{let c=this.registryCta.data.data.registryList.filter(g=>g.registryId==a)[0],d={registryId:a,registryName:c?c.eventType:""};const f=b.closest(".registryCtaCont").attr("data-prod-reg");if(!f)throw Error(`Unable to get data to add item to registry. Error: ${e}`);d=Object.assign(d,JSON.parse(f));return[d]}catch(c){console.warn(`Error building pdp registration object. Error: ${c}`)}return[]}async registryCtaMenuRender(a,
b){let c=a.parent(),d=0==c.find(".registryList").length;a.closest("amp-list").find(".registryList").each((f,g)=>{f=$(g);f.closest(".registryCtaCont").find("svg").removeClass("deg180");f.closest(".registryCtaCont").find(".registryList").remove();f.closest("amp-list").removeClass("overflow")});if(d||b)this.ownRecommended.data.recommendedRegistryList&&(this.registryCta.data.data.friendsList=this.ownRecommended.data.recommendedRegistryList,this.pwa.session.docTests.isPDPReg.test(location.pathname)&&(b=
(await this.pwa.pdpDataAbstraction.getSkuDetails()).SKU_ID,this.registryCta.data.isPersonalized=this.pwa.personalize.personalizedSku[b]?!0:!1)),this.registryCta.data.data.friendsList&&this.registryCta.data.data.friendsList.length&&!this.registryCta.data.data.registryList&&(b=await this.registryFriendListCreateProdObj(a),Object.assign(this.registryCta.data,{skuId:b.skuId,prodId:b.prodId,registryType:this.pwa.session.isBABY?"BABY":"BRD",hrefAsParamRegistry:encodeURIComponent(location.href)})),this.registryCta.data.positionBelow=
this.aboveVertCenter(a),b=Mustache.render(this.registryCta.template,this.registryCta.data),a.closest("amp-list").addClass("overflow"),c.append(b),a.find("svg").addClass("deg180")}registryCtaBeforeRender(a,b){if(this.pwa.session.docTests.isPDPReg.test(b.pathname)){this.backfillCta=!1;b=a.find(".prodFulfillmentList2,[data-multi-prod]");if(b.is(".marketplaceCtaCont"))return;b.addClass("activeRegistryCta");try{if(b.attr("data-init-height")){const c={0:125,768:125,1024:0,1280:0,1344:0};let d=JSON.parse(b.attr("data-init-height"));
Object.keys(d).forEach(g=>{d[g]=`${parseInt(d[g].replace("px",""))+c[g]}px`});b.attr("data-init-height",JSON.stringify(d));let f=parseInt(b.attr("height").replace("px",""))+58;b.attr("height",`${f}px`)}this.ownRecommended&&this.ownRecommended.data.recommendedRegistryList&&this.ownRecommended.data.recommendedRegistryList.length||this.registryCta.data&&this.registryCta.data.data.registryList&&1<this.registryCta.data.data.registryList.length?b.addClass("registrySelect"):b.removeClass("registrySelect");
this.backfillPdpCta(a)}catch(c){console.warn(`Unable to update prodFulfillmentList2 height for registry. Error: ${c}`)}}else if(this.pwa.session.docTests.isPLPReg.test(b.pathname))try{const c=a.find("#plpListInner,.expertPicksCard");c.addClass("activeRegistryCta");this.ownRecommended.data.recommendedRegistryList&&this.ownRecommended.data.recommendedRegistryList.length||this.registryCta.data&&this.registryCta.data.data.registryList&&1<this.registryCta.data.data.registryList.length?c.addClass("registrySelect"):
c.removeClass("registrySelect");this.backfillPlpCta(a)}catch(c){console.warn(`Unable to reserve space for PLP registry CTA. Error: ${c}`)}this.ctaRenderError&&this.getRegCtaData(a)}registryCtaInitRender(a,b){if(this.isRegistryPage(a)&&this.pwa.session.docObjActive&&this.pwa.session.docObjActive.shadowBody){var c=this.pwa.session.docTests.isPDPReg.test(a.pathname)?".prodFulfillmentList2,[data-multi-prod]":"#plpListInner,.expertPicksCard";try{this.pwa.session.docObjActive&&this.pwa.session.docObjActive.href==
location.href&&(b=$(this.pwa.session.docObjActive.shadowBody));if(!b||!this.registryCta.data.data)throw Error({message:"No data to render registry."});let f=b.find(c);if(!f.is(".marketplaceCtaCont")){f.addClass("activeRegistryCta");this.ownRecommended.data.recommendedRegistryList.length||1<this.registryCta.data.data.registryList.length?f.addClass("registrySelect"):f.removeClass("registrySelect");this.ctaRenderError=!1;var d=new URL(a.href);d.searchParams.has("addToRegistry")&&(this.registryParamRouter(b,
d),d.searchParams.delete("addToRegistry"),history.replaceState("",document.title,d.toString()))}}catch(f){this.ctaRenderError=!0,b.find(c).removeClass("activeRegistryCta")}}}closeRegistryFooterPanel(){$(".registryOverlay").removeClass("active");$(".registryFooterPanel").addClass("wHide");$(".registryFooterActive").removeClass("registryFooterActiveBefore registryFooterActive");$("body").removeClass("modalOpen")}findRegistryTypeId(a){this.registryTypeId=this.pwa.session.isCANADA?this.caRegistryTypeIds[a]:
this.registryTypeIds[a]}modifyRegistryLinks(a){let b=["Registry","Checklist","Build","More"];for(const c of a)c.bannerLink&&c.bannerLink.includes("/")?c.url=`/store/${c.bannerLink}`:b.includes(c.bannerText)||(c.url=`${this.registryLinks[c.bannerLink]}${c.requestParams?`?${c.requestParams}`:""}`),"Book an Appointment"!=c.bannerText||/&action|\?action/.test(c.url)||(/\?/.test(c.url)?c.url+="&action=appointment":c.url+="?action=appointment")}onResizeEnd(a){if(this.pwa.user.hasRegistry){this.registryAllRender(a,
location);1024<=window.innerWidth?a.find("#wm_footer").removeClass("hasRegistryFooter"):a.find("#wm_footer").addClass("hasRegistryFooter");a.find(".registrySidebar").removeClass("registrySidebarShow");$("body").removeClass("modalOpen");var b=a.find(".dskChecklistBtn");b.removeClass("dskChecklistBtnActive");b.attr("data-modal-open",!0);a.find(".sidebarOverlay").removeClass("active")}}async init(){if(this.pwa.user.hasRegistry&&this.pwa.session.registryAssetsPrefetch){try{let a=await Promise.all(this.pwa.session.registryAssetsPrefetch.concat([this.pwa.util.waitForProp("Mustache"),
this.pwa.util.waitForProp("docObjActive",this.pwa.session)])),[b,c,d,f]=await Promise.all(a.map(async function(g){if(g.type){if("json"==g.type)return await g.res.json();if("html"==g.type)return $(await g.res.text())}}.bind(this)));this.registryNav={data:c,template:b.find("#registryNav").html()||""};this.registryFooter={data:f,template:b.find("#registryFooter").html()||""};this.registrySidebar={template:b.find("#registrySidebar").html()||""};this.registryItemAddedModal={template:b.find("#registryItemAddedModal").html()||
""};this.registryStoreFinderModal={template:b.find("#registryStoreFinderModal").html()||""};this.registryCta={data:this.registryNav.data,template:b.find("#registryCta").html()||""};this.activeRegistry=this.registryNav.data.data.activeRegistry.registryId;this.ownRecommended={data:d.data||{},template:b.find("#registryFriendRecModal").html()||""};this.registryAllRender($(this.pwa.session.docObjActive.shadowBody),location)}catch(a){console.error(`Error getting registry data. Error: ${a}`)}this.pwa.session.docObjActive||
await this.pwa.util.waitForProp("docObjActive",this.pwa.session);this.registryCtaInitRender(location,this.pwa.session.docObjActive?$(this.pwa.session.docObjActive.shadowBody):void 0)}else this.registryFriendListCtaRender()}isRegistryPage(a){return(this.pwa.session.docTests.isPDPReg.test(a.pathname)||this.pwa.session.docTests.isPLPReg.test(a.pathname))&&!this.pwa.session.docTests.isCLPReg.test(a.pathname)}async registryAllRender(a,b){this.pwa.user.hasRegistry&&(await this.registryNavRender(a),this.isRegistryPage(b)?
(this.registryFooterToggle(!0),this.registryFooterRender(a),this.registrySidebarRender(a)):this.registryFooterToggle(!1))}registryFooterClickHandler(a){a=$(a.currentTarget);if(a.is("[data-registry-footer]"))try{this.registryFooterPanelToggle(a.attr("data-registry-footer"))}catch(b){console.warn(`Error rendering footer panel. Error: ${b}`)}a.is("[data-registry-id]")&&(this.registryFooter.reRendered=!0,this.activeRegistryChange($(this.pwa.session.docObjActive.shadowBody),a.attr("data-registry-id")),
$(".activeRegistry").removeClass("activeRegistry").find(".changeRegistryLink").addClass("wHide"),a.addClass("activeRegistry").find(".changeRegistryLink").removeClass("wHide"))}async registryFooterDataGet(){if(this.registryFooter.data)return this.registryFooter.data;try{const a=await fetch(`${location.origin}/apis/stateful/v1.0/registry/sticky-footer`,{method:"POST",headers:Object.assign({accept:"application/json, text/plain, */*","atg-rest-depth":2},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});
this.registryFooter.data=await a.json()}catch(a){console.warn(`Failed to get data from stick footer API. Error: ${a}`)}return this.registryFooter.data}registryFooterDataModify(a){var b=a.data.stickyFooterResponse.footer.stickyLinks;let c=a.data.stickyFooterResponse.footer.links,d=5;var f=[],g=["Build","More"];for(const h of g)c[h]&&(d--,g=b.filter(k=>k.bannerText==h)[0],f.push(g));b=b.slice(0,d);a.data.stickyFooterResponse.displayFlags.isCheckListDisabled&&(b=b.filter(h=>"Checklist"!==h.bannerText),
a.data.stickyFooterResponse.registryModifyClass="noChecklist");a.data.stickyFooterResponse.footer.stickyLinks=b.concat(f);this.activeRegistry=a.data.stickyFooterResponse.registryList.activeRegistryId;f=a.data.stickyFooterResponse.footer.registryType;b=this.pwa.session.isCANADA?"university":"college-university";b="HSW"==f?"housewarming":b;this.findRegistryTypeId(f);this.registryLinks={"add items":`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}`,analyzer:`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}?action=analyzer`,
askAFriend:`/store/giftRegistry/viewRegistryOwner/recommendation/${this.activeRegistry}`,"ask a friend":`/store/giftRegistry/viewRegistryOwner/recommendation/${this.activeRegistry}`,browseAndGifts:`/store/kickstarters/${b}/${this.registryTypeId}`,checkListForm:"/store/giftregistry/customisedChecklistForm",collegeCheckListHome:"/store/checklist/viewListOwner/home",collegeCheckListMyItems:`/store/checklist/viewListOwner/myItems/${this.activeRegistry}?schoolId`,"featured products":"/store/quickpicks",
flipFlop:`/store/giftregistry/flipFlop/${f}/${this.activeRegistry}`,genericCollegeLanding:"/store/page/college",getThankyouLandingPage:`/store/giftRegistry/viewRegistryOwner/tym/${this.activeRegistry}`,kickstarters:"/store/kickstarters",listOwner:`/store/checklist/viewListOwner/myItems/${this.activeRegistry}`,"manage registry":`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}`,moversListOwner:`/store/checklist/viewMoversListOwner/myItems/${this.activeRegistry}`,myregistries:"/store/account/my_registries",
"my account":"/store/account/my_registries",quickPicks:"/store/quickpicks","quick picks":"/store/quickpicks",pnhListOwner:`/store/checklist/viewPNHListOwner/shopItems/${this.activeRegistry}`,pnhManageListOwner:`/store/checklist/viewPNHListOwner/manageItems/${this.activeRegistry}`,registry:"/store/account/my_registries",registryOwner:`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}`,registryOwnerHome:`/store/giftRegistry/viewRegistryOwner/home/${this.activeRegistry}`,"share registry":`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}?action=share`,
shoppingList:"/store/account/shoppingList","shop this look":"/store/quickpicks","static/content/movers":"/store/static/movers","thank you list":`/store/giftRegistry/viewRegistryOwner/tym/${this.activeRegistry}`,viewList:`/store/checklist/viewListOwner/myItems/${this.activeRegistry}`,viewRegistry:`/store/giftRegistry/viewRegistryOwner/myItems/${this.activeRegistry}`};this.modifyRegistryLinks(a.data.stickyFooterResponse.footer.stickyLinks);Object.values(a.data.stickyFooterResponse.footer.links).forEach(h=>
this.modifyRegistryLinks(h))}async registryFooterRender(a){if(!(1024<=window.innerWidth||this.registryFooter.rendered)&&this.registryFooter.template){a=this.registryFooter;a.data=await this.registryFooterDataGet();try{if(this.registryFooterDataModify(a.data),!a.data.data.stickyFooterResponse.footer.stickyLinks.length)return}catch(c){console.warn(`Error modifying footer data. Error: ${c}`);return}a.dom=a.dom||$("body").append(`<div data-wm="appshell" id="registryFooter" class="${this.pwa.session.isBABY?
"babyFooter":""}"></div>`).find("#registryFooter");var b=Mustache.render(a.template,a.data);a.dom.html(b);a.rendered=!0;$("a.registryRemoveLink").removeAttr("href");$(".registryFooterItem").on("click",this.registryFooterClickHandler);$(".registryOverlay").on("click",this.closeRegistryFooterPanel);this.registryFooter.reRendered&&($(".registryOverlay").addClass("active"),$(".registryFooterPanel").removeClass("wHide"),$("[data-registry-footer='Registry']").addClass("registryFooterActive registryFooterActiveBefore"),
this.registryFooter.reRendered=!1)}}registryPanelListTemplate(a,b,c){let d="registrySidebarPanel"===b;return`<div class=${b}>
        <div class="vb15 regBorderBtm sidebarRegistryList">
          <div class="vb15 registryPanelHead">Registries</div>
          ${a.map(f=>`<div class="vb15 ${f.registryId==this.activeRegistry?"activeRegistry":"pointer"}" data-registry-id="${f.registryId}" ${d?`data-click-handler="registry.registrySideBarClickHandler(${f.registryId})" data-modal-close`:""}>
                    <div class="noTap">
                      ${f.primaryRegistrantFirstName}${f.coRegistrantFirstName?` & ${f.coRegistrantFirstName}`:""}'s ${f.eventType}
                    </div>
                    <a href=${`/store/giftRegistry/viewRegistryOwner/myItems/${f.registryId}`} class="pointer changeRegistryLink ${f.registryId==this.activeRegistry?"":"wHide"}">
                      See Dashboard
                      <svg class="regArrow" xmlns="http://www.w3.org/2000/svg" height="18px" width="18px" viewBox="${c}">
                        <path fill="none" stroke="currentColor" stroke-linecap="square" stroke-width="2" d="M1 6h18m-3-4l4 4m-4 4l4-4"></path>
                      </svg>
                    </a>
                </div>`).join("")}
        </div>
      </div>`}registryFooterLinkPanelTemplate(a){return`<div class="registryFooterPanel">
      ${this.registryFooter.data.data.stickyFooterResponse.footer.links[a].map(b=>`<div class="vb15">
              <a class="registryFooterLink" href="${b.url}">
                ${b.bannerText}
              </a>
            </div>`).join("")}
      </div>`}async registryFooterPanelToggle(a){var b=$(`[data-registry-footer="${a}"]`);let c=$(this.pwa.session.docObjActive.shadowBody),d=$(".registryOverlay"),f=$(".registryFooterPanel");if(b.hasClass("registryFooterActive")&&d.hasClass("active"))b.removeClass("registryFooterActiveBefore"),d.removeClass("active"),$("body").removeClass("modalOpen"),f.remove();else if(b.find(".registryRemoveLink").length){d.addClass("active");$("body").addClass("modalOpen");if(c.hasClass("hidePencil")){let g=c.find(".pencilBannerAL").height()-
5;d.css("top",`calc(var(--headHeight) - ${g}px)`)}else d.css("top","calc(var(--headHeight) + 5px)");$(".registryFooterActive").removeClass("registryFooterActive registryFooterActiveBefore");b.addClass("registryFooterActive registryFooterActiveBefore");b="";"Registry"==a?b=this.registryPanelListTemplate(this.registryFooter.data.data.stickyFooterResponse.registryList.profileRegistryList,"registryFooterPanel","0 0 21 6"):"Checklist"==a?($(".registryFooterActive").removeClass("registryFooterActive registryFooterActiveBefore"),
d.removeClass("active"),f.remove(),a=await this.registryNavDataGet(),a.data&&a.data.activeRegistry.showChecklist?(c.find(".registrySidebar").length||await this.registrySidebarRender(c),c.find(".registrySidebar").addClass("registrySidebarShow")):this.checkListToggleModalRender(c)):b=this.registryFooterLinkPanelTemplate(a);b&&(f.length?f.replaceWith(b):$(b).insertAfter($("#registryFooter")));$("[data-registry-id]").on("click",this.registryFooterClickHandler)}}registryFooterToggle(a){const b=this.registryFooter.dom;
b&&(1==a?b.removeClass("wHide"):0==a&&b.addClass("wHide"))}async registryFriendListCreateProdObj(a){const b=this.pwa.session.docTests.isPDPReg.test(location.pathname);let c={};try{if(b){const d=await this.pwa.pdpDataAbstraction.getSkuDetails(),f=await this.pwa.pdpDataAbstraction.getPDPState("pdpDet");c={skuId:d.SKU_ID,prodId:f.data.PRODUCT_DETAILS.PRODUCT_ID,title:d.DISPLAY_NAME,prodImg:d.PRODUCT_IMG_ARRAY[0].imageId||null}}else c=JSON.parse(a.closest(".registryCtaCont").attr("data-prod-reg"))}catch(d){console.warn(`Registry: registryFriendListCreateProdObj, couldnt get product information Error: ${d}`)}return c}registryFriendListInputBtnClick(a,
b){a=b.closest(".registryFriendRecModal");let c=a.find("#quantity"),d=b.attr("data-value"),f=a.find(".registryFriendQtBtn");"10"==d&&(f.addClass("wHide"),c.parent().removeClass("wHide"),c[0].focus());f.removeClass("active");f[0].focus();c.val(d);a.find(".registryFriendQt").text(d);b.parent().find(".registryFriendBtn.active").removeClass("active");b.addClass("active");this.closeModal("false",b)}async registryFriendListClick(a,b){var c=await this.registryFriendListCreateProdObj(b);a={regId:a,origin:location.origin,
imgBase:this.pwa.session.apiInfo.scene7RootUrl,isBaby:this.pwa.session.isBABY};Object.assign(a,c);c=Mustache.render(this.ownRecommended.template,a);a=b.closest("body");a.append(c).find("#registryFriendComment").on("input",this.registryFriendModalClick);a.find(".registryFriendRecModal")[0].focus();a.find(".registryFriendQuantity").on("input",this.registryFriendListQtChange);this.registryCtaMenuRender(b)}async registryFriendListCtaRender(){if(this.pwa.user.hasAcct&&!this.pwa.session.isHARMON){var a=
this.pwa.util.cookieGet("ATG_PROFILE_DATA");a=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/customers/${a}/registry/own-recommended`,{credentials:"include",method:"GET",headers:await this.pwa.user.sessionConfirmationHeadersGetOrSet()});if(a.data&&a.data.recommendedRegistryList&&a.data.recommendedRegistryList.length){var b=await fetch(`${location.origin}${this.pwa.session.apiInfo.registryTemplates}`,{method:"GET"});b=$(await b.text());this.registryCta={data:{data:[]},template:b.find("#registryCta").html()||
""};this.ownRecommended={data:a.data||{},template:b.find("#registryFriendRecModal").html()||""};await Promise.all([this.pwa.util.scriptAddMustache(),this.pwa.util.waitForProp("docObjActive",this.pwa.session),this.pwa.util.waitForProp("Mustache")]);this.registryCtaInitRender(location,this.pwa.session.docObjActive?$(this.pwa.session.docObjActive.shadowBody):void 0)}}}registryFriendModalClick(a,b){a&&(b=$(a.target).closest(".modal"));var c=b;let d=c.find(".registryFriendQuantity");10>d.val()&&(a=0<d.val()?
d.val():1,d.val(a),d.parent().addClass("wHide"),c.find(".registryFriendQtBtn").removeClass("wHide"),c.find(".registryFriendQt").text(a),c=c.find(".registryFriendQtModal"),c.find(".registryFriendBtn.active").removeClass("active"),c.find(`[data-value="${a}"]`).addClass("active"));b.find(".registryFriendQtBtn").removeClass("active");b.find(".registryFriendQtModal").removeClass("active")}registryFriendListQtChange(a){a=$(a.target);let b=a.val();2<b.length&&(b=b.slice(0,2));a.val(b.replace("-",""));"0"===
b&&a.val(1)}registryFriendListQtClick(a,b){b.toggleClass("active");a=b.closest(".modal").find(".registryFriendQtModal");a.toggleClass("active");a.hasClass("active")&&a.find(".registryFriendBtn.active")[0].focus()}async registryFriendListRecBtn(a,b){a=b.closest("form");""==a.find(".registryFriendQuantity").val()&&a.find(".registryFriendQuantity").val("1");a=a.serialize();a=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/registry/recommend`,{body:a,credentials:"include",method:"POST",
headers:Object.assign(await this.pwa.user.sessionConfirmationHeadersGetOrSet(),{"atg-rest-depth":"2","Content-Type":"application/x-www-form-urlencoded"})});a=this.registryFriendListSuccessTemplate(a.serviceStatus);b.closest("body").append(a);this.closeModal("true",b)}registryFriendListSuccessTemplate(a){return`
    <div id="modalRegistryFriendSuccess" class="modal active" tabindex="-1">
      <style>
        .regSuccessHead {
          font: 600 24px/1.17 var(--fontMain);
        }
        .babyFriendListSuccess .regSuccessHead {
          font: 500 24px/1.25 var(--fontDisplay);
        }
        .regSuccessMsg {
          font: 300 16px/1.13 var(--fontMain);
        }
        .babyFriendListSuccess .regSuccessMsg {
          font: 300 14px/1.13 var(--fontMain);
        }
        .babyFriendListSuccess .regSuccessRecBtn {
          text-transform: capitalize;
        }
        .friendListError {
          font: var(--menuLight);
          border-radius: 4px;
          border: 2px solid #ffce36;
          background-color: #fffae9;
          height: 50px;
        }
        @media (min-width: 48rem) {
          .regSuccessHead {
            font: 600 28px/normal var(--fontMain);
          }
          .babyFriendListSuccess .regSuccessHead {
            font: 500 28px/1.25 var(--fontDisplay);
          }
          .regSuccessMsg {
            font: 300 16px/1.38 var(--fontMain);
          }
          .babyFriendListSuccess .regSuccessMsg {
            font: 300 14px/1.36 var(--fontMain);
          }
        }
      </style>
      <div class="modalContent flexModal ${this.pwa.session.isBABY?"babyFriendListSuccess":""}">
        <div class="modalContentInner flex col ctr parent">
          <button class="btn modalClose" data-click-handler="registry.closeModal(true)" data-modal-close aria-label="Close Modal" type="button">
            <svg class="wi wiClose noTap">
              <use xlink:href="#wiClose"></use>
            </svg>
          </button>
          ${"SUCCESS"==a?`
              <div class="vb05 regSuccessHead">${this.pwa.session.isBABY?"T":"t"}hanks, your recommendation is sent!</div>
              <div class="vb2 regSuccessMsg">Note: The registrant(s) will review your recommendation</div>
              <button type="button" class="s12 t4 vb1 btn btnLrg btnPrimary regSuccessRecBtn" data-click-handler="registry.closeModal(true)" data-modal-close>recommend again</button>
              <a href="/store/account/my_registries" class="btnLink">skip, return to registry view</a>
            `:'<div class="flex midCtr friendListError">We encountered an error sharing your recommendation. Please try again.</div>'}
        </div>
      </div>
    </div>
    `}async registryItemsAdd(a,b){let c=this.pwa.util.cookieGet("ATG_PROFILE_DATA"),d=[],f={},g="",h=null;const k={addItemResults:[],parentProdId:"",registryName:"",isList:!1,fromComparisonPage:"",returnURL:"",skipNotifyFlag:"false"},l={qty:"1",registryId:"",skuId:"",price:"",prodId:"",isCustomizationRequired:!1,refNum:"",ltlFlag:"false",altNumber:"",ltlShipMethod:null,porchPayLoadJson:""};try{b.forEach(m=>{let p=this.pwa.personalize.personalizedSku[m.skuId];d.push(Object.assign({},l,{registryId:a,
prodId:m.prodId,skuId:m.skuId,price:m.price,qty:m.qty||"1",isCustomizationRequired:p?!0:!1,personalizationType:p?"PB":void 0,refNum:p?p.refnum:""}));p&&this.pwa.personalize.removeData(m.skuId)}),f=Object.assign({},k,{addItemResults:d,parentProdId:b[0].parentProdId,registryName:b[0].registryName}),g=`jasonCollectionObj=${encodeURIComponent(JSON.stringify(f))}`}catch(m){return console.warn(`Error creating data for add to registry. Error: ${m}`),{error:"Unable to parse data to add to registry. "}}try{h=
await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/customers/${c}/registry/item`,{body:g,credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});if(h.errorMessages)throw Error({message:`Problem with add to registry API call. Error: ${h.errorMessages[0].message}`});return h}catch(m){return console.warn(`Add to registry API failed. Error: ${m}`),{error:"Network error when trying to add to registry. Item was not added. "}}}async regFavClick(a,
b){b.addClass("noTap");a=b.closest("form").serialize();try{if(b.hasClass("active")&&(a=a.replace(/markAsFav=Y/,"markAsFav=N")),(await this.regSendFav(a)).data.result)b.closest(".fav").removeClass("panelAlert"),/markAsFav=Y/.test(a)?b.addClass("active"):b.removeClass("active");else throw Error("Unable to add to add item to favorites");}catch(c){console.warn("Unable to add item to favorites"),b.closest(".fav").addClass("panelAlert")}b.removeClass("noTap")}async regSendFav(a){let b=null;try{if(b=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/registry/mark-item-favorite`,
{body:a,credentials:"include",method:"PUT",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())}),!b.data)throw Error("Unable to add fav");}catch(c){console.warn(`Unable to mark item as favorite. Error: ${c}`),b.error=`Unable to add item as favorite. Error: ${c}`}return b}async registryItemAddedModalRender(a,b){b=this.pwa.session.docTests.isPDPReg.test(location.pathname)?await this.createPdpRegObj(a,b):await this.createPlpRegObj(a,
b);a=await this.registryItemsAdd(a,b);let c=$(this.pwa.session.docObjActive.shadowBody);c[0].registrySidebarRendered=!1;this.registrySidebar.data=null;this.registrySidebarRender(c);try{const d={error:a.error||null,items:1<b.length?b[0]:b,origin:location.origin,imgBase:this.pwa.session.apiInfo.scene7RootUrl};try{d.rowId=a.data.component.itemDetailsVO&&a.data.component.itemDetailsVO[0].rowId?a.data.component.itemDetailsVO[0].rowId:null}catch(g){d.rowId=null}1<b.length&&(a=0,a=b.reduce((g,h)=>g+=parseInt(h.qty),
0),d.items.qty=a);const f=Mustache.render(this.registryItemAddedModal.template,d);this.pwa.appshell.elems.loadingOverlay.removeClass("loading");this.pwa.appshell.elems.body[0].insertAdjacentHTML("beforeend",f);this.pwa.appshell.elems.body.find("#modalRegistryWrap")[0].focus();return!0}catch(d){console.warn(`Unable to add item to registry. Error: ${d}`)}return!1}registryItemAddedModalToggle(){}async getRegCtaData(a){try{await this.registryCtaDataGet(),await this.registryCtaTempGet()}catch(b){console.warn(`Failed to get data from all-registries API. Error: ${b}`)}this.registryCtaInitRender(location,
a);return this.registryCta.data}async registryCtaDataGet(){if(!this.registryCta.data||!this.registryCta.data.data)try{this.registryCta.data=await this.allRegDataGet()}catch(a){console.warn(`Failed to get data from all-registries API. Error: ${a}`)}return this.registryCta.data}async registryCtaTempGet(){if(!this.registryCta.template)try{let a=await this.getRegistryTemplate();this.registryCta.template=$(a).find("#registryCta").html()}catch(a){console.warn(`Error getting registry CTA template. Error: ${a}`)}return this.registryCta.data}async getRegistryTemplate(){let a=
this.pwa.session.apiInfo.registryTemplates;try{return await (await fetch(a)).text()}catch(b){console.error(`Unable to fetch registry template. Error: ${b}`)}}async registryNavDataGet(){if(this.registryNav.data)return this.registryNav.data;try{this.registryNav.data=await this.allRegDataGet(),this.activeRegistry=this.registryNav.data.data.activeRegistry.registryId}catch(a){console.warn(`Failed to get data from all-registries API. Error: ${a}`)}return this.registryNav.data}async allRegDataGet(){try{var a=
this.pwa.util.cookieGet("ATG_PROFILE_DATA");return await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/customers/${a}/registry/all-registries`,{method:"GET",headers:Object.assign({accept:"*/*","atg-rest-depth":2},await this.pwa.user.sessionConfirmationHeadersGetOrSet())})}catch(b){console.warn(`Failed to get data from all-registries API. Error: ${b}`)}return null}registryNavDataModify(a){let b={activeReg:a.activeRegistry.registryId},c=a.registryList.filter(function(d){return b.activeReg!==
d.registryId},b).slice(0,2);a.otherRegistries=c;a.numRegistries=a.registryList.length}async registryNavRender(a){if(!a[0].registryNavRendered&&this.registryNav.template){var b=this.registryNav;b.data=await this.registryNavDataGet();var c=$(this.pwa.$$$(a[0],"#registryNav"));c.length||(c=$(`<div id="registryNav" class="${this.pwa.session.isBABY?"babyNav":""}"></div>`),$(this.pwa.$$$(a[0],".replacedRegistryNav")).replaceWith(c),a.find("#navLayer2List").before("\n      <style>\n        .registryNavHead {\n          color: #002e62;\n          font: 800 22px/1.27 var(--fontDisplay);\n        }\n        .babyNav .registryNavHead {\n          color: #000;\n          font: 300 24px/1.27 var(--fontDisplay);\n        }\n        .registryNavSphere {\n          background: #002855;\n          border-radius: 30.5px;\n          color: #FFF;\n          font: 600 14px/1.2 var(--fontMain);\n          height: 61px;\n          margin-left: 10px;\n          padding: 14px;\n          text-transform: uppercase;\n          width: 61px;\n        }\n        .babyNav .registryNavSphere {\n          background: #00a497;\n        }\n        .registryNavItem {\n          text-transform: none;\n        }\n        .registryNavSpacer {\n          margin-top: 3.25rem;\n        }\n        @media (min-width: 80rem) {\n          #registryNav {\n            border-right: 2px solid #cecece;\n            margin-right: 3rem;\n            width: 30%;\n          }\n          .registryNavHead {\n            padding-right: 3rem;\n          }\n          .registryNavSpacer {\n            margin-top: 0.5rem;\n          }\n        }\n      </style>\n    "),
c=$(this.pwa.$$$(a[0],"#registryNav")));try{this.registryNavDataModify(this.registryNav.data.data)}catch(d){console.warn(`error modifying registry Nav data. Error ${d}`)}this.registryNav.innerHtml=Mustache.render(b.template,b.data);c.html(this.registryNav.innerHtml);a[0].registryNavRendered=!0}}async registryParamRouter(a,b){this.pwa.session.docTests.isPLPReg.test(location.pathname)?this.renderCtaMenuFlag=!0:1<this.registryCta.data.data.registryList.length?(a=a.find(".registryCta"),a.removeAttr("data-reg-open"),
a.length&&this.registryCtaMenuRender(a,!0),this.renderCtaMenuFlag=!0):(b.searchParams.has("isPersonalized")&&await this.pwa.util.waitForElement("#vendorIframeModal[data-personalize-ready]",a[0]),this.registryItemAddedModalRender(this.registryCta.data.data.activeRegistry.registryId,{}))}registrySideBarClickHandler(a,b){const c=$(this.pwa.session.docObjActive.shadowBody);b.is(".sidebarCloseCont")&&c.find(".registrySidebar").removeClass("registrySidebarShow");b.is(".tabActive .sidebarTabCont")?b.parent().removeClass("tabActive"):
b.is(".sidebarTabCont")&&(c.find(".tabActive").removeClass("tabActive"),b.parent().addClass("tabActive"));if(b.is("#otherLists")&&!b.parent().find(".registrySidebarPanel").length){let d=this.registryPanelListTemplate(this.registryNav.data.data.registryList,"registrySidebarPanel","0 0 21 6");b.parent().append(d)}b.is("[data-registry-id]")&&(this.activeRegistryChange(c,a),c.find(".activeRegistry").removeClass("activeRegistry").find(".changeRegistryLink").addClass("wHide"),b.addClass("activeRegistry").find(".changeRegistryLink").removeClass("wHide"));
b.is(".dskChecklistBtn, .sidebarOverlay")&&this.registrySidebarToggle(c)}async registrySidebarDataGet(){if(this.registrySidebar.data)return this.registrySidebar.data;try{const a=await this.registryNavDataGet();this.registrySidebar.data=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/registry/${a.data.activeRegistry.registryId}/interactive/checklist/${a.data.activeRegistry.registryType.registryTypeName}/dynamic/true`,{method:"GET",credentials:"include",headers:Object.assign({accept:"application/json, text/plain, */*",
"atg-rest-depth":6},await this.pwa.user.sessionConfirmationHeadersGetOrSet())})}catch(a){console.log("error fetching active registry data")}return this.registrySidebar.data}async registrySidebarRender(a){if(!a[0].registrySidebarRendered&&this.registrySidebar.template){var b=await this.registryNavDataGet();if(!b.data||b.data.activeRegistry.showChecklist){var c=this.registrySidebar;c.data=await this.registrySidebarDataGet();b=a.find("#registrySidebar");b.length||(b=$(`<div id="registrySidebar" class="${this.pwa.session.isBABY?
"babySidebar":""}"></div>`),a.prepend(b));c=Mustache.render(c.template,c.data);b.html(c);a[0].registrySidebarRendered=!0}}}registrySidebarToggle(a){a.find(".registrySidebar").toggleClass("registrySidebarShow");let b=a.find(".dskChecklistBtn");b.toggleClass("dskChecklistBtnActive");b.hasClass("dskChecklistBtnActive")?b.removeAttr("data-modal-open"):b.attr("data-modal-open",!0);a.find(".sidebarOverlay").toggleClass("active")}}
class Sayt{constructor(a){this.pwa=a;this.aSelect=this.term=this.prevSearchTerm=this.debounceTopProd="";this.boundSaytKeyUpEvent=this.saytKeyUpEvent.bind(this);this.boundLoadTopProductsConfig=this.loadTopProductsConfig.bind(this)}async loadTopProducts(a,b,c,d){if(""==b.trim())return!1;let f="",g=this.pwa.session.apiInfo.topProductsApi;try{f=(await this.pwa.amp.ampGetState("storeInfo",250)).data.store.storeId||""}catch(h){console.warn("No store selected for top products.")}g||="https://em02-api-bbby.bbbypropertiestest.com/api/apps/bedbath_typeahead/top-products?web3feo=abc&isGroupby=true&isBrowser=true";
c="brand"===a?`${g}&q=${encodeURIComponent(b)}&brandId=${encodeURIComponent(c)}&storeId=${f}&site=${this.pwa.session.siteId}&__amp_source_origin=${encodeURIComponent(location.origin)}`:"category"===a?`${g}&categoryId=${encodeURIComponent(c)}&storeId=${f}&site=${this.pwa.session.siteId}&__amp_source_origin=${encodeURIComponent(location.origin)}`:"contentSearch"===a?`${location.origin}/apis/services/content/search/v1.0/items?q=${encodeURIComponent(b)}&start=0&perPage=3&site=${this.pwa.session.siteId}`:
`${g}&q=${encodeURIComponent(b)}&storeId=${f}&site=${this.pwa.session.siteId}&__amp_source_origin=${encodeURIComponent(location.origin)}`;try{const h=await (await fetch(c,{method:"GET",headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"}})).json();h.query="brand"===a||"category"===a?d:b;"contentSearch"===a?(h.records=[],h.response.docs=h.response.docs.slice(0,3),h.contentSearch=!0):(h.response=[],h.contentSearch=!1);this.pwa.amp.ampsSetState({topProdSearchState:h})}catch(h){return console.error(`Unable to fetch top products for query: ${b}. Api url: ${g}`),
!1}return!0}loadTopProductsConfig(a){a.currentTarget&&(a=$(a.currentTarget),this.parent.find("#searchInput").val(this.term),this.lastKeySearchTerm=this.term);if("contentSearch"===a.attr("data-type")||"ideaBoards"===a.attr("data-type"))this.debounceTopProd(a.attr("data-type"),this.term);else if(a.attr("data-type")){const b=/\/([0-9]*)\//.exec(a.attr("data-link"))[1],c=a.attr("data-value");this.debounceTopProd(a.attr("data-type"),this.term,b,c)}else this.debounceTopProd("searchTerm",a.text())}topProductsRender(a){this.parent=
a.closest("#searchcontainer");this.term=this.parent.find("#searchInput").val();1280<window.innerWidth?this.parent.find(".topProducts").show():this.parent.find(".topProducts").hide();if(this.prevSearchTerm!=this.term&&(this.prevSearchTerm=this.term,!a.find("[data-listener]").length&&"string"==typeof this.term&&"null"!==this.term&&2<=this.term.length))try{let b=a.find(".typeAhead .searchLink").eq(0).text()||"";b&&""!==b.trim()?(this.debounceTopProd||(this.debounceTopProd=this.pwa.util.debounce(this.loadTopProducts.bind(this),
350,!1)),this.debounceTopProd("searchTerm",b),a.find(".typeAhead .searchLink").on("mouseover",this.boundLoadTopProductsConfig),a.find(".typeAhead").attr("data-listener",1),this.ampListLinks=768>window.innerWidth?a.find("a:not(.searchLink:nth-of-type(1n+8))"):a.find("a"),this.aSelect="",this.aIdx=0,this.aLength=this.ampListLinks.length,this.lastKeySearchTerm="",a.closest("#searchcontainer").off("keyup",this.boundSaytKeyUpEvent),a.closest("#searchcontainer").on("keyup",this.boundSaytKeyUpEvent)):this.parent.find(".topProducts").hide()}catch(b){console.warn(`Unable to get search suggestions from state. Error: ${b}`)}}saytKeyUpEvent(a){this.parent.hasClass("active")&&
(38===a.which?(this.aSelect?(this.aSelect.removeClass("navSelected"),this.aIdx--,0<=this.aIdx?this.aSelect=$(this.ampListLinks[this.aIdx]).addClass("navSelected"):(this.aSelect=this.ampListLinks.last().addClass("navSelected"),this.aIdx=this.aLength)):(this.aSelect=this.ampListLinks.last().addClass("navSelected"),this.aIdx=this.aLength),this.lastKeySearchTerm=this.aSelect.text(),this.parent.find("#searchInput").val(this.lastKeySearchTerm)):40===a.which&&(this.aSelect?(this.aSelect.removeClass("navSelected"),
this.aIdx++,this.aIdx<this.aLength?this.aSelect=$(this.ampListLinks[this.aIdx]).addClass("navSelected"):(this.aSelect=this.ampListLinks.first().addClass("navSelected"),this.aIdx=0)):(this.aSelect=this.ampListLinks.first().addClass("navSelected"),this.aIdx=0),this.lastKeySearchTerm=this.aSelect.text(),this.parent.find("#searchInput").val(this.lastKeySearchTerm)),!this.aSelect||40!==a.which&&38!==a.which||this.boundLoadTopProductsConfig(this.aSelect))}}
class Site{constructor(a){this.pwa=a;this.GROUP_DELIMITER="||";this.PAIR_DELIMITER=":";this.ANGE_DELIMITER="-";this.VALUE_DELIMITER="|";this.RANGE_DELIMITER="-";this.PRICE_KEY="LOW_PRICE";this.STRIP_BOUNDING_QUOTES=/(^")|("$)/g;this.NUMBER_REG_EXP=/\d+(\.\d+)?/g;this.FACETS_REGEX=/(\/store\/(?:brand|category|s)\/[a-zA-Z0-9-_\/]+?)(?:_[a-zA-Z0-9-_]+\/)+((?:[A-Za-z0-9-_]{4})*(?:[A-Za-z0-9-_]{2}==|[A-Za-z0-9-_]{3}=)?)/;this.interactions=[{paramKey:"type",paramVal:"pickItUp",handler:this.cartAdd,thisArg:this,
stopNav:!0,doNotClearParamsPlp:!0},{paramKey:"type",paramVal:"deliverIt",handler:this.cartAdd,thisArg:this,stopNav:!0,doNotClearParamsPlp:!0},{paramKey:"type",paramVal:"cart",handler:this.cartAdd,thisArg:this,stopNav:!0,doNotClearParamsPlp:!0},{paramKey:"type",paramVal:"multiSku",handler:this.cartAdd,thisArg:this,stopNav:!0},{paramKey:"type",paramVal:"addIdeaBoard",handler:this.pwa.ideaboard.ideaModalListBoards,thisArg:this.pwa.ideaboard,stopNav:!0,doNotClearParamsPlp:!0},{paramKey:"type",paramVal:"pickItModal",
handler:this.pwa.pickItModal.pickItInteraction,thisArg:this.pwa.pickItModal,stopNav:!0,doNotClearParams:!0},{paramKey:"type",paramVal:"deliveryModal",handler:this.pwa.deliveryModal.initRender,thisArg:this.pwa.deliveryModal,stopNav:!0},{paramKey:"type",paramVal:"personalize",handler:this.pwa.personalize.personalizeParamRouter,thisArg:this.pwa.personalize},{paramKey:"personalize",handler:this.pwa.personalize.personalizeParamRouter,thisArg:this.pwa.personalize},{paramKey:"type",paramVal:"collectionAtc",
handler:this.pwa.pdp.collectionParamRouter,thisArg:this,stopNav:!0}];this.bazaarVoiceKey="caPP8r25N3Lb85qsfG7E6bwa4MTKEdtiKyoPMtCoKfRDI";this.interactionParamsToClear="removeInStock nearestStores personalize type qty zipCode prodId storeId sddZip zip".split(" ");this.formHandlers={pdpIdeaboard:"formIdeaboardHandler",pdpPickIt:"formCartHandler",pdpDeliverIt:"formCartHandler",pdpShipIt:"formCartHandler",collectionsatc:"formCartHandler",pdpPersonalizeIt:"pdpPersonalizeItHandler",pdpOosOnline:"pdpOosOnlineHandler",
pdpWriteReviewForm:"writeReviewFromHandler",pdpReviewHelpful:"pdpReviewHelpfulHandler",pdpQaHelpful:"pdpReviewHelpfulHandler",recentSearchFormHandler:"recentSearchFormHandler",siteGiftcard:"siteGiftcardHandler"};this.tealiumConfig={}}async headsUp(a,b){try{this.pwa.util.scriptAddMustache(),this.pwa.appshell.modalHURender(a,b)}catch(c){console.log(c),this.pwa.appshell.modalHURender({error:"Unable to add to cart"})}}async cartAdd(a,b){if("1046959492"==a.prodId)location.href=location.origin+"/store/loyalty/beyondplus?isRedirect=true";
else{this.pwa.appshell.elems.loadingOverlay.addClass("loading");this.pwa.quickView.quickViewLoaded&&this.pwa.quickView.quickViewClose();try{if(!/multiSku|collectionAtc/gi.test(a.type)&&!a.ltlFlag){var c=await this.pwa.analytics.getLtlData({prodId:a.prodId,skuId:a.skuId});c.ltlShipMethod&&(a.ltlShipMethod=c.ltlShipMethod)}try{var d=JSON.parse(localStorage.getItem("user"))||{};if((d.college||{}).isCollege||this.pwa.college.isCollege){var f=d.favoriteStore||{};a.reserveNow=!0;const r=this.pwa.college.regularBopis?
"":f.pickupDate||this.pwa.college.selectedDate||"";r&&(a.reserveDate=(new Date(r)).toLocaleDateString("en",{month:"numeric",day:"2-digit",year:"numeric"}));a.pickupType=this.pwa.college.regularBopis?"bopis":"college";a.storeId=this.pwa.college.regularBopis?a.storeId:f.storeId||a.storeId}}catch(r){console.error("error adding college PH params to cart object",r)}this.pwa.util.scriptAddMustache();const m=this.cartObjMake(a,b);var g=a.prodId;0<m.addItemResults.length&&!a.prodId&&(g=m.addItemResults[0].prodId);
const p=[this.pwa.appshell.fetchCartSliderData(g,a.type)];this.pwa.appshell.cartModalTmp||p.push(this.pwa.appshell.fetchAppshellTmp(this.pwa.session.apiInfo.cartSlider,"cartSlider"));this.pwa.pickItModal.loadTemplate();var h=`jsonResultString=${encodeURIComponent(JSON.stringify(m))}`;const n=await this.pwa.util.statefulFetch(`${location.origin}/apis/stateful/v1.0/cart/item`,{body:h,credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())});
h=!1;c=39;d=0;f=!1;var k=m.addItemResults.length||0;let q=a.qty?parseInt(a.qty):1;try{if("cart"==b||768<=window.innerWidth)this.pwa.session.miniCartData=await this.pwa.appshell.getCartData()}catch(r){console.warn(`Error getting current order details in cart add. Error: ${r}`)}g=void 0;if("collectionAtc"==b)try{var l=this.pwa.session.docObjActive?$(this.pwa.session.docObjActive.shadowBody):[];if(0<l.find(".collectionCartOosError").length){let r={};l.find(".cProdFullmentList").each(function(u,w){(u=
$(w).attr("id").replace("cProdFulfillmentList",""))&&(r[`skuFacets${u}`]={qtyError:!1})});await this.pwa.amp.ampsSetState(r)}if(n.data.component&&n.data.component.order&&n.data.component.order.oosItems&&n.data.component.order.oosItems[0]){if(0==l.length){let u=await this.pwa.util.waitForProp("docObjActive",this.pwa.session);l=$(u.shadowBody)}this.pwa.appshell.elems.loadingOverlay.removeClass("loading");g=n.data.component.order.oosItems[0].oosProductId;let r=l.find(`#ffListTarget${g}`);l={};l[`skuFacets${g}`]=
{qtyError:!0};await this.pwa.amp.ampsSetState(l);0<r.length&&r[0].scrollIntoView({behavior:"smooth"})}}catch(r){throw console.log("found OOS qnty error for collection",r),Error(r);}if("multiSku"==b||"collectionAtc"==b)q=m.addItemResults.reduce((r,u)=>{try{r+=parseInt(u.qty)}catch(w){}return r},0);if("cart"==b)try{const r=this.pwa.session.miniCartData;h=r.data.atgResponse.ClosenessQualifier.freeShippingBanner.showCongratsFreeShipMsg;d=r.data.atgResponse.ClosenessQualifier.freeShippingBanner.shippingDifference;
c=r.data.atgResponse.ClosenessQualifier.freeShippingBanner.upperThreshold;f=r.data.atgResponse.ClosenessQualifier.freeShippingBanner.freeShippingPromo}catch(r){console.warn(`Unable to get shipping threshold. Error(${r})`)}this.pwa.appshell.renderCartSticky();Object.assign(n,{isPickIt:"pickItUp"==b,isDeliverIt:"deliverIt"==b,isShipIt:"cart"==b,isMultiSku:"multiSku"==b||"collectionAtc"==b,isPersonalized:"personalize"==b,itemsAdded:k,itemQuantity:q,scene7Base:this.pwa.session.apiInfo.scene7RootUrl+"/",
freeShippingEligible:h,shipThreshhold:c,shipDiff:d,freeShippingPromo:f,prodId:a.prodId,storeName:a.storeName||void 0,formatPrice:function(){return this.toFixed(2)},editQty:this.pwa.session.features.atcEditQuantity});n.qtyOver2=1<n.itemQuantity;if(n.isPickIt){k=void 0;try{n.storeName&&/bed bath|harmon|buy buy baby/i.test(n.storeName)||(k=await this.pwa.amp.ampGetState("storeInfo"),n.storeName=n.storeName?n.storeName:k.data.store.commonName,/bed bath|harmon|buy buy baby/i.test(n.storeName)||a.storeId!=
k.data.store.storeId||("10"==k.data.store.storeType||"50"==k.data.store.storeType?n.storeName=`${n.storeName} Bed Bath & Beyond`:"40"==k.data.store.storeType?n.storeName=`${n.storeName} buybuy BABY`:"30"==k.data.store.storeType&&(n.storeName=`${n.storeName} Harmon Face Values`)))}catch(r){console.warn("cartAdd unable to get store name")}}if(n.isDeliverIt){let r=a.sddZip;if(!r)try{r=(await this.pwa.amp.ampGetState("changeStore")).sddZipcode}catch(u){console.warn("Unable to get seleced sdd zip")}n.sddZip=
r}try{let r=n.data.component.order.commerceItemVOList.filter(w=>w.skuId==a.skuId),u=n.data.component.order.commerceItemVOList.filter(w=>w.skuId!=a.skuId);n.data.component.order.commerceItemVOList=r.concat(u)}catch(r){}this.pwa.college.isCollege&&!this.pwa.college.regularBopis&&(n.storeName=this.pwa.college.favoriteStore.storeName);g||this.pwa.appshell.modalCartRender(n,p);try{this.pwa.amp.ampsSetState({user:{data:{Cart:{itemCount:n.data.component.order.cartItemCount}}}})}catch(r){console.warn("unable to update cart count",
r)}n.isPersonalized&&(n.product_has_personalization=!0);let t=$(this.pwa.session.docObjActive.shadowBody).find(".pricesWrap amp-list:not([hidden]) .trackIsPrice").text()||"";m.product_price=[t.trim()];const v=Object.hasOwn(a,"subscriptionItem"),z="true"===a.subscriptionItem,D=a.subscriptionEvery&&"null"!==a.subscriptionEvery?a.subscriptionEvery:"";v&&(n.subscription_eligible=[v],n.subscription_item=[z],n.subscription_frequency_label=[D]);n.cartFormSubmission=m;try{Object.assign(n.cartFormSubmission.addItemResults[0],
ltlShipParams)}catch(r){}let B=this.pwa.session.docTests.isPDPReg.test(location.pathname),A;if("pickItUp"==b){if(A=B?"pdpPickItUpClick":"plpPickItUpClick",this.pwa.college.isCollege){let r=this.pwa.college.createCollegeAnalyticsObj(m);try{Object.assign(n.cartFormSubmission.addItemResults[0],r)}catch(u){}}}else if("deliverIt"==b||"cart"==b||"personalize"==b||"multiSku"==b)A=B?"pdpShipIt":"plpAddToCart";let E=$(`<div data-cta='${A}'></div>`);this.tealiumClickEventEmitter(E[0],n);if(window.triggerLoadEvent&&
this.pwa.session.docObjActive.ampPathSearch){const r=new URLSearchParams(this.pwa.session.docObjActive.ampPathSearch),u={};try{for(const [y,x]of r)u[y]=/dataLayer/.test(y)?JSON.parse(decodeURIComponent(x)):x}catch(y){for(const [x,C]of r)u[x]=/dataLayer/.test(x)?JSON.parse(decodeURIComponent(encodeURIComponent(C))):C}u.dataLayer={...u.dataLayer,page_name:"add to cart modal",call_to_actiontype:"add to cart modal"};let w="";try{Object.keys(u).forEach(y=>{w+=`${encodeURIComponent(y)}=${/dataLayer/.test(y)?
encodeURIComponent(JSON.stringify(u[y])):u[y]}&`})}catch(y){w="",Object.keys(u).forEach(x=>{w+=`${encodeURIComponent(x)}=${/dataLayer/.test(x)?encodeURIComponent(decodeURIComponent(JSON.stringify(u[x]))):u[x]}&`})}this.pwa.session.docObjActive.ampPathSearch=w;window.triggerLoadEvent(this.pwa.session.docObjActive.ampPathSearch)}}catch(m){console.log(m),this.pwa.appshell.modalCartRender({error:"Unable to add to cart"})}}}async toggleBeaconDisabledFlag(a,b){let c=$(this.pwa.session.docObjActive.shadowBody);
const d=JSON.parse(c.find(a).text());a=a.match(/[\w]+/i)[0];const f={groupByViewProduct:"viewProduct"};d.extraUrlParams=d.extraUrlParams||{};d.extraUrlParams.experiments=d.extraUrlParams.experiments||[];"disable"==b?d.extraUrlParams.experiments.push({experimentId:"do_not_use",experimentVariant:f[a]}):d.extraUrlParams.experiments=d.extraUrlParams.experiments.filter(g=>"do_not_use"!=g.experimentId);c.find("#groupByViewProduct script").text(JSON.stringify(d))}cartObjMake(a,b){let c=[];const d=(new URL(location.href)).searchParams.get("registryId");
let f="1";try{f=a.qty?`${Math.abs(parseInt(a.qty))}`:"1"}catch(h){console.log(`Could not parse quantity to number. Error: ${h}`)}const g={bts:!1,favStoreState:"null",ltlShipMethod:a.ltlShipMethod,level_of_service:a.level_of_service,mie:"false",porchPayLoadJson:"",prodId:a.prodId,qty:f,refNum:"",registryId:d,skuId:a.skuId};"pickItUp"==b?(c.push(Object.assign({},g,{reserveNow:"true",sddZipCode:null,storeId:a.storeId})),this.pwa.college.isCollege&&Object.assign(c[0],{reserveDate:a.reserveDate,pickupType:a.pickupType})):
"deliverIt"==b?c.push(Object.assign({},g,{rbyrItem:!1,reserveNow:"undefined",sddItem:!0,sddZipCode:a.sddZip||a.sddZipCode,storeId:null,warrantySkuId:""})):"cart"==b&&a.marketPlaceItem?c.push(Object.assign({},g,{rbyrItem:!1,reserveNow:"undefined",sddItem:!1,sddZipCode:null,storeId:null,warrantySkuId:"",marketPlaceItem:a.marketPlaceItem,marketPlaceItemOverSized:a.marketPlaceItemOverSized,marketPlaceOfferId:a.marketPlaceOfferId})):"cart"==b?c.push(Object.assign({},g,{rbyrItem:!1,reserveNow:"undefined",
sddItem:!1,sddZipCode:null,storeId:null,warrantySkuId:"",subscriptionItem:a.subscriptionItem,subscriptionEvery:a.subscriptionEvery})):"multiSku"==b?Object.keys(a).forEach(h=>{if(/multiSku/g.test(h)){let [k,l]=a[h].split(",");k&&l&&c.push(Object.assign({},g,{skuId:l,prodId:k,qty:"1",rbyrItem:!1,reserveNow:"undefined",sddItem:!1,sddZipCode:null,storeId:null,warrantySkuId:""}))}}):"personalize"==b?c.push(Object.assign({},g,{rbyrItem:!1,refNum:this.pwa.personalize.personalizedSku[a.skuId].refnum,reserveNow:"undefined",
sddItem:!1,sddZipCode:null,storeId:null,warrantySkuId:"",subscriptionItem:a.subscriptionItem||"false",marketPlaceItem:a.marketPlaceItem||!1,marketPlaceItemOverSized:a.marketPlaceItemOverSized||!1,marketPlaceOfferId:a.marketPlaceOfferId||""})):"collectionAtc"==b&&JSON.parse(decodeURIComponent(a.products).replace(/},]/i,"}]")).forEach((h,k)=>{h.qty&&"0"!==h.qty&&"null"!=h.qty&&(c.push(Object.assign({},g,{skuId:h.skuId,prodId:h.prodId,qty:h.qty,rbyrItem:!1,reserveNow:"undefined",sddItem:"deliverIt"==
h.fulfillment?!0:null,sddZipCode:"deliverIt"==h.fulfillment?a.sddZip:null,storeId:"pickItUp"==h.fulfillment?a.storeId:null,warrantySkuId:""})),1==h.LTL_FLAG||"true"==h.LTL_FLAG)&&(c[c.length-1].ltlShipMethod="LT")});return{addItemResults:c}}async formCartHandler(a){this.pwa.appshell.elems.loadingOverlay.addClass("loading");const b=this.pwa.util.formToObject(a);if("collectionAtc"==b.type){var c=a.closest("#second").find(".collectionOosError");if(0<c.length)return this.pwa.appshell.elems.loadingOverlay.removeClass("loading"),
c[0].scrollIntoView({block:"center",behavior:"auto",inline:"center"}),!1}this.pwa.session.docTests.isPDPReg.test(location.pathname)&&"pickItUp"===b.type?(c=await Promise.race([this.pwa.amp.ampGetState("storeClosestInStock"),this.pwa.amp.ampGetState("headsUpModal"),this.pwa.amp.ampGetState("collectionStatus")]),c.closestStoreOutStockName&&c.bopisInStockStoreId&&c.bopisInStockStoreId==b.storeId&&0==a.closest(".pickItModal").length?this.headsUp(b,c):this.cartAdd(b,b.type)):this.cartAdd(b,b.type);return!0}formIdeaboardHandler(a){a=
this.pwa.util.formToObject(a);this.pwa.ideaboard.ideaModalListBoards(a);return!0}formPwaHandlerOnly(a){a.find("form[data-pwa-handler]").each((b,c)=>{b=$(c);c=b.attr("data-pwa-handler");/pdpPickIt|pdpDeliverIt|pdpShipIt|pdpIdeaboard|pdpOosOnline|siteGiftcard|collectionsatc/i.test(c)?(b.each(this.pwa.formSubmitHandlerRegistration.bind(this.pwa)),b.attr({method:"post",action:""})):(c=b.clone(),c.each(this.pwa.formSubmitHandlerRegistration.bind(this.pwa)),b.replaceWith(c))})}formSubmitRouter(a){var b=
a.attr("data-pwa-handler");return(b=this.formHandlers[b])?this[b](a):!1}async handleReviewPhotos(a){function b(d){try{let f=$("#reviewThumbContainer"),g=d.Photo.Sizes.normal.Url,h=d.Photo.Sizes.thumbnail.Url,k=f.find(".photoInput").length;f.append(`
        <div class="thumbContainer" id="thumbContainer_${k}">
          <input type="hidden" class="photoInput" value="${g}" name="photourl_${k+1}">
          <img src="${h}" class="photoNode">
          <span class="removePhoto">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="8" height="8" id="CloseIcon"><path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.474 1.748L1.526 14.252m0-12.504l12.948 12.504"></path></svg>
          </span>
        </div>`)}catch(f){c("Photo uploaded successfully but was unable to display a thumbnail")}}function c(d){let f=$("#reviewPhotoError");return 0<f.length?(d&&f.text(d),f.removeClass("hide"),f.addClass("show"),!0):!1}a=this.files;if(0<a.length)try{const d=new FormData;d.append("photo",a.item(0));const f=await (await fetch("https://api.bazaarvoice.com/data/uploadphoto.json?apiversion=5.4&passkey=caPP8r25N3Lb85qsfG7E6bwa4MTKEdtiKyoPMtCoKfRDI&contenttype=Review&locale=en_US",{method:"POST",body:d,
headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"}})).json();if(f.HasErrors)try{c(f.FormErrors.FieldErrors.photo.Message)}catch(g){c()}else $("#reviewPhotoError").addClass("hide").removeClass("show"),b(f)}catch(d){console.warn(`Unable to upload photo. Error: ${d}`),c()}}loadBlackBox(){window.IGLOO=window.IGLOO||{enable_rip:!0,enable_flash:!1,install_flash:!1,loader:{version:"general5",fp_static:!1}};"function"!==typeof window.IGLOO.getBlackBox&&this.pwa.util.scriptAdd(`${location.origin}/static/assets/js/iovation.js`)}async pdpReviewsHelpfulHandler(a,
b){b.attr("disabled");a=b.attr("data-qId");const c=b.attr("data-vote"),d=b.attr("data-type");a=`https://api.bazaarvoice.com/data/submitfeedback.json?apiversion=${this.pwa.session.apiInfo.bazaarvoiceApiVersion}&feedbackType=helpfulness&action=submit&locale=${this.pwa.session.apiInfo.bazaarvoiceLocal}&contentId=${a}&contentType=${d}&passkey=${this.pwa.session.apiInfo.bazaarvoiceApiKey}&vote=${c}`;try{const f=await (await fetch(a,{method:"POST",headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors",
"Sec-Fetch-Site":"cross-site"}})).json();this.updateHelpfulForm(b.parent(),f,b)}catch(f){console.warn(`Unable to submit helpful vote. Error: ${f}`),this.updateHelpfulForm(b.parent(),{HasErrors:!0},b)}}updateHelpfulForm(a,b,c){function d(f){0==f.find(".error").length&&f.append('<span class="error alert helpfulError">There was a problem submitting your vote</span>')}try{a.find(".error").remove();if(b.HasErrors){d(a);return}let f=b.Feedback.Helpfulness.Vote,g=a.find(".helpfulCnt"),h=parseInt(g.text());
"POSITIVE"==f?(c.attr("data-vote","negative"),g.text(h+1)):(c.attr("data-vote","positive"),g.text(h-1))}catch(f){console.warn(`Unable to render the helpfulness form response. Error: ${f}`),d(a)}c.removeAttr("disabled")}pdpOosModalHandler(a){try{let b=new URL(location.href);a.find(".outOfStockCont").addClass("active");this.pwa.amp.ampSetStateBeforeRender(a,"u",{outOfStockModal:!0});b.searchParams.delete("type");history.replaceState("",document.title,b.toString())}catch(b){console.warn("Unable to trigger OOS modal")}}async pdpOosAmpHandler(a){try{let c=
new URL(location.href),d=a.find('.i-amphtml-replaced-content [data-pwa-handler="pdpOosOnline"]');if(0!=d.length&&"oosForm"===c.searchParams.get("type")&&!d[0].hasAttribute("hidden")){var b=[];c.searchParams.forEach((f,g)=>{d.find(`input[name="${g}"]`).val(f);0<d.find(`input[name="${g}"]`).length&&b.push(g)});b.forEach(f=>c.searchParams.delete(f));d.trigger("submit");d[0].scrollIntoView({block:"center",behavior:"auto",inline:"center"});history.replaceState("",document.title,c.toString())}}catch(c){console.log(`Unable to handle oos form from amp. Error: ${c}`)}}async pdpOosOnlineHandler(a){let b;
var c=this.pwa.util.createInputMatchHandler({useForm:!0}),d=this.pwa.appshell.validateForm(a[0]);c=c(a);if(d&&c){$(a).removeClass("amp-form-submit-error");d=$(a).serialize();try{if(b=await this.pwa.util.statefulFetch(this.pwa.session.apiInfo.apiOutOfStockForm,{body:d,credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},await this.pwa.user.sessionConfirmationHeadersGetOrSet())}),"SUCCESS"==b.serviceStatus)this.pwa.amp.ampsSetState({outOfStockFormSuccess:!0});
else throw Error("Errors submitting oos from",b);}catch(f){$(a).addClass("amp-form-submit-error"),console.warn(`Prolbem submitting PDP out of stock notification form. Error: ${f}`)}}else this.formValidationHandler=this.formValidationHandler?this.formValidationHandler:f=>{this.pwa.appshell.validateForm(f.currentTarget)},$(a).addClass("amp-form-submit-error"),a[0].removeEventListener("change",this.formValidationHandler),a[0].addEventListener("change",this.formValidationHandler)}async pdpPersonalizeItHandler(a){var b=
a.find("[name=prodId]").val();let c=a.find("[name=skuId]").val();this.pwa.personalize.personalizedSku[c]?(a=this.pwa.util.formToObject(a),b=await this.pwa.amp.ampGetState(`skuFacets${b}`),a.qty=b.qty||"1",await this.cartAdd(a,"personalize"),this.pwa.personalize.removeData(c)):this.pwa.personalize.openModal(c);return!0}async writeReviewFromHandler(a){var b={passkey:null,apiversion:null,sendemailalertwhenpublished:!0,sendemailalertwhencommented:!0,sendemailalertwhenanswered:!0,locale:null,action:"submit"};
try{b.passkey=this.pwa.session.apiInfo.bazaarvoiceApiKey,b.apiversion=this.pwa.session.apiInfo.bazaarvoiceApiVersion,b.locale=this.pwa.session.apiInfo.bazaarvoiceLocal}catch(f){console.warn(`Unable to get apiInfo from session. Error: ${f}`)}let c=a.attr("action");try{var d=this.getDeviceFingerprint();let f=0;for(;!d&&4>f;)d=this.getDeviceFingerprint(),f+=1;b.fp=d}catch(f){console.error(`Unable to get the device fingerprint to submit the review form. Error: ${f}`)}d=this.pwa.util.formToObject(a);d.email&&
(d.useremail=d.email,delete d.email);b=Object.assign(b,d);b=this.objToQueryStr(b);try{const f=await (await fetch(`${c}?${b}`,{method:"POST",headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"}})).json();this.pwa.appshell.renderReviewFormResponse(f,a)}catch(f){console.warn(`Unable to submit form . Error ${f}`),this.pwa.appshell.renderReviewFormResponse({Errors:["Error submitting form. Please try again later"]},a)}}async scrapeProdData(a,b,c){let d,f,g;try{this.pwa.util.scriptAddMustache(),
this.loadBlackBox()}catch(h){console.warn(`Error loading libraries for write review modal. Error: ${h}`)}try{d=(d=a.find("#prodSlideCarousel img").attr("src"))?d:null;let h="title";this.pwa.session.isPdpV2&&(h="prodTitle");f=(f=a.find(`.${h}`).text())?f:null;(g=this.prodIdGet(b))&&await this.pwa.appshell.modalWriteReviewRender(f,d,g,c)}catch(h){console.warn(`Unable to get the data to display review modal. Error: ${h}`)}}getDeviceFingerprint(){if("function"!==typeof window.IGLOO.getBlackbox)return null;
var a=window.IGLOO.getBlackbox();if(a.finished)return a.blackbox}inputsNodesToObj(a){let b={};a.find("input,textarea").each(function(c){c=this.name;let d=this.value;c&&d&&("radio"!==this.type||this.checked)&&(b[c]=d)});return b}handleAmpAction(a,b){if(!(window.innerWidth<a)){a=$(b.target);b=$(b.relatedTarget).attr("class");var c=a.attr("data-related"),d=a.attr("data-state"),f=a.attr("data-interact-test");if(d){var g={};try{g=JSON.parse(d),(b&&c&&-1==b.indexOf(c)||!c)&&(!f||a.hasClass(f))&&this.amp.ampsSetState(g)}catch(h){console.warn(`handleAmpAction: Unable to parse data-state. Error: ${h}`)}}}}async dskCloseOnClick(a){function b(f,
g){return null==f?Object.assign({},g):Object.assign(f,g)}let c=null;a=$(a.target);let d=a.closest("body");try{a.closest("header").length&&0==a.closest(".csModal, #csBannerList").length&&(c=b(c,{changeStore:{csModal:!1}})),0==a.closest("#searchcontainer").length&&d.find("#searchcontainer").hasClass("active")&&(c=b(c,{u:{search:null}})),0==a.closest(".ssMRad").length&&0<d.find(".ssMRad").length&&!d.find(".ssMRad").hasClass("hide")&&(c=b(c,{changeStore:{radiusModal:!1}})),a.hasClass("ssModal")&&(c=b(c,
{changeStore:{ssModal:!1}})),0==a.closest(".findCollegeStateModal").length&&0<d.find(".findCollegeStateModal").length&&!d.find(".findCollegeStateModal").hasClass("hide")&&(c=b(c,{changeCollege:{searchStateModal:!1}})),0==a.closest(".findCollegeSchoolModal").length&&0<d.find(".findCollegeSchoolModal").length&&!d.find(".findCollegeSchoolModal").hasClass("hide")&&(c=b(c,{changeCollege:{searchSchoolModal:!1}})),a.hasClass("findMyCollegeModal")&&(c=b(c,{changeCollege:{findMyCollegeModal:!1}})),c&&this.pwa.amp.ampsSetState(c)}catch(f){console.warn(`Error closing search. Error: ${f}`)}}objToQueryStr(a){return Object.keys(a).reduce((b,
c,d,f)=>{let g=encodeURIComponent(c);if(c=encodeURIComponent(a[c]))b+=`${g}=${c}`,b+=d+1<f.length?"&":"";return b},"")}async interactionParamRouter(a){var b=a.searchParams;let c=!1,d=!1;for(const f of this.interactions)if(b.has(f.paramKey)&&(!f.paramVal||f.paramVal===b.get(f.paramKey))){b={};for(let [g,h]of a.searchParams.entries())b[g]=h;f.handler.bind(f.thisArg)(b,f.paramVal,a);c=f.stopNav;d=f.doNotClearParams?!1:!0;break}if(!this.pwa.session.isStaging&&d){for(const f of this.interactionParamsToClear)a.searchParams.delete(f);
history.replaceState(null,"",a.href)}return[a,c]}async loadFirstPagePostRender(){try{$("#headerWrap").remove(),768<=window.innerWidth&&this.pwa.appshell.renderCartSticky(!1),console.timeEnd("pwaFirstPageRender"),await this.scriptsFirstPagePostRender()}catch(a){this.pwa.errorCustom(a)}}async loadFirstPageFirstScrollOrClick(){wmPwa.session.loadedFirstPageFirstScrollOrClick||(wmPwa.session.loadedFirstPageFirstScrollOrClick=!0,$(window).off("scroll",wmPwa.site.loadFirstPageFirstScrollOrClick),$(window).off("mousedown",
wmPwa.site.loadFirstPageFirstScrollOrClick),setTimeout(async()=>{let a="https://cdn.quantummetric.com/qscripts/quantum-bbb.js";wmPwa.session.isPreprod&&(a="https://cdn.quantummetric.com/qscripts/quantum-bbbtest.js");let b=document.createElement("script");b.setAttribute("defer","");b.setAttribute("src",a);document.head.appendChild(b)},1E3),setTimeout(async()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(function(a){console.log("Service Worker Registered",a)}).catch(function(a){console.log("Service Worker Failed to Register",
a)})},6E3))}prodIdGet(a){let b=null;(a=/(\d+)(\/)?$/i.exec(a.pathname))&&(b=a[1]);return b}redirectUrlSet(){try{sessionStorage.setItem("redirectpageurl",`${location.pathname}${location.search}`)}catch(a){}}skuGet(a,b,c){function d(k,l){return k.data.filter(m=>m.COLOR==l.color&&m.SKU_SIZE==l.size)[0]||null}function f(k,l){return k.data.filter(m=>l.color&&l.color==m.COLOR||l.size&&l.size==m.SKU_SIZE)[0]||null}function g(k,l){return k.data.filter(m=>l.color&&l.color==m.COLOR)[0]||null}if(!a||!a.data)return null;
let h;2==b.qty&&c?h=g(a,b):2==b.qty?h=d(a,b):1==b.qty&&(h=f(a,b));return h}async scriptsEveryPagePostRender(){this.pwa.site.redirectUrlSet();if(!this.pwa.session.isFast){this.pwa.appshell.renderTemplate("#scriptsEveryPageDom","#scriptsEveryPageTemplate");if(this.pwa.session.docTests.isHomeReg.test(location.pathname)){var a="/static/analytics/amp/event/homePwaAnalytics.js";var b="homePwaAnalytics"}else if(this.pwa.session.docTests.isCLPReg.test(location.pathname))a="/static/analytics/amp/event/clpPwaAnalytics.js",
b="clpPwaAnalytics";else if(this.pwa.session.docTests.isPLPReg.test(location.pathname)){a="/static/analytics/amp/event/plpPwaAnalytics.js";b="plpPwaAnalytics";try{let d=[];var c=await this.pwa.amp.ampGetState("prodList");if("Unable to get data for AMP.prodList"==c.errMsg){const h=new RegExp(this.pwa.session.searchTemplateTerm,"gi");try{this.pwa.session.docObjActive.ampPathSearch=this.pwa.session.docObjActive.ampPathSearch.replace(h,encodeURIComponent(`apiFailure - {${this.pwa.session.parsedURL.basePath.split("/")[3]}}`))}catch(k){}}c.response.docs.forEach(function(h){h.PRODUCT_ID&&
d.push(h.PRODUCT_ID)});this.pwa.session.docObjActive.ampPathSearch=this.pwa.session.docObjActive.ampPathSearch.replace(/%22product_id%22%3A%5B(.+)%5D%2C/,"");const f=(await this.pwa.amp.ampGetState("prodList")).response.numFound;this.pwa.session.docObjActive.ampPathSearch=this.pwa.session.docObjActive.ampPathSearch.replace(/search_results%22%3A[0-9]+/,`search_results%22%3A${f}`);let g=encodeURIComponent(JSON.stringify(d));this.pwa.session.docObjActive.ampPathSearch=this.pwa.session.docObjActive.ampPathSearch.replace(/%22product_ids_displayed%22%3A%5B(.+)%5D/,
"%22product_ids_displayed%22:"+g+"%2C%22product_id%22:"+g);this.pwa.session.docObjActive.ampPathSearch+="&groupBySearchId="+c.id;this.pwa.quickView.quickViewLoaded&&(this.pwa.session.docObjActive.ampPathSearch+="&quickview=true")}catch(d){console.error("Could not populate the product Ids for analytics",d)}}else this.pwa.session.docTests.isPDPReg.test(location.pathname)&&(a="/static/analytics/amp/event/pdpPwaAnalytics.js",b="pdpPwaAnalytics");0==$("#"+b).length?(c=document.createElement("script"),
c.setAttribute("defer",""),c.setAttribute("src",a),c.setAttribute("id",b),c.onload=function(){window.triggerLoadEvent&&this.pwa.session.docObjActive.ampPathSearch&&window.triggerLoadEvent(this.pwa.session.docObjActive.ampPathSearch)}.bind(this),document.head.appendChild(c)):window.triggerLoadEvent&&this.pwa.session.docObjActive.ampPathSearch&&window.triggerLoadEvent(this.pwa.session.docObjActive.ampPathSearch);a="5V36A-NLMZS-7YZAZ-HFM7A-9LEGR";this.pwa.session.isBABY?a="QQ2TK-UWBEU-SEMVW-DA9FE-W7TV4":
this.pwa.session.isCANADA?a="T4WGM-M63BR-D98MP-ULKLM-D3MUC":this.pwa.session.isHARMON&&(a="RWF6G-CAHF9-DFMD4-NSZLT-EUGT4");a=$(`<script>
      window.BOOMR_config = window.BOOMR_config || {};
      window.BOOMR_config.AutoXHR = window.BOOMR_config.AutoXHR || {};
      window.BOOMR_config.AutoXHR = {
        // alwaysSendXhr: true,
        spaStartFromClick: true,
        monitorFetch: true
      };
      window.BOOMR_config.PageParams = {
        spaXhr: "all"
      };

      //
      // Resource Timing - Set Count to 350
      //
      (function(w){
        if (!w ||
          !("performance" in w) ||
          !w.performance ||
          !w.performance.setResourceTimingBufferSize) {
          return;
        }

        w.performance.setResourceTimingBufferSize(350);
      })(window);


      //
      //Clear Resource Timing Buffer
      //
      (function(w){
        if (!w ||
          !("performance" in w) ||
          !w.performance ||
          !w.performance.clearResourceTimings) {
          return;
        }

        document.addEventListener("onBoomerangBeacon", w.performance.clearResourceTimings.bind(w.performance));
      })(window);

      (function(){if(window.BOOMR&&(window.BOOMR.version||window.BOOMR.snippetExecuted)){return}window.BOOMR=window.BOOMR||{};window.BOOMR.snippetStart=(new Date).getTime();window.BOOMR.snippetExecuted=true;window.BOOMR.snippetVersion=15;window.BOOMR.url="//c.go-mpulse.net/boomerang/${a}";var e=document.currentScript||document.getElementsByTagName("script")[0],a=e.parentNode,s=false,t=3e3;function n(){if(s){return}var e=document.createElement("script");e.id="boomr-scr-as";e.src=window.BOOMR.url;e.async=true;a.appendChild(e);s=true}function i(e){s=true;var t,i=document,n,o,d,r=window;window.BOOMR.snippetMethod=e?"if":"i";n=function(e,t){var n=i.createElement("script");n.id=t||"boomr-if-as";n.src=window.BOOMR.url;BOOMR_lstart=(new Date).getTime();e=e||i.body;e.appendChild(n)};if(!window.addEventListener&&window.attachEvent&&navigator.userAgent.match(/MSIE [678]\./)){window.BOOMR.snippetMethod="s";n(a,"boomr-async");return}o=document.createElement("IFRAME");o.src="about:blank";o.title="";o.role="presentation";o.loading="eager";d=(o.frameElement||o).style;d.width=0;d.height=0;d.border=0;d.display="none";a.appendChild(o);try{r=o.contentWindow;i=r.document.open()}catch(e){t=document.domain;o.src="javascript:var d=document.open();d.domain='"+t+"';void 0;";r=o.contentWindow;i=r.document.open()}r._boomrl=function(){n()};if(r.addEventListener){r.addEventListener("load",r._boomrl,false)}else if(r.attachEvent){r.attachEvent("onload",r._boomrl)}i.close()}var o=document.createElement("link");if(o.relList&&typeof o.relList.supports==="function"&&o.relList.supports("preload")&&"as"in o){window.BOOMR.snippetMethod="p";o.href=window.BOOMR.url;o.rel="preload";o.as="script";o.addEventListener("load",n);o.addEventListener("error",function(){i(true)});setTimeout(function(){if(!s){i(true)}},t);BOOMR_lstart=(new Date).getTime();a.appendChild(o)}else{i(false)}function d(e){window.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()}if(window.addEventListener){window.addEventListener("load",d,false)}else if(window.attachEvent){window.attachEvent("onload",d)}})();
    </script>
    `);/mPulse=false/gi.test(location.search)||$("head meta").last().after(a);if(this.pwa.session.docTests.isPDPReg.test(location.pathname)&&!this.pwa.session.isFast){let d=this.pwa.util.debounce(function(){document.removeEventListener("scroll",d);if(0==$("#webcollageClientScript").length){var f="7bd96439-1976-4748-9c97-242941e50e0d";this.pwa.session.isBBB_US&&this.pwa.desktop.isDesktop&&(f="52539da6-b43e-469f-927f-294e7b3435bd");this.pwa.session.isBABY&&(f="1cb29f4c-1651-46ef-b519-7c9a991a0e94",
this.pwa.desktop.isDesktop&&(f="9ccdeb66-058d-48f9-88fb-9e1e83844981"));this.pwa.session.isCANADA&&(f="0697092a-f6c4-4719-afb8-0a8853fc44bb",this.pwa.desktop.isDesktop&&(f="f46b6882-cb52-446c-bd0d-172a3dc3e979"));f="https://content.syndigo.com/site/"+f+"/tag.js?cv="+Math.floor(Date.now()/864E5);let g=document.createElement("script");g.setAttribute("async","");g.setAttribute("src",f);g.setAttribute("id","webcollageClientScript");this.pwa.site.renderWebcollage();document.head.appendChild(g)}else this.pwa.site.renderWebcollage()}).bind(this);
document.addEventListener("scroll",d)}}}async scriptsFirstPagePostRender(){if(!this.pwa.session.isFast){this.pwa.appshell.renderTemplate("#scriptsFirstPageDom","#scriptsFirstPageTemplate");var a=new Promise((b,c)=>{c="www.bedbathandbeyond.com"===location.host||"www.harmonfacevalues.com"===location.host||"www.buybuybaby.com"===location.host||"www.bedbathandbeyond.ca"===location.host||"blog.bedbathandbeyond.com"===location.host||-1<location.host.indexOf("bbbyproperties")&&0>location.host.indexOf("bbbypropertiestest")?
"https://tags.tiqcdn.com/utag/bbb/bbb-feo/prod/utag.js":"https://tags.tiqcdn.com/utag/bbb/bbb-feo/qa/utag.js";let d=document.createElement("script");d.setAttribute("defer","");d.setAttribute("src",c);d.onload=function(){let f=document.createElement("script");f.setAttribute("defer","");f.setAttribute("src","/static/analytics/amp/event/pwaAnalytics.js");f.setAttribute("id","pwaAnalyticsScript");f.onload=function(){b()};document.head.appendChild(f)};document.head.appendChild(d)});await Promise.all([a]);
$(window).on("scroll",wmPwa.site.loadFirstPageFirstScrollOrClick);$(window).on("mousedown",wmPwa.site.loadFirstPageFirstScrollOrClick);this.scriptsEveryPagePostRender()}}async getFacetURL(){const a=new URL(location.href),b=[];let c=this.pwa.session.parsedURL.basePath;const [d,f]=await Promise.all([this.pwa.amp.ampGetState("apiUrl"),this.pwa.amp.ampGetState("changeStore")]);var g=this.facetsRemoveDoubleQuotes(d.facets);let h=this.stringifyFacets(g);g=this.buildFriendlyFacetUrlSegment(this.facetsToKebabCase(g));
d.searchTerms&&b.push(`fl_${encodeURI(d.searchTerms).replace(/%20/gi,"-")}`);g&&b.push(g);1<=d.page&&b.push(`${d.page+1}-${d.perPage||24}`);(g=(g=/&storeOnlyProducts=true&storeId=(\d+)/i.exec(d.storeOnlyParam))?`store-${g[1]}`:"")&&b.push(g);(g=(g=/sddZip=([0-9a-z]{3,5})/i.exec(d.sddZipParam))?`sddZip-${g[1]}`:"")&&b.push(g);h&&b.push(btoa(h));d.sort?a.searchParams.set("sort",d.sort.replace("&sort=","")):a.searchParams.delete("sort");d.inStockOnline?a.searchParams.set("inStockOnline",!0):a.searchParams.delete("inStockOnline");
d.removeInStock?a.searchParams.set("removeInStock",!0):a.searchParams.delete("removeInStock");f.nearestStores?a.searchParams.set("nearestStores",f.nearestStores):a.searchParams.delete("nearestStores");return a.origin+c.replace(/\/?$/,"/")+b.join("/")+a.search.replace(/%2520/gi,"%20")+a.hash}getAppliedFacetsFromBase64(a){a=atob(a);a=this.parseFacets(a);return a=this.addFacetDoubleQuotes(a)}parseURL(a){let b={basePath:"",bopis:null,facets:null,friendlyFacets:null,fullPath:a.pathname,page:null,perPage:null,
sddZipcode:null,searchTerms:null,storeId:null},c=a.pathname.split("/"),d=this.pwa.session.docTests.isSearchReg.test(a.pathname)&&4==c.length;a=this.pwa.session.docTests.isBrandReg.test(a.pathname)&&5==c.length;let f=d||a?"doNotParse":c[c.length-1];c.forEach((g,h)=>{if(g){let k=!1;if(g==f)try{window.atob(g),/\/store\/vendor\/([a-zA-z]+)/i.test(b.basePath)||(k=!0)}catch(l){}"/store/s"==b.basePath&&3==h?b.basePath+="/"+g:/^fl_/i.test(g)?b.searchTerms=decodeURI(g.replace("fl_","").replace(/-/gi,"%20")):
/^_[A-Za-z-0-9_-]+/.test(g)?b.friendlyFacets=g:/^\d+-\d+/i.test(g)?(h=/^(\d+)-(\d+)/i.exec(g),b.page=parseInt(h[1]-1),b.perPage=parseInt(h[2]),9792<(b.page+1)*b.perPage&&(b.page=Math.floor(9792/b.perPage)-1,b.fullPath=b.fullPath.replace(g,`${b.page}-${b.perPage}`))):/^store-\d+/i.test(g)?(g=/^store-(\d+)/i.exec(g),b.storeId=g[1]):/^sddZip-([0-9]+)/i.test(g)?(g=/^sddZip-([0-9]+)/i.exec(g),b.sddZipcode=g[1]):k?b.facets=g:b.basePath+="/"+g}});return b}facetsToKebabCase(a){for(const b in a)for(const c in a[b])a[b][c]=
this.pwa.util.toKebabCase(a[b][c]);return a}facetsRemoveDoubleQuotes(a){let b={};for(const c in a)for(const d in a[c])a[c][d]&&(b[c]||(b[c]=[]),b[c].push(a[c][d].replace(/^"|"$/g,"").replace(/\\"/g,'"')));return b}addFacetDoubleQuotes(a){const b=/"/gi;for(const c in a)for(const d in a[c])a[c][d]='"'+(a[c][d]||"").replace(b,'\\"')+'"';return a}buildFriendlyFacetUrlSegment(a){const b=["CATEGORY_HIERARCHY","LOW_PRICE"],c=Object.keys(a).filter(d=>!b.includes(d)&&a[d].length).sort();return c.length?"_"+
c.map(d=>a[d].map(f=>"RATINGS"===d&&f.match(/(\d+)[.-]0/)?f.match(/(\d+)[.-]0/)[1]:f).sort().join("_")).join("_"):null}stringifyFacets(a){const b=[];Object.keys(a).sort().forEach(c=>{const d=a[c].map(f=>c===this.PRICE_KEY&&""!==f?`"[${f.split("-")}]"`:`"${f}"`).sort().join(this.VALUE_DELIMITER);b.push(`${c}${this.PAIR_DELIMITER}${d}`)});return b.join(this.GROUP_DELIMITER)}parseFacets(a){try{return a&&a.split(this.GROUP_DELIMITER).map(b=>-1<b.indexOf(this.PAIR_DELIMITER)?[b.substring(0,b.indexOf(this.PAIR_DELIMITER)),
b.substr(b.indexOf(this.PAIR_DELIMITER)+1)]:[b]).map(([b,c])=>[b,c.split(this.VALUE_DELIMITER)]).reduce((b,[c,d])=>({...b,[c]:this.reviver(c,d)}),{})}catch(b){return{error:b}}}reviver(a,b){switch(a){case this.RATING_KEY:return String(b).match(this.NUMBER_REG_EXP);case this.PRICE_KEY:return b.map(c=>c.match(this.NUMBER_REG_EXP).join(this.RANGE_DELIMITER))}return b.map(c=>c.replace(this.STRIP_BOUNDING_QUOTES,""))}recentlyViewedDataUpdate(a){if(a=a.pathname.split("/").pop()){a=[a.replace(/-/," ")];try{var b=
localStorage.getItem("recentlyViewed")}catch(c){}b&&(b=b.split(","),a=a.concat(b));a=[...(new Set(a))];try{localStorage.setItem("recentlyViewed",a.slice(0,5).join(","))}catch(c){}}}recentSearchClear(){try{localStorage.removeItem("recentsearchList")}catch(b){}$(this.pwa.session.docObjActive.shadowBody).find(".recentSearches, .recentSearchLink").remove();const a={recentSearches:null};768<=window.innerWidth&&(a.u={search:null});this.pwa.amp.ampsSetState(a)}async recentSearchDataUpdate(a){var b=[];if(!a){let [d,
f]=await Promise.all([this.pwa.session.docTests.isPLPReg.test(location.pathname)?this.pwa.amp.ampGetState("prodList",300):Promise.resolve(),this.pwa.amp.ampGetState("recentSearches",300)]);if(f&&f.searches)return;let g;try{(g=d.response.numFound&&d.fusion.q)&&b.push(g)}catch(h){}}let c;try{c=localStorage.getItem("recentsearchList")}catch(d){}c&&(b=b.concat(c.split(",")));if(b.length){b=[...(new Set(b))];try{localStorage.setItem("recentsearchList",b.slice(0,4).join(","))}catch(d){}b=b.map(d=>({searchTerm:d,
searchTermPath:d.replace(/[^a-zA-Z0-9]+/gi,"-")}));a?(this.pwa.amp.ampSetStateBeforeRender(a,"recentSearches",null),this.pwa.amp.ampSetStateBeforeRender(a,"recentSearches",{searches:b})):(this.pwa.amp.ampsSetState({recentSearches:null}),this.pwa.amp.ampsSetState({recentSearches:{searches:b}}))}}recentSearchFormHandler(a){var b=a.attr("action");a=a.find("#searchInput").val();this.pwa.sayt.lastKeySearchTerm&&(a=this.pwa.sayt.lastKeySearchTerm);this.pwa.session.lastSearchTerm=a;if(!a)return!1;a=a.trim().replace(/"/gi,
"_").replace(/[^a-zA-Z0-9"':\$&_]+|\s/gi,"-");b=`${b}${encodeURI(a)}`;this.pwa.sayt.aSelect&&this.pwa.sayt.aSelect[0].dataset.link&&this.pwa.sayt.lastKeySearchTerm!=this.pwa.sayt.term&&(b=this.pwa.sayt.aSelect.attr("href"));this.pwa.load(b);return!0}async siteGiftcardHandler(a){var b=await this.pwa.user.sessionConfirmationHeadersGetOrSet();let c;var d=this.pwa.util.createInputMatchHandler({useForm:!0}),f=this.pwa.appshell.validateForm(a[0]);d=d(a);if(f&&d){$(a).removeClass("amp-form-submit-error");
f=$(a).serialize();try{if(c=await (await fetch(this.pwa.session.apiInfo.apiGiftCardForm,{body:f,param:{cardType:"RC"},credentials:"include",method:"POST",headers:Object.assign({"Content-Type":"application/x-www-form-urlencoded"},b)})).json(),"SUCCESS"==c.serviceStatus)$(a).closest(".modalContentInner").find("#giftCardBalanceAlert").addClass("wHide"),c.data.component.balanceBean.giftCardIdShort=c.data.component.balanceBean.giftCardId.slice(-4),this.pwa.amp.ampsSetState({giftCard:c});else throw f=b=
"",c.data&&c.data.component.balanceBean.errorMessage||c.errorMessages?(b=c.data.component.balanceBean.errorMessage,f=c.errorMessages[0].message):(b="The card is not active. Please enter another card or provide another form of payment for the balance.",f="Rewards Certificate Error: The card is not active. Please enter another card or provide another form of payment for the balance."),$(a).closest(".modalContentInner").find("#giftCardBalanceAlert").removeClass("wHide").text(b),$(a).closest(".modalContentInner").find("#rewardCardBalanceAlert").removeClass("wHide").text(f),
Error("Errors submitting gift card balance form",c);}catch(g){$(a).addClass("amp-form-submit-error"),console.warn(`Problem submitting gift card balance form. Error: ${g}`)}}else this.formValidationHandler=this.formValidationHandler?this.formValidationHandler:g=>{this.pwa.appshell.validateForm(g.currentTarget)},$(a).addClass("amp-form-submit-error"),a[0].removeEventListener("change",this.formValidationHandler),a[0].addEventListener("change",this.formValidationHandler)}async getPDPCurrentPrice(){var a=
$((this.pwa.session.docs.pdp||this.pwa.session.docObjActive).shadowBody);a.find("#collections");a=a.find(".pricesWrap amp-list:not([hidden]) div:not([class='amp-hidden'])>.trackIsPrice").text();a=a.split("-")[0];return Number(a.replace(/[^0-9.-]+/g,""))}async activatePaymentOptions(a){if(!this.pwa.session.paymentInit){var b=this.pwa.session.features.pdpCollectionsV2?".payOption2":"#payOption2",c=this.pwa.session;c.paypalIsHidden=!0;c.currentPrice=-1;await this.updatePaymentOptionPriceLabels();if(this.pwa.session.features.pdpShowShowMorePaymentsLink)a.find(`div${b} div.moreOptions`).on("click",
async()=>{this.pwa.site.showMorePaymentOptions(a,b)});else this.pwa.site.showMorePaymentOptions(a,b);this.pwa.session.paymentInit=!0}}async paymentOptionClick(a){let b=a.closest("body");if(a.is(".afterPayInfoIcon"))this.pwa.util.scriptAdd("https://js.afterpay.com/afterpay-1.x.js","afterpayClientScript",function(){let c="en_US-theme-white";/bbbycaapp|bedbathandbeyond\.ca/.test(location.host)&&(c="en_CA-theme-white");Afterpay.launchModal(c)});else return b.find(".klarnaModalWrapper").addClass("active"),
!1}async renderKlarnaModal(a,b){if(!(10>b)){var c="",d="";this.pwa.session.isPreprod?(c="99107726-80f4-5b15-96c5-0fbe32f883f8",this.pwa.session.isBABY&&(c="82a5e296-405a-504b-bc4c-8f4a712a74ee"),d="osm-na.playground.klarnaservices.com"):(c="8f0d53e7-b55a-54d5-815b-34d750247c28",this.pwa.session.isBABY&&(c="62286914-4471-599f-806c-df66b3dde576"),d="osm-na.klarnaservices.com");b=`https://${d}/v3/messaging?client_id=${c}&placement_key=credit-promotion-badge&channel=web&locale=en-US&purchase_amount=${Math.round(100*
b)}`;try{await fetch(b).then(f=>f.json()).then(f=>{let g=f.content.nodes[1].url;0==$(".klarnaModalWrapper").length?(a.append(`
              <div class="modal klarnaModalWrapper" data-modal-close>
                <div class="parent d6 modalContent">
                <!-- arbitrary H and W on iframe -->
                  <iframe
                    height="1200"
                    width="1200"
                    src="${g}"
                  >
                  </iframe>
                  <button id="klarnaModalClose"
                    class="btn modalClose"
                    data-modal-close=""
                  >
                  <svg class="wi wiClose noTap"><use xlink:href="#wiClose"></use></svg>
                  </button>
                </div>
              </div>
              `),a.find("#klarnaModalClose, .klarnaModalWrapper").on("click",h=>{h.target.closest(".klarnaModalWrapper").classList.remove("active")})):$(".klarnaModalWrapper iframe").attr("src",g).addClass("active");fetch(f.impression_url,{mode:"no-cors"})})}catch(f){console.error(f);debugger}}}async showMorePaymentOptions(a,b){var c=this.pwa.session;c.showPayPal&&(a.find(`div${b} div.paypal`).show(),c.paypalIsHidden=!1,c.currentPrice=-1,this.pwa.util.scriptAdd("https://www.paypal.com/sdk/js?client-id="+
(c.isPreprod?"AXO-SBUsQQtEyKIO4u3Ihj9GEXfMnJjOgkVl8fwPJwYTjOYz0nw1LmDj_CDSPpEQMRvq8I1d2TyE7TZs":c.isBABY?"AQVhaTnL5pyyXwnn4D8pGfZIpSASJ3hvCfE04-2t-oZ5bxG0Br08c1v609avdfOd8M1jTGaAMZCu-MLa":"AdfXyxI-oHYghKou93lC4LRkRB0OP3-8h0L5srBeDzUYFwJ44_Jk4Vv71CKt3BlMUlGUGseBIoRFAu0F")+"&currency=USD&disable-funding=card&intent=order&commit=false&components=buttons,messages","paypalClientScript",this.updatePaymentOptionPriceLabels.bind(this)));c.showAfterPayAndKlarna&&(c=await this.pwa.site.getPDPCurrentPrice(),
this.pwa.session.features.pdpKlarna&&this.pwa.site.renderKlarnaModal(a,c));this.pwa.session.features.pdpShowShowMorePaymentsLink&&(a.find(`div${b} div.moreOptions`).hide(),a.find(`div${b}`).css({height:"auto"}))}async showHideKlarna(a){let b=await this.pwa.pdpDataAbstraction.getSkuDetails();if(b){if(b.isPreorder||b.isBackorder)return a.find(".paymentOption.klarna").hide(),a.find(".payOption").css("min-height","unset"),!0;a.find(".paymentOption.klarna").show()}return!1}async updatePaymentOptionPriceLabels(){try{let b=
this.pwa.session.features.pdpCollectionsV2?".payOption2":"#payOption2";const c=this.pwa.session,d=$((this.pwa.session.docObjActive||this.pwa.session.docs.pdp).shadowBody);await this.pwa.pdpDataAbstraction.getSkuDetails();let f=await this.pwa.site.getPDPCurrentPrice();if(this.pwa.session.currentPrice!=f)if(this.pwa.session.currentPrice=f,c.showPayPal=30<f&&600>f,c.showAfterPayAndKlarna=10<f&&2E3>f,c.showPayPal=!1,c.showAfterPayAndKlarna=await this.pwa.pdpDataAbstraction.showAfterPayAndKlarna(c.showAfterPayAndKlarna),
this.pwa.session.features.pdpKlarna||(d.find(".paymentOption.klarna").remove(),d.find(`${b}`).css("min-height","unset")),c.showAfterPayAndKlarna||c.showPayPal){$("#womp-pp-message").css({"z-index":1,opacity:0});d.find(`div${b}`).show();var a=Math.round(100*(f/4+Number.EPSILON))/100;d.find("span.paymentAmount").text("$"+a.toFixed(2));c.paypalIsHidden||this.renderPaypalMessage(f)}else $("#womp-pp-message").css({"z-index":-1,opacity:0}),d.find(`div${b}`).hide()}catch(b){debugger}}async renderPaypalMessage(a){try{if(window.paypal&&
this.pwa.session.docTests.isPDPReg.test(location.pathname)){var b=this.pwa.session.docObjActive,c=$("#womp-pp-message");0==c.length&&($(b.hostElem.parentElement).append('<div id="womp-pp-message" class="womp-remove"\n            style="\n              bottom: 0;\n              height: 24px;\n              left: 0;\n              opacity: 0;\n              position: fixed;\n              width: 100%;\n              z-index: 2;\n              margin-top: 3px;\n            "\n          ></div>'),c=$("#womp-pp-message"));
await paypal.Messages({amount:a,style:{layout:"custom",markup:"https://www.paypalobjects.com/upstream/assets/custom/LZ25HUZDSKSPN-2.html",logo:{type:"primary"}},onRender:()=>{setTimeout(()=>{setTimeout(()=>{c.css({opacity:1,"z-index":2})},100);wmPwa.util.positionAppshellElement("#womp-pp-message","#ppPlaceholder")},10)}}).render(c[0]);this.pwa.session.paypalIsHidden&&(this.pwa.session.paypalIsHidden=!1,c.css({"z-index":2,opacity:1}))}}catch(d){}}async renderWebcollage(){0==$("#syndi_inline").length&&
$(this.pwa.session.docObjActive.hostElem.parentElement).append('<div id="syndi_inline"></div>');const a=async()=>{try{await this.pwa.util.waitForElement("syndigo-powerpage");const b=$("#syndi_inline"),c=$(this.pwa.session.docObjActive.shadowBody);c.find("#wc-power-page").replaceWith(b);console.log("WebCollage moved in to Shadow ");this.pwa.site.socialAnnexPosition();c.find("#webCollageCont").removeAttr("hidden");try{const d=c.find("syndigo-powerpage")[0];(new ResizeObserver(function(f){this.pwa.site.socialAnnexPosition()}.bind(this))).observe(d)}catch(d){console.warn("Resize failed for syndigo content")}}catch(b){0<
$("#syndi_inline").length&&$("#syndi_inline").hide()}};window.SYNDI=window.SYNDI||[];window.SYNDI.push({contentCallback:function(b){b?a():console.warn("window.SYNDI.contentCallback does not have content")}.bind(this)});SYNDI.push(this.pwa.site.prodIdGet(new URL(location.href)))}async renderSocialAnnex(a,b,c,d,f){var g=`${location.pathname}${location.search}`,h=this.pwa.session.docTests;let k={margin:"20px -10px 40px -13px"};h.isPDPReg.test(g)?(a="2",b="sa_s22_instagram_product",c="s22LoadProductPage",
window.sa_s22_product=location.pathname.replace(/\/$/,"").split("/").pop(),k={margin:"2rem 0"}):h.isPLPReg.test(g)||h.isCLPReg.test(g)?(a="3",b="sa_s22_instagram_category",c="s22LoadCategoryPage",d="category",f=location.pathname.replace(/\/$/,"").split("/").pop()):h.isHomeReg.test(g)&&(a="1",b="sa_s22_instagram_home",c="s22LoadIndexPage",f=d=null);g=$(this.pwa.session.docObjActive.shadowBody).find("#socialannex");0<g.length&&!window[c]&&(h="9411181",wmPwa.session.isCANADA?h="9411361":wmPwa.session.isBABY&&
(h="9411351"),wmPwa.util.scriptAdd(`//cdn.socialannex.com/partner/${h}/bbb-feo/universal.js`,"socialAnnexClientScript"));0==$("#sa_s22_instagram").length&&$(this.pwa.session.docObjActive.hostElem.parentElement).append('<div id="sa_s22_instagram" class="'+b+' womp-remove" style="z-index:1;"></div>');k&&g.css(k);wmPwa.session.isHARMON&&($("#socialannex").hide(),$("#sa_s22_instagram").hide());window.sa_s22_instagram_category_code=f;window.sa_s22_instagram_category_type=d;window.sa_page=a;await this.pwa.util.waitForProp(c);
if("s22LoadProductPage"==c)window[c](a,window.sa_s22_product);else window[c](a,sa_s22_instagram_category_type,sa_s22_instagram_category_code);try{await this.pwa.util.waitForElement("div#sa_s22_instagram[data-page-type][data-count] *"),$(this.pwa.session.docObjActive.shadowBody).find("#socialAnnexStickyNav").removeAttr("hidden")}catch(l){console.log(`Social annex did not load. Error: ${l}`)}this.pwa.site.socialAnnexPosition();try{(new ResizeObserver(l=>{console.log("Body height changed:",l[0].target.clientHeight);
this.pwa.site.socialAnnexPosition()})).observe(document.body)}catch(l){console.error("Could not use positionObserver to monitor for document height changes, hiding SocialAnnex",l),$("#sa_s22_instagram").hide()}}socialAnnexHide(){$("div#sa_s22_instagram[data-page-type][data-count]").addClass("wHide")}socialAnnexPosition(){this.pwa.util.positionAppshellElement("div#sa_s22_instagram[data-page-type][data-count]","#socialannex")}async tealiumClickEventEmitter(a,b){const c=$(a);if("pdpClickOnSku"==c.attr("data-cta"))try{const [f]=
location.pathname.match(/\d+$/)||[""];setTimeout(()=>pdpClickOnSku(f),500);return}catch(f){}if("typeaheadLinkClick"==c.attr("data-cta")){var d=c.attr("data-attribute");d=JSON.parse(d);d.search_term=await this.pwa.amp.ampGetState("searchTerm");c.attr("data-attribute",JSON.stringify(d))}if("pdpAddToRegistry"==c.attr("data-cta")){d=c.attr("data-attribute");d=JSON.parse(d);let f=await this.pwa.pdpDataAbstraction.getSkuDetails(),g=await this.pwa.site.getPDPCurrentPrice();d.prodQty="string"!==typeof d.prodQty&&
0<d.prodQty.length?`${d.prodQty[0]}`:"1";d.product_price=[g];d.product_sku_id=f.SKU_ID;d.skuName=f.data.PRODUCT_DETAILS.DISPLAY_NAME;c.attr("data-attribute",JSON.stringify(d))}this.pwa.session.isDebug&&console.log("tealiumClickEventEmitter: ",c.outerHTML());a=function(f,g){try{window.tealiumClickEventHandler(f,g)}catch(h){console.warn("tealiumClickEventHandler error:",h)}}.bind(this,a,b);window.tealiumClickEventHandler||await this.pwa.util.waitForProp("tealiumClickEventHandler",window,5E3).catch(f=>
console.warn(f));setTimeout(a)}async tealiumPlpStateManager(a){a=$(a.target);a.is("input")||(a.closest(".plpOptsSubOpt").length?this.tealiumConfig.plpListAction="plpFacetSelection":a.closest(".plpPill").length?this.tealiumConfig.plpListAction="plpRemoveOneFacet":a.is(".plpPillClrAll")?this.tealiumConfig.plpListAction="plpClearAllFacets":a.is(".sort")?this.tealiumConfig.plpListAction="plpSortBtnClick":a.is(".plpPage")&&(this.tealiumConfig.plpListAction="plpPaginationClick"))}async tealiumPlpCardEvents(a){if(!this.pwa.session.isFast){var b=
a[0],c=this.tealiumConfig;c.plpListAction&&(a.attr("data-cta",c.plpListAction),this.tealiumClickEventEmitter(b));c.plpListAction="";await this.pwa.util.waitForProp("ioCallback").catch(f=>console.log(f));if(window.ioCallback){var d=new IntersectionObserver(window.ioCallback,{root:null,rootMargin:"0px",threshold:1});a.find(".trackName").each((f,g)=>d.observe(g))}}}checkSeoHeight(a,b){b=Object.assign({maxHt:300,btnClass:"seoBtnCont",contClass:"seoHide",overlay:"clpDescOverlay",limitContClass:"seoHide"},
b);var c=a.find(`.${b.contClass}`),d=a.find(`.${b.limitContClass}`);if(0!=c.length)return d=Number.parseInt(d.css("max-height")),d=isNaN(d)?b.maxHt:d,c=c.height(),c<d&&0!==c?(a.find(`.${b.btnClass}`).attr("hidden","hidden"),a.find(`.${b.overlay}`).attr("hidden","hidden"),!0):!1}setPlpPositionFromAmp(){try{let a=new URL(location.href),b=a.searchParams.get("prodId"),c=a.searchParams.get("type");"cart"!=c&&"pickItUp"!=c&&"deliverIt"!=c&&"pickItModal"!=c||this.pwa.util.plpScrollByProdId(b,this.pwa.session.docs.primary.shadowDoc.ampdoc)}catch(a){console.log(`Could not find the product scroll position for plp redirect. Error: ${a}`)}}async getCurrentLocation(){async function a(c,
d){return(await (await fetch(`https://www.mapquestapi.com/geocoding/v1/reverse?key=Gmjtd%7Clu6120u8nh,2w%3Do5-lwt2l&location=${c},${d}`)).json()).results[0].locations[0].postalCode}async function b(){return await new Promise((c,d)=>{navigator.geolocation||d({message:"Geolocation is not available on this browser"});navigator.geolocation.getCurrentPosition(c,d,{enableHighAccuracy:!1,maximumAge:6E5,timeout:1E4})})}try{const c=await b(),d=c.coords.latitude,f=c.coords.longitude;if(!d||!f)throw Error("Unable to get lat long for current position");
return await a(d,f)}catch(c){return console.warn(`Unable to get current location. Error: ${c}`),!1}}async getCurrLocation(a,b){a.next(".gpsErr").remove();let c=a.html();try{a.html("Fetching location...");a.addClass("noTap");let d=await this.getCurrentLocation();if(!d)throw Error("Unable to get");"sdd"==b?this.pwa.amp.ampsSetState({changeStore:{sddZipcode:d.replace(/-[0-9]+/,"")}}):this.pwa.amp.ampsSetState({changeStore:{location:d}});a.html(c);a.removeClass("noTap");return d}catch(d){console.warn(`Error getting current location in store modal: Error: ${d}`),
a.html(c),a.removeClass("noTap"),a.after(' <div class="alert gpsErr noTap">Location error!. Please Try again.</div>')}return!1}locationCookieSet(a){window.wmLocationSync&&window.wmLocationSync(!1,a)}storeInfoUpdate(a,b,c){(a=b.attr("data-store-obj"))&&(a=JSON.parse(a));this.locationCookieSet({data:{store:a}})}}
class PdpDataAbstractionV2{constructor(a){this.pwa=a}excludeAfterpay(a,b){return a&&a.data&&a.data.SKU_DETAILS&&1==a.data.SKU_DETAILS[0].GIFT_CERT_FLAG||b&&b.MAX_SHIPPING_DAYS&&15<b.MAX_SHIPPING_DAYS||a.data&&a.data.SKU_DETAILS&&1==a.data.SKU_DETAILS.length&&15<a.data.SKU_DETAILS[0].MAX_SHIPPING_DAYS?!0:!1}async getPDPState(a,b){try{let c=b||this.pwa.site.prodIdGet(new URL(this.pwa.session.docs.pdp.href));return await this.pwa.amp.ampGetState(`${a}${c}`)}catch(c){this.pwa.errorCustom(`Unable to get pdpdDetails. Error: ${c}`,
c)}}async typeOfProduct(a){try{const b=await this.getPDPState("pdpDet");if("collection"==a)return b.data.PRODUCT_DETAILS.PARENT_PROD_INFO&&0<b.data.PRODUCT_DETAILS.PARENT_PROD_INFO.length;if("accessory"==a)return b.data.PRODUCT_DETAILS.CHILD_ID&&0<b.data.PRODUCT_DETAILS.CHILD_ID.length}catch(b){this.pwa.errorCustom(`Unable to get get type of product. Error: ${b}`,b)}return!1}async getParentProductId(){try{return(await this.getPDPState("pdpDet")).data.PRODUCT_DETAILS.PARENT_PROD_INFO[0].PRODUCT_ID}catch(a){this.pwa.errorCustom(`Unable to get parent product ID. Error: ${a}`,
a)}}async showAfterPayAndKlarna(a){try{const [b,c]=await Promise.all([this.getPDPState("pdpDet"),this.getPDPState("skuFacets")]),d=this.pwa.site.skuGet({data:b.data.SKU_DETAILS},c);if(this.excludeAfterpay(b,d))return!1}catch(b){this.pwa.errorCustom(`Unable to get parent product ID. Error: ${b}`,b)}return a}async getSkuDetails(a){try{let b=null,c=null;a?[b,c]=await Promise.all([this.getPDPState("skuFacets",a),this.getPDPState("pdpDet",a)]):[b,c]=await Promise.all([this.getPDPState("skuFacets"),this.getPDPState("pdpDet")]);
if(b.skuId){let d;d=c.data.SKU_DETAILS.filter(f=>f.SKU_ID==b.skuId)[0];d.data=c.data;return d}if(c.data.PRODUCT_DETAILS)return c.data.PRODUCT_DETAILS}catch(b){this.pwa.errorCustom(`Unable to get sku details. Error: ${b}`,b)}}async getSelectedSkuId(){return(await this.getPDPState("skuFacets")).skuId}async getPrice(){return(await this.getPDPState("skuFacets")).skuId}}
class PdpDataAbstractionV1 extends PdpDataAbstractionV2{constructor(a){super();this.pwa=a}async typeOfProduct(a){if(this.pwa.session.docTests.isPDPReg.test(location.pathname)){let b=await this.pwa.amp.ampGetState("prodSku");if("collection"==a)return b.data.PRODUCT_DETAILS.hasOwnProperty("PARENT_PRODUCT")&&0<b.data.PRODUCT_DETAILS.PARENT_PRODUCT.length;if("accessory"==a)return b.data.PRODUCT_DETAILS.hasOwnProperty("CHILD_PRODUCT")}return!1}async getParentProductId(){try{return(await this.pwa.amp.ampGetState("prodSku")).data.PRODUCT_DETAILS.PARENT_PRODUCT[0]}catch(a){this.pwa.errorCustom(`Unable to get parent product ID. Error: ${a}`,
a)}}async showAfterPayAndKlarna(a){try{const [b,c,d]=await Promise.all([this.pwa.amp.ampGetState("prodSku"),this.pwa.amp.ampGetState("prodSkusAll"),this.pwa.amp.ampGetState("skuFacets")]),f=this.pwa.site.skuGet(c,d);if(this.excludeAfterpay(b,f))return!1}catch(b){this.pwa.errorCustom(`Unable to get parent product ID. Error: ${b}`,b)}return a}async getSkuDetails(){return await this.pwa.session.docObjActive.shadowDoc.getState("skuActive")}async getSelectedSkuId(){return(await this.pwa.amp.ampGetState("cart")).sku}}
class User{constructor(a){this.pwa=a;this.hasAcct=(a=this.pwa.util.cookieGet("securityStatus"))&&"0"!==a;this.isRecognized=a&&"2"===a;this.isLoggedIn=a&&"4"!==a;this.hasRegistry=this.pwa.session.isHARMON?!1:"true"===this.pwa.util.cookieGet("isActiveRegistrant");this.ATG_PROFILE_DATA=this.pwa.util.cookieGet("ATG_PROFILE_DATA")||"";this.apiAddItemList=`${location.origin}/apis/services/core/list/v1.0/add-item-list`}addToListMsgRender(){$(".addToListMsg").remove();$("body").append('\n    <button id="addToListMsg" class="msg msgIdeaboardAdded addToListMsg active msgCloseJs">\n      <span class="gr025 noTap">Item added to your shopping list!</span>\n      <a class="inlineBlock bold white link" href="/store/account/shoppingList">View list</a>\n    </button>');
let a=$("#addToListMsg");a.on("click",function(b){b=$(b.target);b.removeClass("active");setTimeout(function(c){c.remove()}.bind(this,b),500)});setTimeout(function(b){b.trigger("click")}.bind(this,a),6E3)}async ampBeforeUnload(){const a=this.pwa.util.cookieGet("dynSessionConfNumberValidity"),b=this.pwa.util.cookieGet("dynSessionConfNumber");!this.hasAcct||b&&"true"==a||await this.sessionConfirmationHeadersGetOrSet()}ampBeforeRenderUser(a){this.hasAcct&&(this.ampUpdateUserState(a),a.find("#accountV2DskList").attr({height:328,
width:376}),a.find(".accountTxt").text("My Account"),this.searchMsgUpdate(a),$(this.pwa.$$$(a[0],'a[data-click-handler*="handleAddToList"],a[data-click-handler*="pdp.collectAddToShopList"]')).removeAttr("href"),$(this.pwa.$$$(a[0],'a[data-click-handler*="getProductBundleSkus"]')).removeAttr("href [href]"))}ampUpdateUserState(a,b=!0){const c={hasAcct:this.hasAcct,hasRegistry:this.hasRegistry};b?this.pwa.amp.ampSetStateBeforeRender(a,"userState",c):this.pwa.amp.ampsSetState({userState:c})}async getProductBundleSkus(a){if(this.hasAcct){var [b,
c,d]=await Promise.all([this.pwa.amp.ampGetState("productBundle"),this.pwa.amp.ampGetState(`skuFacets${a}`),this.pwa.amp.ampGetState("bundleExclude")]);a="";c&&c.skuId&&(a=c.skuId);if(a)return a=b.fusion.bundles[a].filter(f=>!(d||[]).includes(f.SKU_ID)).map(f=>[f.PRODUCT_ID,f.SKU_ID]),await this.bulkShoppingListAdd(a)}}async bulkShoppingListAdd(a){let b=await this.pwa.user.sessionConfirmationHeadersGetOrSet(),c=[];for(let d of a)c.push(this.handleAddToList(d.join(","),{},{},b));try{await Promise.all(c),
this.addToListMsgRender()}catch(d){return console.warn(`user.bulkShoppingListAdd error. Error: ${d}`),!1}return!0}async handleAddToList(a,b,c,d){if(this.hasAcct){var [f,g]=a.split(",").map(k=>(k||"").trim());if(f&&g){a=new URL(this.apiAddItemList);b=a.searchParams;b.set("listId","");b.set("profileId",this.ATG_PROFILE_DATA);b.set("skuId",g);b.set("productId",f);b.set("quantity",1);b.set("serialNum",70789);b.set("marketPlaceItem",!1);b.set("marketPlaceItemOverSized",!1);b.set("marketPlaceOfferId","");
try{const k=await fetch(a,{credentials:"include",method:"POST",headers:Object.assign({},d&&d["atg-rest-depth"]?d:await this.pwa.user.sessionConfirmationHeadersGetOrSet())});if(!k.ok)return;var h=await k.json()}catch(k){}if(h.data.itemAdded)return d||this.addToListMsgRender(),!0}}}async ampListPostRenderUser(a){if(a.is("#cartCount"))try{const d=await this.pwa.amp.ampGetState("user");if(d.data.userFirstName){this.ampUserInfo=d;var b=a.closest("body");this.searchMsgUpdate(a.closest("body"));this.beyondPlusMemberUpdate(this.ampUserInfo,
b);this.writeReviewUserUpdate();this.pwa.college.userCollegeDataSet(this.ampUserInfo);var c=b.find("#csModalList");this.pwa.college.ampListPostRenderCollege(c);return!0}}catch(d){}}async logout(){await fetch(`${location.origin}/apis/stateful/v1.0/authentication/logout?web3feo`,{method:"POST",body:JSON.stringify({deviceId:null})});location.href=`${location.origin}?logout=true`}searchMsgUpdate(a){try{let d=this.ampUserInfo.data.userFirstName;if(d&&a.length){var b=`Hi ${this.pwa.util.titleCase(d)}, what are you looking for today?`,
c=a.find(".searchInput .sHide[\\[text\\]], [data-search-placeholder-tablet]")[0];c.outerHTML=c.outerHTML.replace(/What product can we help you find\?/gi,b)}}catch(d){}}writeReviewUserUpdate(){0!=$("#writeReviewModal").length&&$("#writeReviewModal").find("#screenname").val(this.ampUserInfo.data.userFirstName)}beyondPlusMemberUpdate(a,b){try{return"member"==a.data.tealiumUserData.beyond_plus_indicator&&b.addClass("beyondMember"),!0}catch(c){console.log(`Telium user data not available for determing user's beyond+ membership status. Error: ${c}`)}return!1}async sessionConfirmationHeadersGetOrSet(a){let b=
this.pwa.util.cookieGet("dynSessionConfNumber"),c=this.pwa.util.cookieGet("dynSessionConfNumberValidity");if(!a&&b&&c)return{_dynSessConf:b,"atg-rest-depth":2,"x-bbb-site-id":this.pwa.session.siteId||""};if(!a)try{a=await (await fetch(`${location.origin}/apis/stateful/v1.0/authentication/session-confirmation`,{credentials:"same-origin"})).json()}catch(d){throw this.pwa.errorCustom("unable to confirm user session",d);}b=a.data.sessionConfirmationNumber;a=a.data.traceId||"";this.pwa.util.cookieSet("dynSessionConfNumber",
b);this.pwa.util.cookieSet("dynSessionConfNumberValidity",!0,1140);return{_dynSessConf:b,"atg-rest-depth":2,"x-bbb-site-id":this.pwa.session.siteId||"","x-b3-spanid":a,"X-B3-TraceId":a}}}
class Util{constructor(a){this.domParser=new DOMParser;this.pwa=a}attrEncode(a,b){b=b?"&#13;":"\n";return(""+a).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,b).replace(/[\r\n]/g,b)}cookieGet(a){if(a=document.cookie.match(new RegExp(`(^| )${a}=([^;]+)`)))return a[2]}cookieSet(a,b,c,d,f,g,h){a=a+"="+b+(d?"; path="+d:"; path=/");c&&(a+="; max-age="+c);f&&(a+="; domain="+f);g&&(a+="; secure");h&&(a+="; SameSite=None");document.cookie=
a}async elemAttrEvent(a,b,c,d=[]){const f=new MutationObserver(g=>{g.forEach(c.bind(f,...d))});f.observe(a,{attributes:!0,attributeFilter:[b]})}fixCaZipcode(a){var b=$(this),c=b.val();4<=c.length&&" "!=c[3]&&"deleteContentForward"!=a.inputType&&(c=c.slice(0,3)+" "+c.slice(3),b.val(c))}forceNumeric(){var a=$(this);a.val(a.val().replace(/[^\d]+/g,""))}async formFetch(a){const b=a.attr("action")||a.attr("action-xhr");a=await fetch(b,{credentials:"include",method:a.attr("method"),headers:{"Content-Type":a.attr("enctype")||
"application/x-www-form-urlencoded"},body:a.serialize()});if(!a.ok)throw this.pwa.errorCustom(`${b} endpoint failure`,a);return a}formValidateInput(a){for(const b in a)if(1==a[b])return b}async formValidate(a){var b=a[0].elements;let c=[];for(const d of b)b=this.formValidateInput(d.validity),d.setAttribute("validity",b),"valid"!==b&&c.push(d);return c.length?(a.addClass("formInvalid"),c[0].focus(),!1):!0}formToObject(a){a=new URL(`${location.origin}?${a.serialize()}`);const b={};for(const [c,d]of a.searchParams.entries())b[c]=
d;return b}mergeRecursive(a,b){try{for(var c in b)a[c]=void 0==a[c]?b[c]:a[c].constructor==Object&&b[c].constructor==Object?this.mergeRecursive(a[c],b[c]):a[c].constructor==Array&&b[c].constructor==Array?b[c].concat(a[c].filter(d=>-1==b[c].indexOf(d))):b[c]}catch(d){console.log(d)}return a}onThrottledBegin(a,b=100){let c;return function(){c||(a(),c=setTimeout(()=>{clearTimeout(c);c=null},b))}}onThrottledEnd(a,b=100){let c;return function(){clearTimeout(c);c=setTimeout(a,b)}}inputsMustMatch(a,b,c){const d=
this.pwa.util.createInputMatchHandler("undefined"==typeof c?{}:c,!1);a.removeEventListener(b,d);a.addEventListener(b,f=>{d(f.target)},!0)}createInputMatchHandler(a){const b=Object.assign({invalidClass:"invalidMatch",validFormClass:"user-valid",matchSelector:"inputMatch",eventType:"change",useForm:!1},a);return function(c){if(b.useForm||$(c).hasClass(b.matchSelector)){var d=!0;c=b.useForm?c:$(c).closest("form");c=$(c).find(`.${b.matchSelector}`);var f=$(c).eq(0).val();c.each(function(){let g=$(this).val();
if(g!==f&&""!==g.trim())return d=!1});d?$(c).removeClass(b.invalidClass):$(c).addClass(b.invalidClass);return d}}}parseDoc(a){return this.domParser.parseFromString(a,"text/html")}querySelectorAllDomAndTemplate(a,b){const c=Array.from(a.querySelectorAll(b));a=a.querySelectorAll("template");let d=[];for(const f of a)d=d.concat(Array.from(f.content.querySelectorAll(b)));return c.concat(d)}referrerSet(a){if(a)try{Object.defineProperty(document,"referrer",{configurable:!0,get:function(){return a}})}catch(b){}}scrollToggle(a,
b){void 0!==b.attr("data-modal-close")&&void 0===b.attr("data-modal-open")&&$("body").hasClass("modalOpen")?($("body").removeClass("modalOpen"),a.shadowBody.classList.remove("modalOpen")):b.is(".navPill.active, .dskNavItem1.active")?($("body").removeClass("modalOpen"),a.shadowBody.classList.remove("modalOpen")):void 0!==b.attr("data-modal-open")?(this.pwa.desktop.isDesktop&&b.closest("body").removeClass("miniHeader"),$("body").addClass("modalOpen"),a.shadowBody.classList.add("modalOpen")):void 0!==
b.attr("data-modal-close")&&($("body").removeClass("modalOpen"),a.shadowBody.classList.remove("modalOpen"))}runFunctionOnIntersect(a,b,c,d){0<a.length&&(a.show(),(new IntersectionObserver(function(f,g){f.forEach(h=>{h.isIntersecting&&(g.disconnect(h.target),c.apply(null,d))})},{root:null,rootMargin:b,threshold:0})).observe(a[0]))}scriptAdd(a,b,c){if(b&&0<$("head script#"+b).length)c&&c();else{var d=document.createElement("script");d.setAttribute("async","");d.setAttribute("src",a);b&&d.setAttribute("id",
b);c&&(d.onload=c.bind(this));document.head.appendChild(d)}}async scriptAddMustache(){window.Mustache||this.pwa.util.scriptAdd(`${location.origin}/amp/7865/mustache.min.js`)}scrollEvtThrottle(a,b,c=0){let d=0,f=!1;b=function(g,h){d=window.scrollY;f||(window.requestAnimationFrame(function(){a.bind(g)(h,d);setTimeout(function(){f=!1},c)}),f=!0)}.bind(null,this.pwa);document.addEventListener("scroll",b,{passive:!0});document.addEventListener("touchmove",b,{passive:!0});return b}simpleThrottle(a,b){let c=
!0;return function(...d){c&&(c=!1,a.apply(this,d),setTimeout(()=>c=!0,b))}}scrollIntoView(a,b){if(-1===b.indexOf("="))try{const c=a.querySelector(b)||a.querySelector(`a[name="${b.replace("#","")}"]`);c&&c.scrollIntoView&&setTimeout(function(d){d.scrollIntoView({alignToTop:!0,behavior:"auto"})}.bind(null,c),100)}catch(c){}}stopEvent(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.stopImmediatePropagation&&a.stopImmediatePropagation()}urlObjGet(a){try{const b=document.createElement("a");
b.href=a;const c=new URL(b.href),d=this.pwa.session;c.pathname.endsWith("/")&&"/"!==c.pathname&&(c.pathname=c.pathname.slice(0,c.pathname.length-1));d.isStaging&&/bedbathandbeyond|buybuybaby/i.test(c.hostName)&&(c.hostname=location.hostname);c.searchParams.delete("quickView");c.searchParams.get("SS_PREVIEW_EXP")&&(c.href=c.href.replace("%3A",":").replace(/=$/,""));return c}catch(b){return null}}waitForProp(a,b=window,c=2E4,d=150){return new Promise((f,g)=>{(b==window&&window[a]||b!=window&&b&&b[a])&&
f(b[a]);let h=setTimeout(()=>{clearInterval(k);g(`could not find ${b.toString()}['${a}']`)},c),k=setInterval(()=>{if(b==window&&window[a]||b!=window&&b&&b[a])clearInterval(k),clearTimeout(h),f(b[a])},d)})}waitForElement(a,b=document,c=2E4,d=150){return new Promise((f,g)=>{let h=setTimeout(()=>{clearInterval(k);g(`could not find ${a}`)},c),k=setInterval(()=>{b.querySelector(a)&&(clearInterval(k),clearTimeout(h),f(b.querySelector(a)))},d)})}positionAppshellElement(a,b){function c(h){g(d,f)}const d=
$(a),f=$(this.pwa.session.docObjActive.shadowBody).find(b);if(0!==d.length&&0!==f.length){(a=this.pwa.session.docObjActive.shadowBody.querySelector("#wm_content"))&&a.classList.contains("noResults")?d.addClass("wHide"):d.removeClass("wHide");var g=this.debounce(function(h,k){const l=window.scrollY+k[0].getBoundingClientRect().top,m=window.scrollX+k[0].getBoundingClientRect().left,p=k.width();h.css({left:m,"max-width":p,position:"absolute",top:l,width:p});0!=p&&h.removeClass("wHide");k.css({display:"block",
height:h.height()})},500,!0);g(d,f);(new MutationObserver(c)).observe(d[0],{attributes:!1,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!0,subtree:!0});(new MutationObserver(c)).observe(this.pwa.session.docObjActive.shadowBody,{attributes:!1,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!0,subtree:!0});window.addEventListener("resize",this.pwa.util.onThrottledEnd(function(){g(d,f)}),{passive:!0})}}debounce(a,b,c){var d;return function(){var f=
this,g=arguments,h=c&&!d;clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(f,g)},b);h&&a.apply(f,g)}}isDesktop(){return!/ipod|phone|mobile|mini/i.test(navigator.userAgent)}siteId(){return/bbbyapp|bedbathandbeyond\.com/.test(location.host)?7865:/bbbycaapp|bedbathandbeyond\.ca/.test(location.host)?7876:/bbbabyapp|buybuybaby/.test(location.host)?7876:/harmonfacevalues/.test(location.host)?7917:7865}toKebabCase(a){if(a)return a.replace(/'|"/g,"").match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).map(b=>
b.toLowerCase()).join("-")}toggleHiddenBeforeRender(a,b,c,d){b.find(a).each((f,g)=>{$(g).removeAttr("hidden");this.pwa.amp.ampSetStateBeforeRender(b,c,d)})}plpScrollByProdId(a,b){try{let c=b.getElementById(`prodCard${a}`),d=b.getElementById("headerWrap");window.scrollTo(window.scrollLeft,c.offsetTop-d.offsetHeight+window.outerHeight/2);return!0}catch(c){console.log(`Unable to get plp scroll position with product id ${a}. Error: ${c}`)}return!1}replaceStringInTemplate(a,b,c,d){a=a.find(`#${d}`);0!=
a.length&&(b=a.html().replace(b,c),a.html(b))}resetListHeight(a){setTimeout(this.pwa.amp.ampsAmpStateIsStableEvt.bind(this),500);const b=a.find("div[placeholder] ~ div:not([overflow])").children().eq(0).height();b>a.height()&&(console.log(`CLS Warning: resetListHeight list height for amp list with id ${a.attr("id")}. ReplaceContentHeight: ${b}. Amp list height ${a.height()} `),a.css("height",b),a.find(".btnFulfillMore").remove());b+50<a.height()&&(console.log(`CLS Warning: resetListHeight shrinking list height for amp list with id ${a.attr("id")}. ReplaceContentHeight: ${b}. Amp list height ${a.height()} `),
a.css("height",b))}titleCase(a){if("string"!==typeof a)throw TypeError("titleCase() requires a string");if(!a.length)return a;a=a.trim().split(" ");for(var b=0,c=a.length;b<c;b++)a[b]=(a[b][0]?a[b][0].toUpperCase():"")+(a[b].substr(1)?a[b].substr(1).toLowerCase():"");return a.join(" ")}async statefulFetch(a,b){async function c(f,g){return await fetch(f,g)}let d=null;try{d=await (await c(a,b)).json(),d.errorMessages&&0<d.errorMessages.length&&/Missing _dynSessConf/gi.test(d.errorMessages[0].message)&&
(this.pwa.util.cookieSet("dynSessionConfNumber",""),this.pwa.util.cookieSet("dynSessionConfNumberValidity",""),b.headers=Object.assign(b.headers,await this.pwa.user.sessionConfirmationHeadersGetOrSet()),d=await (await c(a,b)).json())}catch(f){d.error=f}return d}clearParams(a,b){try{let c=new URL(b);for(const d of a)c.searchParams.delete(d);history.replaceState(null,"",c.href);return!0}catch(c){console.warn(`util.clearParams error. Error: ${c}`)}return!1}}
function pwaStart(a){console.time("pwaFirstPageRender");window.wmPwa=new Pwa(window,a);window.wmPwa.appshell.appshellEventHandlersRegister(window.wmPwa);window.wmPwa.load(location.href)};
